!function(){"use strict";var e,t,n=function(e,t){return{request:function(n){return n.headers["default-lang"]=t.localStorage.getItem("language"),n||e.when(n)},response:function(e){return e},responseError:function(t){return e.reject(t)}}},a=function(e){e.tokenType="X-Auth-Token",e.storageType="localStorage"},i=function(e,n,a,i){t.$on("$stateChangeStart",function(t,a,i,o,r){!0!==a.needsAuth||n.isAuthenticated()||(e.transitionTo("login"),t.preventDefault())}),t.$on("$stateChangeSuccess",function(e,n,o,r,s){t.previousState={state:r,params:s},i.openedInWeChat()||i.openInWindowsWechat()?i.loadWeChatJsConf(a.getCurrentUrl()):i.loadWeChatJsConf(a.getCurrentUrlFromPageState(n)),document.body.scrollTop=document.documentElement.scrollTop=0})},o=function(n,a,o,r,s,c,u){return t=n,e=this,t.appConf=r,t.apiRegion&&""!==t.apiRegion?r.userRegion.setAPIRegion(t.apiRegion):c.getUserRegion().then(function(e){e.data&&e.data.country&&"china"===e.data.country.toLowerCase()?t.apiRegion=e.data.country.toLowerCase():t.apiRegion="default",r.userRegion.setAPIRegion(t.apiRegion)},function(e){}).finally(function(){}),s.changeLocale(t.appConf.default.momentJs.locale),i(a,o,c,u),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}),e};angular.module("shmApp.config",[]),angular.module("shmApp.controllers",[]),angular.module("shmApp.services",[]),angular.module("shmApp.directives",[]),angular.module("shmApp.filters",[]),angular.module("shmApp.languages",[]),angular.module("shmApp.routes",[]),angular.module("shmApp.templates",[]),e=angular.module("shmApp",["oc.lazyLoad","angular-ladda","angular.filter","satellizer","ui.bootstrap","ngSanitize","angularMoment","ngFileUpload","ui.tinymce","ui.bootstrap.datetimepicker","ui.dateTimeInput","toastr","ngFileUpload","ngTagsInput","ui.select","shmApp.config","shmApp.services","shmApp.controllers","shmApp.directives","shmApp.filters","shmApp.languages","shmApp.routes","shmApp.templates"]).factory("myInterceptor",["$q","$window",n]).config(["$authProvider",a]).config(["$httpProvider",function(e){e.interceptors.push("myInterceptor")}]).config(["toastrConfig",function(e){angular.extend(e,{allowHtml:!0,closeButton:!0,closeHtml:'<button type="button">&times;</a>'})}]).run(["$rootScope","$state","AuthService","appConf","amMoment","UtilsService","WeChatService",o])}(),function(){"use strict";var e,t,n,a,i,o,r=function(e){e.displayCounts="",e.detailsTitle="",e.appUser=void 0},s=function(){return a.otherwise("/"),n.state("login",{url:"/?oauth_token&oauth_verifier&code&state",template:'<div class="login-page"><login-panel app-user="appUser" class="login-panel"></login-panel></div>'}).state("addUserToCompany",{url:"/c?companyId",template:'<div class="login-page"><login-panel app-user="appUser" class="login-panel"></login-panel></div>'}).state("signup",{url:"/signup",template:'<div class="sign-up-page-wrapper"><sign-up-panel app-user="appUser" class="sign-up-page"></sign-up-panel></div>'}).state("auth",{abstract:!0,url:"/a",templateUrl:t+"auth/auth.html"}).state("auth.getWechatUser",{url:"/wu?domain&origurl",parent:"auth"}).state("auth.getUserFromToken",{url:"/tk?token&origurl&itemId",parent:"auth",template:"<login-from-token></login-from-token>"}).state("socialCallback",{url:"/ma/socialCallback/:name?code",template:"<social-callback></social-callback>"}).state("resetPassword",{url:"/reset-password?token",template:'<div class="login-page"><reset-password></reset-password></div>'}).state("validateEmail",{url:"/validateEmail?email&token",template:"<validate-email></validate-email>"}).state("wizard",{url:"/wizard",template:'<wizard-panel app-user="appUser" company="selectedCompany"></wizard-panel>',resolve:{appUser:["AuthService","$rootScope","$state","UtilsService",function(e,t,n,a){return r(t),t.gettingCurrentUser=!0,t.gettingCurrentUserErr=void 0,e.getMe().then(function(e){if(e.data&&e.data.id){t.appUser=e.data;var i=a.getSelectedCompany();i&&i.id||(i=!t.appUser.last_visit_company||angular.equals(t.appUser.last_visit_company,{})?t.appUser.userCompany[0]:t.appUser.last_visit_company),a.setSelectedCompany(i)}else n.go("login")},function(e){401===e.status&&n.go("login"),t.gettingCurrentUserErr=void 0}).finally(function(){t.gettingCurrentUser=!1})}]}}).state("subscription",{url:"/subscription",template:'<subscription-panel app-user="appUser"  company="selectedCompany"></subscription-panel>',resolve:{appUser:["AuthService","$rootScope","$state","UtilsService","SubscriptionService",function(e,t,n,a,i){return r(t),t.gettingCurrentUser=!0,t.gettingCurrentUserErr=void 0,e.getMe().then(function(e){if(e.data&&e.data.id){t.appUser=e.data;var o=a.getSelectedCompany();o&&o.id||(o=!t.appUser.last_visit_company||angular.equals(t.appUser.last_visit_company,{})?t.appUser.userCompany[0]:t.appUser.last_visit_company),i.getSubscription(o.id).then(function(e){e.data&&(t.is_valid=e.data.is_valid)}),a.setSelectedCompany(o),i.getSubscription(o.id).then(function(e){if(e&&e.data){e.data.is_valid||n.go("subscription")}})}else n.go("login")},function(e){401===e.status&&n.go("login"),t.gettingCurrentUserErr=void 0}).finally(function(){t.gettingCurrentUser=!1})}]}}).state("reset_wizard",{url:"/reset_wizard",template:'<wizard-panel app-user="appUser" company="selectedCompany" reset-wizard="true"></wizard-panel>',resolve:{appUser:["AuthService","$rootScope","$state","UtilsService",function(e,t,n,a){return r(t),t.gettingCurrentUser=!0,t.gettingCurrentUserErr=void 0,e.getMe().then(function(e){if(e.data&&e.data.id){t.appUser=e.data;var i=a.getSelectedCompany();i&&i.id||(i=!t.appUser.last_visit_company||angular.equals(t.appUser.last_visit_company,{})?t.appUser.userCompany[0]:t.appUser.last_visit_company),a.setSelectedCompany(i)}else n.go("login")},function(e){401===e.status&&n.go("login"),t.gettingCurrentUserErr=void 0}).finally(function(){t.gettingCurrentUser=!1})}]}}).state("backend",{abstract:!0,needsAuth:!0,url:"/b",templateUrl:t+"backend/backend.html",resolve:{appUser:["AuthService","$rootScope","$state","UtilsService","SubscriptionService",function(e,t,n,a,i){return r(t),t.gettingCurrentUser=!0,t.gettingCurrentUserErr=void 0,e.getMe().then(function(e){if(e.data&&e.data.id){t.appUser=e.data;var o=a.getSelectedCompany();o&&o.id||(o=!t.appUser.last_visit_company||angular.equals(t.appUser.last_visit_company,{})?t.appUser.userCompany[0]:t.appUser.last_visit_company),a.setSelectedCompany(o),!o||t.appUser.is_admin||-1===t.appUser.adminOfCompanyIds.indexOf(o.id)||o.has_been_setup&&o.has_done_wizard?i.getSubscription(o.id).then(function(e){if(e&&e.data){e.data.is_valid||t.appUser.is_admin||n.go("subscription")}}):n.go("wizard")}else n.go("login")},function(e){401===e.status&&n.go("login"),t.gettingCurrentUserErr=void 0}).finally(function(){t.gettingCurrentUser=!1})}]}}).state("backend.dashboard",{url:"/dashboard",data:{pageTitle:"{{'DASHBOARD' | translate}}",btn:'<button class="btn btn-success" title="{{\'NOTE.NEW_BTN\' | translate}}" ui-sref="backend.notes_new" ng-if="$root.ITEM_LIMIT && $root.ITEM_LIMIT.is_valid && $root.is_valid"><i class="fa fa-plus"></i> <span translate="NOTE.NEW_BTN" class="hidden-xs hidden-sm"></span></button>'},template:'<dashboard app-user="appUser" company="selectedCompany"></dashboard>',controller:["$scope","SubscriptionService","$rootScope",function(e,t,n){t.getPackage(n.selectedCompany.id).then(function(e){e.data&&e.data.validate_result&&e.data.validate_result.ITEM_LIMIT&&(n.ITEM_LIMIT=e.data.validate_result.ITEM_LIMIT),e.data&&(n.is_valid=e.data.is_valid)}),t.getSubscription(n.selectedCompany.id).then(function(e){e.data&&(n.is_valid=e.data.is_valid)})}]}).state("backend.billing",{url:"/company_billing",data:{pageTitle:"{{'PLAN.SELECT' | translate}}"},template:'<subscription company="selectedCompany"></subscription>'}).state("backend.comments",{url:"/comments",data:{pageTitle:"{{'GROUP_BUYS.COMMENTS.TAB' | translate}}"},template:'<company-comment-list company="selectedCompany"></company-comment-list>'}).state("backend.notes",{url:"/notes",data:{pageTitle:"{{'NOTES' | translate}}",btn:'<button class="btn btn-success" title="{{\'NOTE.NEW_BTN\' | translate}}" ui-sref="backend.notes_new" ng-if="$root.ITEM_LIMIT && $root.ITEM_LIMIT.is_valid && $root.is_valid"><i class="fa fa-plus"></i> <span translate="NOTE.NEW_BTN" class="hidden-xs hidden-sm"></span></button>'},template:'<note-list app-user="appUser" company="selectedCompany"></note-list>',controller:["$scope","SubscriptionService","$rootScope",function(e,t,n){t.getPackage(n.selectedCompany.id).then(function(e){e.data&&e.data.validate_result&&e.data.validate_result.ITEM_LIMIT&&(n.ITEM_LIMIT=e.data.validate_result.ITEM_LIMIT),e.data&&(n.is_valid=e.data.is_valid)}),t.getSubscription(n.selectedCompany.id).then(function(e){e.data&&(n.is_valid=e.data.is_valid)})}]}).state("backend.notes_new",{url:"/notes/new",data:{pageTitle:"{{'NOTE.NEW_BTN' | translate}}",pageSubTitle:['<a translate="NOTES.LIST.TITLE" ui-sref="backend.notes"></a>','<span translate="NOTE.NEW_BTN"></span>']},template:'<note-details-edit-panel app-user="appUser" company="selectedCompany" cancel-func="goToList"></note-details-edit-panel>',controller:["$scope","$state",function(e,t){e.goToList=function(){t.go("backend.notes",{},{reload:!0})}}]}).state("backend.notes_details",{url:"/notes/:id",data:{pageTitle:"{{'NOTE.EDITING' | translate}}",pageSubTitle:['<a translate="NOTES.LIST.TITLE" ui-sref="backend.notes"></a>',"<span>{{$root.editingNote.title}}</span>"],btn:'<item-option-btns app-user="appUser" item="$root.editingNote" item-type="{{\'NOTE\' | translate}}" succ-func="$root.reloadItem" ng-if="$root.editingNote.active === 1 && $root.editingNote && $root.editingNote.id && $root.editingNote.id !==\'\'"></item-option-btns>'},template:'<note-details-edit-panel app-user="appUser" company="selectedCompany" cancel-func="goToList" item="item" item-loaded-func="itemLoaded" cancel-func="goToList"></note-details-edit-panel>',controller:["$scope","$stateParams","$rootScope","$state",function(e,t,n,a){e.item={id:t.id},e.itemLoaded=function(e){n.editingNote=e},e.goToList=function(){a.go("backend.notes",{},{reload:!0})},n.reloadItem=function(e){a.reload()}}]}).state("backend.products",{url:"/products",data:{pageTitle:"{{'PRODUCTS' | translate}}",btn:'<button class="btn btn-success" title="{{\'PRODUCTS.NEW_BTN\' | translate}}" ui-sref="backend.products_new"><i class="fa fa-plus"></i> <span translate="PRODUCTS.NEW_BTN" class="hidden-xs hidden-sm"></span></button>'},template:'<product-list app-user="appUser" company="selectedCompany"></product-list>'}).state("backend.products_new",{url:"/products/new",data:{pageTitle:"{{'PRODUCTS.NEW_BTN' | translate}}",pageSubTitle:['<a translate="PRODUCTS" ui-sref="backend.products"></a>','<span translate="PRODUCTS.NEW_BTN"></span>']},template:'<product-details app-user="appUser" company="selectedCompany" cancel-func="goToList"></product-details>',controller:["$scope","$state",function(e,t){e.goToList=function(){t.go("backend.products",{},{reload:!0})}}]}).state("backend.product_details",{url:"/products/:id",data:{pageTitle:"{{'PRODUCT.EDITING' | translate}}",pageSubTitle:['<a translate="PRODUCTS" ui-sref="backend.products"></a>',"<span>{{$root.editingProduct.title}}</span>"],btn:'<item-option-btns app-user="appUser" item="$root.editingProduct" item-type="{{\'PRODUCT\' | translate}}" succ-func="$root.reloadItem"  ng-if="$root.editingProduct.active === 1 && $root.editingProduct && $root.editingProduct.id && $root.editingProduct.id !==\'\'"></item-option-btns>'},template:'<product-details app-user="appUser" company="selectedCompany" item="item" cancel-func="goToList" item-loaded-func="itemLoaded"></product-details>',controller:["$scope","$stateParams","$rootScope","$state",function(e,t,n,a){e.item={id:t.id},e.itemLoaded=function(e){n.editingProduct=e},e.goToList=function(){a.go("backend.products",{},{reload:!0})},n.reloadItem=function(e){a.reload()}}]}).state("backend.group_buys",{url:"/group_buys",data:{menuItem:"group_buys",pageTitle:"{{'GROUP_BUYS' | translate}}",btn:'<button class="btn btn-success" title="{{\'GROUP_BUYS.CREATE.NEW\' | translate}}" ui-sref="backend.group_buys_new"><i class="fa fa-plus"></i> <span class="hidden-xs hidden-sm">{{\'GROUP_BUYS.CREATE.NEW\'|translate}}</span></button>'},template:'<group-buy-list app-user="appUser" company="selectedCompany"></group-buy-list>'}).state("backend.group_buys_details",{url:"/group_buys/:id",data:{menuItem:"group_buys",pageTitle:"{{'GROUP_BUYS.DESCRIPTION' | translate}}",pageSubTitle:["<a  ui-sref=\"backend.group_buys\">{{'GROUP_BUYS.LIST'|translate}}</a>","<span>{{$root.editingGroupbuy.title}}</span>",'<a href="javascript: void(0)" item-qr-code-popup-btn="$root.editingGroupbuy" class="qrcode"><i class="fa fa-qrcode"></i></a>']},template:'<not-company-admin-panel ng-if="$root.selectedCompany.isCurrentUserAdmin !== true && appUser.is_admin !== true"></not-company-admin-panel><group-buy-details app-user="appUser" company="selectedCompany" item-id="id" cancel-func="goToList" ng-if="$root.selectedCompany.isCurrentUserAdmin === true || appUser.is_admin === true"></group-buy-details>',controller:["$scope","$stateParams","$state",function(e,t,n){e.id=t.id,e.goToList=function(){n.go("backend.group_buys",{},{reload:!0})}}]}).state("backend.group_buys_new",{url:"/new_group_buys",data:{menuItem:"group_buys",pageTitle:"{{'GROUP_BUYS.CREATE.NEW'| translate}}",pageSubTitle:["<a  ui-sref=\"backend.group_buys\">{{'GROUP_BUYS.LIST'|translate}}</a>"]},template:'<not-company-admin-panel ng-if="$root.selectedCompany.isCurrentUserAdmin !== true && appUser.is_admin !== true"></not-company-admin-panel><group-buy-details app-user="appUser" company="selectedCompany" ng-if="$root.selectedCompany.isCurrentUserAdmin === true || appUser.is_admin === true"></group-buy-details>'}).state("backend.events",{url:"/events",data:{menuItem:"events",pageTitle:"{{'EVENTS' | translate}}"},template:'<event-list app-user="appUser" company="selectedCompany"></event-list>'}).state("backend.events_details",{url:"/events/:id",data:{menuItem:"events",pageTitle:"{{'EVENTS.DESCRIPTION' | translate}}",pageSubTitle:["<a  ui-sref=\"backend.events\">{{'EVENTS.LIST'|translate}}</a>","<span>{{$root.editingEvent.title}}</span>",'<a href="javascript: void(0)" item-qr-code-popup-btn="$root.editingEvent" class="qrcode"><i class="fa fa-qrcode"></i> <small translate="EVENTS.DETAILS.QRCODE"></small> </a>'],btn:'<button class="btn btn-primary" event-records-exporter item="$root.editingEvent" app-user="appUser" ><i class="fa fa-paper-plane-o"></i> <span translate="EVENTS.EXPORT.RECORDS" class="hidden-xs"></span></button>'},template:'<not-company-admin-panel ng-if="$root.selectedCompany.isCurrentUserAdmin !== true && appUser.is_admin !== true"></not-company-admin-panel><event-details app-user="appUser" company="selectedCompany" item-id="id" cancel-func="goToList" ng-if="$root.selectedCompany.isCurrentUserAdmin === true || appUser.is_admin === true"></event-details>',controller:["$scope","$stateParams","$state",function(e,t,n){e.id=t.id,e.goToList=function(){n.go("backend.events",{},{reload:!0})}}]}).state("backend.media",{url:"/media",data:{pageTitle:"{{'MEDIA.STATUS' | translate}}"},template:'<media-list app-user="appUser" company="selectedCompany"></media-list>'}).state("backend.vouchers",{url:"/vouchers",data:{pageTitle:"{{'VOUCHERS' | translate}}",pageSubTitle:"<div ng-if=\"$root.displayCounts\">{{'DISPLAY' | translate}}: {{$root.displayCounts}}</div>",btn:'<button class="btn btn-success" title="{{\'NOTE.NEW_BTN\' | translate}}" ui-sref="backend.vouchers_details_new"><i class="fa fa-plus"></i> <span class="hidden-xs hidden-sm" translate="VOUCHER.NEW.BTN"></span></button>'},template:'<voucher-list app-user="appUser" company="$root.selectedCompany"></voucher-list>'}).state("backend.vouchers_details_new",{url:"/new_vouchers",data:{pageTitle:"{{'VOUCHERS' | translate}}",pageSubTitle:["<a  ui-sref=\"backend.vouchers\">{{'VOUCHER_GROUP.LIST' |translate}}</a>"]},template:'<voucher-details app-user="appUser" company="$root.selectedCompany" cancel-func="goToList"></voucher-details>',controller:["$scope","$state",function(e,t){e.goToList=function(){t.go("backend.vouchers",{},{reload:!0})}}]}).state("backend.vouchers_details",{url:"/vouchers/details/:voucherGroupId",data:{pageTitle:"{{'VOUCHERS' | translate}}",pageSubTitle:["<a  ui-sref=\"backend.vouchers\">{{'VOUCHER_GROUP.LIST'|translate}}</a>","<span>{{$root.editingVoucher.title}}</span>"],btn:'<button class="btn btn-success" voucher-group-qr-code-popup-btn voucher="$root.editingVoucher"><i class="fa fa-qrcode"></i> <span translate="QRCODE"></span></button>'},template:'<voucher-details app-user="appUser" company="selectedCompany" voucher-id="id" cancel-func="goToList"></voucher-details>',controller:["$scope","$stateParams",function(e,t){e.id=t.voucherGroupId,e.goToList=function(){$state.go("backend.vouchers",{},{reload:!0})}}]}).state("backend.company_info",{url:"/company_info",data:{pageTitle:"{{'COMPANY_INFO' | translate}}",pageSubTitle:["{{$root.selectedCompany.name}}",'<b ng-if="$root.selectedCompany.is_expired === true" class="text-danger" translate="EXPIRED"></b><span translate="EXPIRY_DATE" ng-if="$root.selectedCompany.is_expired !== true"></span>: {{$root.selectedCompany.admin_config.currentPackageExpireDate | amUtc | amLocal | amDateFormat: \'ll\'}}','<span class="sand-box-flag text-warning" translate="SANDBOX" ng-if="$root.selectedCompany.is_sandbox === true"></span>','<a href="javascript: void(0)" company-qr-code-popup-btn company="$root.selectedCompany" app-user="appUser" class="qrcode"><i class="fa fa-qrcode"></i></a>'],btn:'<div class="btn-toolbar"><button class="btn btn-success" ng-if="$root.appUser.adminOfCompanyIds.indexOf($root.selectedCompany.id) !== -1" ui-sref="reset_wizard">{{\'GET.STARTED\' | translate}}</button>\n<button type="button" class="btn btn-danger" company-delete-btn app-user="appUser" company="$root.selectedCompany"><i class="fa fa-trash"></i> <span translate="COMPANY.DELETE.BTN"></span></button></div>'},template:'<company-editor app-user="appUser" company="$root.selectedCompany"></company-editor>'}).state("backend.company_staff",{url:"/company_staff",data:{pageTitle:"{{'STAFF' | translate}}",pageSubTitle:["{{$root.selectedCompany.name}}","{{'TOTAL' | translate}}: {{$root.displayCounts}}"],btn:'<button class="btn btn-success" title="{{\'STAFF.NEW_BTN\' | translate}}" staff-list-new-item-btn app-user="$root.appUser" company="$root.selectedCompany" ng-if="$root.USER_LIMIT && $root.USER_LIMIT.is_valid && $root.is_valid"><i class="fa fa-plus"></i> <span translate="STAFF.NEW_BTN" class="hidden-xs hidden-sm"></span></button>'},template:'<staff-list app-user="appUser" company="$root.selectedCompany"></staff-list>',controller:["$scope","SubscriptionService","$rootScope",function(e,t,n){t.getPackage(n.selectedCompany.id).then(function(e){e.data&&e.data.validate_result&&e.data.validate_result.USER_LIMIT&&(n.USER_LIMIT=e.data.validate_result.USER_LIMIT),e.data&&(n.is_valid=e.data.is_valid)}),t.getSubscription(n.selectedCompany.id).then(function(e){e.data&&(n.is_valid=e.data.is_valid)})}]}).state("backend.company_channels",{url:"/company_channels",data:{pageTitle:"{{'CHANNEL_INFO' | translate}}",btn:'<button class="btn btn-success" title="{{\'ADD\' | translate}}" channel-list-new-item-btn ng-if="$root.CHANNEL_LIMIT && $root.CHANNEL_LIMIT.is_valid && $root.is_valid"><i class="fa fa-plus"></i> <span translate="CHANNEL.ADD" class="hidden-xs hidden-sm"></span></button>'},template:'<channel-list app-user="appUser" company="$root.selectedCompany"></channel-list>',controller:["$scope","SubscriptionService","$rootScope",function(e,t,n){t.getPackage(n.selectedCompany.id).then(function(e){e.data&&e.data.validate_result&&e.data.validate_result.CHANNEL_LIMIT&&(n.CHANNEL_LIMIT=e.data.validate_result.CHANNEL_LIMIT),e.data&&(n.is_valid=e.data.is_valid)}),t.getSubscription(n.selectedCompany.id).then(function(e){e.data&&(n.is_valid=e.data.is_valid)})}]}).state("backend.channels_new",{url:"/company_channels/new",data:{pageTitle:"{{'CHANNEL_INFO' | translate}}",pageSubTitle:['<a translate="CHANNEL_LIST" ui-sref="backend.company_channels"></a>']},template:'<channel-details-edit-panel app-user="appUser" company="selectedCompany" channel="channel" cancel-func="goToList"></channel-details-edit-panel>',controller:["$scope","$stateParams","$state","$rootScope",function(e,t,n,a){e.channel=t,e.goToList=function(){n.go("backend.company_channels",{},{reload:!0})},e.channelLoaded=function(e){a.editingChannel=e},a.reloadChannel=function(e){n.reload()}}]}).state("backend.channels_details",{url:"/company_channels/:id",data:{pageTitle:"{{'CHANNEL_INFO' | translate}}",pageSubTitle:['<a translate="CHANNEL_LIST" ui-sref="backend.company_channels"></a>']},template:'<channel-details-edit-panel app-user="appUser" company="selectedCompany" channel="channel" cancel-func="goToList"></channel-details-edit-panel>',controller:["$scope","$stateParams","$state","$rootScope",function(e,t,n,a){e.channel=t,e.goToList=function(){n.go("backend.company_channels",{},{reload:!0})},e.channelLoaded=function(e){a.editingChannel=e},a.reloadChannel=function(e){n.reload()}}]}).state("backend.company_create",{url:"/company_create",data:{pageTitle:"{{'COMPANY_CREATE' | translate}}"},template:'<company-create app-user="appUser" ></company-create>'}).state("backend.user_profile",{url:"/user_profile",data:{pageTitle:"{{'USER.PROFILE' | translate}}"},template:'<user-profile app-user="appUser"></user-profile>'}),e},c=function(r,c,u,l){return n=r,a=c,i=u,o=l,t=l.rootDir.views,e=this,i.html5Mode(!0),s(),e};angular.module("shmApp.routes",["ui.router","shmApp.config"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","appConf",c])}(),function(){"use strict";var e,t,n,a=function(a,i,o){e=a,t=i,n=o,t.addPart(n.rootDir.languages),e.useLoader("$translatePartialLoader",{urlTemplate:"{part}{lang}.json"}),e.useLoaderCache("$translationCache"),e.fallbackLanguage(n.default.language),e.preferredLanguage(n.default.language),e.useSanitizeValueStrategy("escapeParameters")};angular.module("shmApp.languages",["pascalprecht.translate"]).config(["$translateProvider","$translatePartialLoaderProvider","appConf",a])}(),function(){"use strict";angular.module("shmApp.config",[]).constant("appConf",function(){var e={};return e.APIs={default:"https://api.showmine66.com/",china:"https://ecs.showmine.com/"},e.apiRegion="default",{appName:"ShowMine",author:{name:"Sysbox Pty Ltd",URL:"http://sysbox.com.au"},rootDir:{views:"app/views/",images:"app/images/",languages:"app/languages/"},stripe_key:"pk_test_NKuikZkEwfjk7gVlp0xEqk7E",url:{api:function(){return e.APIs[e.apiRegion]},web:"http://www.showmine66.com",webAddress:"https://admin.showmine.com",reactAddress:"https://react.showmine66.com"},userRegion:{setAPIRegion:function(t){e.apiRegion=t},checkingAPI:"http://ip-api.com/json/"},localStorageKeyPrefix:"SHM_ADMIN_",default:{momentJs:{locale:"en"},language:"australia"},community:{note:{id:"5c57b138ceb9da7958daba251bdad8f6",name:"CONSULTATION"},group_buy:{id:"552a8c864c2628440e4d85d935b669af",name:"Jie Long"},product:{id:"5d4074718bbed2c47a83bbbb2469b15a",name:"ITEM ADS"}},external_keys:{google_map:"AIzaSyC7TkwBa6hrQAE9mu6s88oIxV70JKsTIXM"}}}())}(),function(){"use strict";var e,t,n,a,i,o,r,s,c,u,l,p,m,d=function(e,t,n,o){var r=function(a,i){var r=this;r.currentSpace=e,r.spaceUsed=t,r.spaceLeft=n,r.fileSize=o,r.cancel=function(){a.dismiss("cancel")}};a.open({animation:!0,templateUrl:i.rootDir.views+"media/alertMediaSize.html",controller:["$uibModalInstance",r],controllerAs:"mdCtrl"})},g=function(n){e.hash(n),t()},f=function(n,a){t.yOffset=a,e.hash(n),t()},v=function(n){e.hash(n),setTimeout(function(){t()},500)},y=function(){g("app-top")},h=function(e){return/^((http[s]?|ftp):\/)?\/?([^:\/\s]+)((\/\w+)*\/)([\w\-\.]+[^#?\s]+)(.*)?(#[\w\-]+)?$/.test(e)},C=function(e){return new RegExp("^data:image/","i").test(e)},b=function(e){return/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(e)},S=function(e){return C(e)||h(e)},I=function(e){var t={};return t.imgSrc=o.getAppAbsUrlRoot(i.imagesRootDir+"item_default.png"),e.thumbnailArray=o.getImgArray(e.images_in_diff_sizes),e&&e.thumbnailArray&&e.thumbnailArray[0]&&!0===S(e.thumbnailArray[0].url)&&(t.imgSrc=e.images[0].url),t.imgSrc},E=function(e){var t={};return t.imgSrc=o.getAppAbsUrlRoot(i.imagesRootDir+"item_default.png"),e&&e.logo_img&&!0===S(e.logo_img.url)&&(t.imgSrc=e.logo_img.url),t.imgSrc},A=function(e,t){var n={};return n.size_name=t||"LARGE",n.imgDefaultSrc=o.getAppAbsUrlRoot(i.imagesRootDir+"item_default.png"),e.thumbnailArray=o.getImgArray(e.images_in_diff_sizes,n.size_name),n.imgSrc=U(e.thumbnailArray,0),null===n.imgSrc?n.imgDefaultSrc:n.imgSrc},U=function(e,t){return e[t]?!0===e[t].mime_type.toLowerCase().startsWith("image")?e[t].url:U(e,1*t+1):null},T=function(e,t,n){return _.contains(e,t)||n},k=function(e){var t={};return t.imgSrc=o.getAppAbsUrlRoot()+"/app/images/default-avatar.png",e&&e.avatar_img&&!0===S(e.avatar_img)&&(t.imgSrc=e.avatar_img),t.imgSrc},w=function(e){return/^\s*$/.test(e)},L=function(e){w(e),n.pageTitle=e},D=function(e){n.pageDescription=e},M=function(t){var n={};return n.relative_path=void 0===t?"":"/"+t,e.protocol()+"://"+e.host()+":"+e.port()+n.relative_path},P=function(t){var n={};return n.exclude_hash=void 0===t||t,!0===n.exclude_hash?e.absUrl().split("#")[0]:e.absUrl()},O=function(t){var n={};if(n.url=s.href(t.name?t.name:t.current.name,t.params,{absolute:!0}),n.queryParams=e.search(),n.queryParams&&Object.keys(n.queryParams).length>0){if(n.parsedUrl=new URL(n.url),n.missingParams={},angular.forEach(n.queryParams,function(e,t){n.parsedUrl.searchParams.has(t)||(n.missingParams[t]=e)}),!(Object.keys(n.missingParams).length>0))return n.url;!0===n.url.includes("?")?n.url=n.url+"&"+c(n.missingParams):n.url=n.url+"?"+c(n.missingParams)}return n.url},$=function(e){return e?String(e).replace(/&nbsp;/gi,"").replace(/<[^>]+>/gm,""):""},x=function(e){return e?e.replace(/[^a-z0-9\u4e00-\u9eff]/gi,"").toLowerCase():""},N=function(e){var t={addressMap:{}};for(t.i=0;t.i<e.address_components.length;t.i++)t.addressType=e.address_components[t.i].types[0],t.addressMap[t.addressType]=e.address_components[t.i].long_name;return t.address={street:(t.addressMap.street_number?t.addressMap.street_number+" ":"")+(t.addressMap.route?t.addressMap.route:""),suburb:t.addressMap.locality?t.addressMap.locality:t.addressMap.colloquial_area?t.addressMap.colloquial_area:"",state:t.addressMap.administrative_area_level_1?t.addressMap.administrative_area_level_1:"",country:t.addressMap.country?t.addressMap.country:"",postcode:t.addressMap.postal_code?t.addressMap.postal_code:""},e.geometry&&e.geometry.location&&(t.address.latitude=e.geometry.location.lat,t.address.longitude=e.geometry.location.lng),t.address},R=function(e){return{formatted_address:(e.street?e.street+", ":"")+(e.suburb?e.suburb+", ":"")+(e.state?e.state+", ":"")+(e.country?e.country+", ":""),address_components:[{long_name:e.street,short_name:e.street,types:["route"]},{long_name:e.suburb,short_name:e.suburb,types:["locality"]},{long_name:e.state,short_name:e.state,types:["administrative_area_level_1"]},{long_name:e.country,short_name:e.country,types:["country"]},{long_name:e.postal_code,short_name:e.postal_code,types:["postcode"]}],geometry:{location:{lat:function(){return e.latitude},lng:function(){return e.longitude}}}}},F=function(e){e||(e="DEFAULT"),a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:i.viewRootDir+"directives/user/subscribeAlert.html",controllerAs:"ctrl",controller:["subscribeType","$uibModalInstance",function(e,t){var n=this;return n.type=e,n.$uibModalInstance=t,n.cancel=function(){n.$uibModalInstance.dismiss("cancel")},n}],resolve:{subscribeType:function(){return e}}})},B=function(e,t){var n={};return n.imgArray=[],n.targetSize=void 0===t?"MID":t,e.origImages?(angular.forEach(e.origImages,function(t,a){if("MID"===n.targetSize)n.midImg=e.midImages[a],n.targetImg=n.midImg?n.midImg:t;else if("SMALL"===n.targetSize)n.smallImg=e.smallImages[a],n.targetImg=n.smallImg?n.smallImg:t;else{if("LARGE"!==n.targetSize)return;n.largeImg=e.largeImages[a],n.targetImg=n.largeImg?n.largeImg:t}n.targetImg.comment=t.comment,n.imgArray.push(n.targetImg)}),n.imgArray):n.imgArray},W=function(e){return r.createHash(e)},z=function(e){try{if(e=e||"",""==e.trim())return!0;return void 0!==angular.element(e).attr("meipian-style")}catch(e){return!1}},V=function(e){var t=_.where(e.tags,{type_id:"b6ff88cde7078468bf1da52e5517d548"});return t&&t.length>0?t[0].name:""},j=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.payment_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].payments||(t[n].payments={}),angular.forEach(e.receipts,function(a){t[n].payments[e.id]||(t[n].payments[e.id]=_.omit(e,"receipts"),t[n].payments[e.id].company=a.item.company),t[n].payments[e.id].items||(t[n].payments[e.id].items={}),t[n].payments[e.id].items[a.item_id]||(t[n].payments[e.id].items[a.item_id]=a.item),t[n].payments[e.id].items[a.item_id].receipts||(t[n].payments[e.id].items[a.item_id].receipts={}),t[n].payments[e.id].items[a.item_id].receipts[a.id]||(t[n].payments[e.id].items[a.item_id].receipts[a.id]=_.omit(a,"item"))})}),t},H=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.trans_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].items&&t[n].items[e.item_id]||(t[n].items={},t[n].items[e.item_id]=e.item),t[n].items[e.item_id].receipts&&t[n].items[e.item_id].receipts[e.id]||(t[n].items[e.item_id].receipts={},t[n].items[e.item_id].receipts[e.id]=_.omit(e,"item"))}),t},G=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.trans_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].items||(t[n].items={}),t[n].items[e.item_id]||(t[n].items[e.item_id]=e.item),t[n].items[e.item_id].receipts||(t[n].items[e.item_id].receipts={}),t[n].items[e.item_id].receipts[e.id]||(t[n].items[e.item_id].receipts[e.id]=_.omit(e,"item"))}),t},Y=function(e){var t={};return angular.forEach(e,function(e){if(e.item&&e.item.company_id){var n=moment(moment.utc(e.trans_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].companies||(t[n].companies={}),t[n].companies[e.item.company.id]||(t[n].companies[e.item.company.id]=e.item.company),t[n].companies[e.item.company.id].items||(t[n].companies[e.item.company.id].items={}),t[n].companies[e.item.company.id].items[e.item_id]||(t[n].companies[e.item.company.id].items[e.item_id]=e.item),t[n].companies[e.item.company.id].items[e.item_id].receipts||(t[n].companies[e.item.company.id].items[e.item_id].receipts={}),t[n].companies[e.item.company.id].items[e.item_id].receipts[e.id]||(t[n].companies[e.item.company.id].items[e.item_id].receipts[e.id]=_.omit(e,"item"))}}),t},Q=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.payment_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].payments||(t[n].payments={}),t[n].payments[e.vendor_payment_group_id]||(t[n].payments[e.vendor_payment_group_id]=e.vendor_payment_group),t[n].payments[e.vendor_payment_group_id].vendors||(t[n].payments[e.vendor_payment_group_id].vendors={}),angular.forEach(e.receipts,function(a){t[n].payments[e.vendor_payment_group_id].vendors[e.id]||(t[n].payments[e.vendor_payment_group_id].vendors[e.id]=_.omit(e,"receipts"),t[n].payments[e.vendor_payment_group_id].vendors[e.id].company=a.item.company),t[n].payments[e.vendor_payment_group_id].vendors[e.id].items||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items={}),t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id]||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id]=a.item),
t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts={}),t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts[a.id]||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts[a.id]=_.omit(a,"item"))})}),t},J=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},q=function(e){var t={modules:{}};return angular.forEach(["group_buy","voucher","note"],function(e){t.modules[e]={create:!1}}),!0===J(e.admin_config)&&(e.admin_config=angular.fromJson(e.admin_config)),e.admin_config&&null!==e.admin_config&&"object"==typeof e.admin_config&&(e.admin_config.is_allow_create_voucher&&!0===e.admin_config.is_allow_create_voucher&&(t.modules.voucher.create=!0),e.admin_config.is_allow_create_news&&!0===e.admin_config.is_allow_create_news&&(t.modules.note.create=!0),e.admin_config.is_allow_create_jielong&&!0===e.admin_config.is_allow_create_jielong&&(t.modules.group_buy.create=!0,e.admin_config.is_allow_multi_pickup&&!0===e.admin_config.is_allow_multi_pickup&&(t.modules.group_buy.pickup_location=!0))),t.modules},K=function(e,t){var a=angular.copy(t);return!0===J(t.config)&&(a.config=angular.fromJson(t.config)),!0===J(t.admin_config)&&(a.admin_config=angular.fromJson(t.admin_config)),t.admin_config||(a.admin_config={}),a.admin_config.currentPackageExpireDate=a.admin_config.currentPackageExpireDate?a.admin_config.currentPackageExpireDate:"2020-12-31 00:00:00",a.admin_config.currentPackage=a.admin_config.currentPackage?a.admin_config.currentPackage:"none",a.modules=q(t),a.isCurrentUserAdmin=e.adminOfCompanyIds&&e.adminOfCompanyIds.indexOf(t.id)>=0,a.isCompanyAdmin=n.appUser.adminOfCompanyIds&&n.appUser.adminOfCompanyIds.indexOf(t.id)>=0,a},X=function(e){if(n.appUser&&n.appUser.userCompany&&0!==n.appUser.userCompany.length)return n.selectedCompany=K(n.appUser,e),u.setItem("selectedCompany_"+n.appUser.id,n.selectedCompany),e&&e.id&&m.setLastVisitCompany(e),o},Z=function(){if(n.appUser&&n.appUser.id)return u.getItem("selectedCompany_"+n.appUser.id)},ee=function(){if(n.appUser&&n.appUser.id)return u.getItem("all_companies_"+n.appUser.id)},te=function(e){if(!n.appUser||!n.appUser.id)return o;u.setItem("all_companies_"+n.appUser.id,e)},ne=function(e){var t=ee();return t&&t.length>0&&(angular.forEach(t,function(n,a){n.id===e.id&&(t[a]=e)}),te(t)),t},ae=function(e){var t=angular.copy(e);return!0===J(e.config)&&(t.config=angular.fromJson(e.config)),t},ie=function(){return moment.utc("9999-12-31 23:59:59")},oe=function(){return moment.utc()},re=function(){return{country:"Australia",postcode:"",state:"Victoria",street:"",suburb:""}},se=function(e,t){return{message:e,errors:t}},ce=function(e){var t={};return t.url=p.trustAsResourceUrl(i.userRegion.checkingAPI),t.params={},e&&(t.params.jsonpCallbackParam=e),l.jsonp(t.url,t.params)},ue=function(_,U,q,ue,le,pe,me,de,ge,fe,ve,ye){return o=this,o.now=moment(),e=_,t=U,n=q,a=ue,i=le,r=pe,s=me,c=de,u=ge,m=ye,l=fe,p=ve,o.isUrl=h,o.getMaxUtcDateTime=ie,o.getNowUtcDateTime=oe,o.getDefaultAddressObj=re,o.isJsonString=J,o.isDataUrl=C,o.isEmail=b,o.isImageUrl=S,o.getItemDefaultImageUrl=I,o.getCompanyDefaultImageUrl=E,o.getUserAvatarImageUrl=k,o.scrollToTop=y,o.scrollTo=g,o.scrollToWithOffset=f,o.delayScrollTo=v,o.setWebTitle=L,o.setWebDescription=D,o.getAppAbsUrlRoot=M,o.getCurrentUrl=P,o.getCurrentUrlFromPageState=O,o.stripHtmlTags=$,o.isBlank=w,o.mapGoogleMapToAddressObj=N,o.buildGooglePlacesResult=R,o.displaySubscribeModal=F,o.getImgArray=B,o.getItemDefaultThumbnailUrl=A,o.md5Hash=W,o.isConvertableToMeiPianStyleHtml=z,o.returnCommunityNameFromItem=V,o.getUrlSafeString=x,o.adminOfCompany=T,o.processMulvendorPayment=j,o.processReceipt=H,o.processAllReceipt=G,o.processAllReceiptAllCompanies=Y,o.processVendorPaymentWithGroupId=Q,o.setSelectedCompany=X,o.getSelectedCompany=Z,o.formatCompany=K,o.getAllStoredCompanies=ee,o.setAllStoredCompanies=te,o.updateCompanyInAllStoredCompanies=ne,o.formatItem=ae,o.getErrorMsgObj=se,o.getUserRegion=ce,o.alertMediaSize=d,o};angular.module("shmApp.services",["angular-md5"]).service("UtilsService",["$location","$anchorScroll","$rootScope","$uibModal","appConf","md5","$state","$httpParamSerializer","StorageService","$http","$sce","AuthService",ue])}(),function(){"use strict";var e,t,n,a,i,o,r,s={},c=function(e){return s.get(r.url.api()+"wechat/js/conf",{params:e})},u=function(e,t){wx&&"function"==typeof wx.config&&(wx.config(t),g(e,t))},l=function(t){return e.md5Hash(t)},p=function(e,a){var i=angular.fromJson(t.localStorage.getItem(r.localStorageKeyPrefix+"wx"));return i||(i={}),i[l(e)]=a,t.localStorage.setItem(r.localStorageKeyPrefix+"wx",angular.toJson(i)),n},m=function(e){var n=angular.fromJson(t.localStorage.getItem(r.localStorageKeyPrefix+"wx"));return n?n[l(e)]:null},d=function(e){var t={};if(t.stored_config=m(e),"object"==typeof t.stored_config&&t.stored_config&&""!==t.stored_config.timestamp&&(t.now_unix_timestamp=Math.floor(Date.now()/1e3),1*t.now_unix_timestamp-1*t.stored_config.timestamp<=7e3))return t.stored_config},g=function(e,t){return p(e,t),n},f=function(e,t){var a=d(e);return a?(u(e,a),t&&t.loaded&&t.loaded(),n):(n.loadingWechatJsConf=!0,n.loadingWechatJsConfErr=void 0,c({url:e}).then(function(n){n.data&&n.data.js&&(u(e,n.data.js),void 0!==t&&y(t))},function(e){n.loadingWechatJsConfErr=e.data}).finally(function(){n.loadingWechatJsConf=!1}),n)},v=function(e){wx&&"function"==typeof wx.ready&&"function"==typeof e&&wx.ready(function(){e()})},y=function(e){jQuery(document).ready(function(){o(function(){wx.ready(function(t){n.weChatJsLoaded=!0,e.menuShareAppMessage&&wx.onMenuShareAppMessage(e.menuShareAppMessage),e.menuShareTimeline&&wx.onMenuShareTimeline(e.menuShareTimeline),e.getLocation&&wx.getLocation({type:"wgs84",success:function(t){"function"==typeof e.getLocation.success&&e.getLocation.success(t)},fail:function(t){"function"==typeof e.getLocation.fail&&e.getLocation.fail(t)}}),e.loaded&&"function"==typeof e.loaded&&e.loaded(t)})},500)})},h=function(){var e={};return e.userAgent=t.navigator.userAgent.toLowerCase(),!!e.userAgent.match(/MicroMessenger/i)},C=function(){var e={};return e.userAgent=t.navigator.userAgent,!!e.userAgent.match(/(iPad|iPhone|iPod)/g)},b=function(){var e={};return e.userAgent=t.navigator.userAgent,!e.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i)},_=function(){var e={};return e.userAgent=t.navigator.userAgent.toLowerCase(),!!e.userAgent.match(/WindowsWechat/i)},S=function(){var e={};return e.userAgent=t.navigator.userAgent.toLowerCase(),!!e.userAgent.match(/Chrome/i)},I=function(){return r.url.web+a.href("auth.getWechatUser",{domain:encodeURIComponent(location.origin),origurl:encodeURIComponent(location.href)},{absolute:!1})},E=function(e){return s.post(r.url.api()+"wechat/me",{state_redirect_obj:e,wechat_auth_url:I()})},A=function(e){return E(e).then(function(e){if(e.data.auth_url)return void(t.location.href=e.data.auth_url)}),n},U=function(e,t,n){return s.get(r.url.api()+"/wechat/authUrl?apiUrl="+r.url.api().slice(0,-1)+"&origUrl="+e+"&authUrl="+t,n)},T=function(e){return s.post(r.url.api()+"wechat/open-platform/generatePreAuthorizationUrl",e)},k=function(e){return s.post(r.url.api()+"wechat/open-platform/bindCompanyWithAppId",e)},w=function(c,u,l,p,m,d,g){return s=c,t=u,e=l,a=p,i=m,o=d,r=g,n=this,n.loadWeChatJsConf=f,n.openedInWeChat=h,n.getAuthPageUrl=I,n.loginAndRedirect=A,n.openInIphone=C,n.openInDesktop=b,n.openInWindowsWechat=_,n.openInGoogleChrome=S,n.runWhenWXReady=v,n.getPreAuthorizationUrl=T,n.bindCompanyWithAppId=k,n.wechatLogin=U,n};angular.module("shmApp.services").service("WeChatService",["$http","$window","UtilsService","$state","$auth","$timeout","appConf",w])}(),function(){"use strict";var e,t,n,a,i={},o=function(t){return i.post(e.url.api()+"user/login",t)},r=function(){a.clear(),t.setToken(""),t.logout()},s=function(){return i.get(e.url.api()+"user/me")},c=function(t){return i.get(e.url.api()+"user/"+t)},u=function(t){return i.put(e.url.api()+"user/me",t)},l=function(t){return i.put(e.url.api()+"user/me/setLastVisitCompany",t)},p=function(t){return i.post(e.url.api()+"user/normal-login",t)},m=function(t){return i.post(e.url.api()+"user/send-reset-email",t)},d=function(t){return i.post(e.url.api()+"user/new-password",t)},g=function(t){return i.post(e.url.api()+"user/confirm-email",t)},f=function(t,n){return i.get(e.url.api()+"wechat/getUser",{params:{code:t,state:n}})},v=function(t){return i.post(e.url.api()+"wechat/web/connect/url",t)},y=function(t,n){return i.get(e.url.api()+"wechat/web/getUser",{params:{code:t,state:n}})},h=function(e){t.setToken(e)},C=function(){return t.getToken()},b=function(){return!!t.isAuthenticated()&&(!n.appUser&&void 0!==n.appUser&&""!=n.appUser.id)},_=function(t){return i.get(e.url.api()+"social-login/"+t)},S=function(t,n){return i.get(e.url.api()+"social-login/"+t+"/callback",{params:{code:n}})},I=function(t,n){return i.get(e.url.api()+"social-login/facebook/companyRedirect")},E=function(t){return i.get(e.url.api()+"social-login/facebook/companyBind",{params:{code:t}})},A=function(t){return i.post(e.url.api()+"user/validateLoginCode",{login_code:t})},U=function(){return i.post(e.url.api()+"user/generateLoginSubscribeQr")},T=function(t,n){return i.get(e.url.api()+"user/checkSubscribeLoginLog/"+t,{params:n})},k=function(k,w,L,D,M){return i=k,e=w,t=L,n=D,a=M,{login:o,loginWithTempCode:A,logout:r,isAuthenticated:b,getWechatLoginUrl:v,getWechatUserFromCode:f,getWechatWebUserFromCode:y,getMe:s,getUser:c,updateMe:u,setAuthToken:h,getAuthToken:C,getSocialMediaLoginRedirectUrl:_,getSocialMediaUserFromCode:S,facebookPageCompanyRedirect:I,facebookPageBindWithCode:E,generateLoginQrCode:U,checkLoginStatus:T,normalLogin:p,sendResetEmail:m,resetPassword:d,setLastVisitCompany:l,confirmEmail:g}};angular.module("shmApp.services").service("AuthService",["$http","appConf","$auth","$rootScope","StorageService",k])}(),function(){"use strict";var e,t,n,a=function(a,i){return e.localStorage.setItem(t.localStorageKeyPrefix+a,angular.toJson(i)),n},i=function(n){var a=e.localStorage.getItem(t.localStorageKeyPrefix+n);return angular.fromJson(a)},o=function(a){return e.localStorage.removeItem(t.localStorageKeyPrefix+a),n},r=function(){return e.localStorage.clear(),n},s=function(s,c){return e=s,t=c,n=this,n.setItem=a,n.getItem=i,n.removeItem=o,n.clear=r,n};angular.module("shmApp.services").service("StorageService",["$window","appConf",s])}(),function(){"use strict";var e,t={},n=function(n){return t.get(e.url.api()+"banner/company/"+n)},a=function(n,a){return t.post(e.url.api()+"banner/company/"+n,{banners:a})},i=function(n,a){return t.put(e.url.api()+"asset/"+n+"/comment",a)},o=function(o,r){return t=o,e=r,{getCompanyBanners:n,createCompanyBanner:a,updateBannerComment:i}};angular.module("shmApp.services").service("BannerService",["$http","appConf",o])}(),function(){"use strict";var e,t={},n=function(n){return t.post(e.url.api()+"company",n)},a=function(n,a){return t.put(e.url.api()+"company/"+n,a)},i=function(n){return t.get(e.url.api()+"company/"+n)},o=function(n){return t.get(e.url.api()+"company/assetsSize/"+n)},r=function(n){return t.get(e.url.api()+"company/mediaSpaceSize/"+n)},s=function(n,a){return t.get(e.url.api()+"company/channelConfig/"+n,{params:a})},c=function(n,a){return t.get(e.url.api()+"company/channelDetails/"+n,{params:a})},u=function(n){return t.post(e.url.api()+"company/channelConfig",n)},l=function(n,a){return t.put(e.url.api()+"company/channelConfig/"+n,a)},p=function(n){return t.delete(e.url.api()+"company/channelConfig/"+n)},m=function(n){return t.put(e.url.api()+"company/accessToken",n)},d=function(n,a,i,o){return t.get(e.url.api()+"company/assets/"+n+"/"+a+"/"+i,{params:o})},g=function(n){return t.post(e.url.api()+"company/"+n+"/genCompanyPageQrCode")},f=function(n,a){return t.post(e.url.api()+"company/"+n+"/approveCompanyStaff",a)},v=function(n){return t.delete(e.url.api()+"company/"+n)},y=function(n){return t.get(e.url.api()+"company",{params:n})},h=function(n,a){return t.get(e.url.api()+"company/user/"+n,{params:a})},C=function(n,a,i){return t.post(e.url.api()+"company/user/"+n+"/"+a,i)},b=function(n,a){return t.post(e.url.api()+"company/admin/"+n,a)},_=function(n,a){return t.delete(e.url.api()+"company/user/"+n+"/"+a)},S=function(n,a,i){return t.put(e.url.api()+"company/user/"+n+"/"+a,i)},I=function(n,a){return t.post(e.url.api()+"company/messages/"+n,a)},E=function(n,a){return t.put(e.url.api()+"company/messages/"+n,a)},A=function(n,a){return t.delete(e.url.api()+"company/messages/"+n,a)},U=function(n,a){return t.get(e.url.api()+"company/messages/"+n,{params:a})},T=function(n,a){return t.get(e.url.api()+"company/messages/list/"+n,{params:a})},k=function(n){return t.post(e.url.api()+"company/fav",{company_id:n})},w=function(n){return t.delete(e.url.api()+"company/fav",{params:{company_id:n}})},L=function(n){return t.get(e.url.api()+"company/fav",{params:n})},D=function(n){return t.get(e.url.api()+"company/section/"+n)},M=function(n,a){return t.post(e.url.api()+"company/section/"+n,{companySection:a})},P=function(n,a){return t.put(e.url.api()+"company/display/"+n,a)},O=function(n,a){return t.post(e.url.api()+"company/sendMessage/"+n,a)},$=function(n){return t.post(e.url.api()+"company/apply",n)},x=function(n){return t.post(e.url.api()+"company/request",n)},N=function(n,a){return t.get(e.url.api()+"company/validateApplication/"+n,{params:a})},R=function(n){return t.post(e.url.api()+"domain",{domain:n})},F=function(n,a){return t.post(e.url.api()+"company/broadcastArticles/"+n,a)},B=function(n){return t.post(e.url.api()+"company/bindFacebook",n)},W=function(n,a){return t.post(e.url.api()+"company/captcha/"+n,a)},z=function(n){return t.get(e.url.api()+"company/location/"+n)},V=function(n,a){return t.post(e.url.api()+"company/location/"+n,a)},j=function(n,a,i){return t.put(e.url.api()+"company/location/"+n+"/"+a,i)},H=function(n,a){return t.delete(e.url.api()+"company/location/"+n+"/"+a)},G=function(n,a){return t.get(e.url.api()+"company/voucher-group/company/"+n,{params:a})},Y=function(n){return t.get(e.url.api()+"company/voucher-group/"+n)},Q=function(n){return t.post(e.url.api()+"company/voucher-group",n)},J=function(n,a){return t.put(e.url.api()+"comment/voucher/"+n+"/markSent",a)},q=function(n){return t.post(e.url.api()+"company/voucher-group/"+n+"/obtainOwnership")},K=function(){return t.post(e.url.api()+"company/voucher-group/fetchVoucherRandomly")},X=function(n){return t.post(e.url.api()+"company/voucher-campaign",n)},Z=function(n){return t.get(e.url.api()+"company/voucher-campaign/"+n)},ee=function(n,a){return t.put(e.url.api()+"company/voucher-campaign/"+n,a)},te=function(n,a){return t.get(e.url.api()+"company/voucher-campaign/company/"+n,{params:a})},ne=function(n){return t.get(e.url.api()+"company/voucher-campaign",{params:n})},ae=function(n){return t.post(e.url.api()+"company/voucher-campaign/"+n+"/fetchVoucherRandomly")},ie=function(n,a){return t.get(e.url.api()+"company/voucher-campaign/"+n+"/voucherUsersUnderCampaign",{params:a})},oe=function(n){return t.get(e.url.api()+"company/voucher-group/companies",{params:n})},re=function(n,a){return t.put(e.url.api()+"company/voucher-group/"+n,a)},se=function(n){return t.get(e.url.api()+"company/paid/companies",{params:n})},ce=function(n){return t.post(e.url.api()+"company/voucher-group/preview",n)},ue=function(n,a){return t.get(e.url.api()+"wechat/card/assignCard/"+n,{params:a})},le=function(n,a){return t.put(e.url.api()+"company/voucher-group/cancel/"+n+"/"+a)},pe=function(n){return t.post(e.url.api()+"company/voucher-group/share/"+n)},me=function(n,a){return t.post(e.url.api()+"company/"+n+"/genAddUserQRCode",a)},de=function(n,a){return t.post(e.url.api()+"company/voucher-group/"+n+"/genVoucherQrCode",a)},ge=function(n){return t.get(e.url.api()+"company/"+n+"/tags")},fe=function(n){return t.get(e.url.api()+"company/"+n+"/articles")},ve=function(n){return t.get(e.url.api()+"company/"+n+"/genSubscriptionQrCode")},ye=function(n,a){return t.get(e.url.api()+"company/"+n+"/getItemsVisitHistory",{params:a})},he=function(he,Ce){return t=he,e=Ce,{deactivateCompany:v,updateInfo:a,createInfo:n,getCompanyDetails:i,getCompanyAssetsSize:o,getCompanyAssets:d,createNewCompanyUser:C,getUserList:h,deleteCompanyUser:_,updateCompanyUser:S,getAllCompanies:y,updateComment:E,addCommentToAnCompany:I,deleteCompanyComment:A,getCompanyComments:T,markAsFavourite:k,removeAsFavourite:w,getFavCompanies:L,getACompanyComment:U,getCompanySections:D,createCompanySections:M,displayCompanyItems:P,applyCompany:$,sendRequest:x,checkApplicationStatus:N,getByDomain:R,broadcastItemsToWechat:F,bindFacebookWithPage:B,sendMessageToCompany:O,createCaptcha:W,getCompanyPickupLocations:z,createCompanyPickupLocation:V,updateCompanyPickupLocation:j,deleteCompanyPickupLocation:H,getVoucherGroupsUnderCompany:G,getVoucherGroupById:Y,createCompanyVoucherGroup:Q,markVoucherSent:J,obtainVoucherOwnership:q,obtainRandomVoucherOwnership:K,createCompanyVoucherCampaign:X,getCompanyVoucherCampaignDetails:Z,updateCompanyVoucherCampaignDetails:ee,getCompanyCampaignList:te,getAllCampaignList:ne,obtainRandomVoucherUnderCampaign:ae,getCampaignUsersLists:ie,getCompaniesWithVoucherGroups:oe,updateCompanyVoucherGroup:re,getPaidCompanies:se,previewVoucher:ce,assignCard:ue,cancelCompanyVoucherGroup:le,sendWeChatNewsOfVoucherGroup:pe,genAddUserQRCode:me,getCompanyQrcodes:g,genVoucherQrCode:de,approveCompanyStaff:f,getCompanyTags:ge,getCompanyMediaSpaceSize:r,createChannelConfig:u,deleteChannelConfig:p,saveChannelConfig:l,getChannelConfig:s,getChannelDetails:c,getAccessToken:m,getNumberOfArticlesUnderCompany:fe,addNewCompanyAdmin:b,getSubscriptionQrCode:ve,getItemsVisitHistory:ye}};angular.module("shmApp.services").service("CompanyService",["$http","appConf",he])}(),function(){"use strict";var e,t={},n=function(n,a){return t.get(e.url.api()+"item/seller/"+n,{params:a})},a=function(n){return t.get(e.url.api()+"item/"+n)},i=function(n){return t.get(e.url.api()+"item/"+n+"/syncRecord")},o=function(n,a){return t.get(e.url.api()+"item/"+n+"/syncStatus/"+a+"/company")},r=function(n){return t.post(e.url.api()+"item",n)},s=function(n,a){return t.put(e.url.api()+"item/"+n,a)},c=function(n){return t.post(e.url.api()+"payment/receipt",n)},u=function(n,a){return t.post(e.url.api()+"comment/item/"+n,a)},l=function(n,a){return t.post(e.url.api()+"comment/"+n+"/channel",{comment:a})},p=function(n,a){return t.post(e.url.api()+"jielong/"+n+"/subitems",a)},m=function(n,a){return t.put(e.url.api()+"jielong/"+n+"/subitems",a)},d=function(n,a){return t.get(e.url.api()+"comment/item/"+n,{params:a})},g=function(n,a){return t.get(e.url.api()+"comment/item/normal/message/"+n,{params:a})},f=function(n,a){return t.get(e.url.api()+"comment/company/"+n,{params:a})},v=function(n,a){return t.get(e.url.api()+"jielong/isInJielong/"+n,a)},y=function(n,a){return t.get(e.url.api()+"jielong/getAllJielong/"+n,a)},h=function(n,a){return t.put(e.url.api()+"comment/"+n,a)},C=function(n,a){return t.get(e.url.api()+"comment/"+n,a)},b=function(n,a){return t.delete(e.url.api()+"comment/"+n,{params:a})},_=function(n,a){return t.delete(e.url.api()+"comment/"+n+"/channel",{params:a})},S=function(n,a){return t.get(e.url.api()+"comment/"+n+"/channel",{params:a})},I=function(n){return t.get(e.url.api()+"item/search",{params:n})},E=function(n,a){return t.get(e.url.api()+"item/community/"+n,{params:a})},A=function(n,a){return t.get(e.url.api()+"item/company/"+n,{params:a})},U=function(n,a){return t.get(e.url.api()+"item/company/"+n+"/onlinePayment",{params:a})},T=function(n,a){return t.get(e.url.api()+"item/company/"+n+"/consultation",{params:a})},k=function(n,a){return t.get(e.url.api()+"item/company/"+n+"/product",{params:a})},w=function(n,a){var i={};return i.parameters=a||{},i.parameters.community_id=e.community.group_buy.id,t.get(e.url.api()+"item/company/"+n,{params:i.parameters})},L=function(n,a){return t.put(e.url.api()+"item/"+n+"/end",a)},D=function(n,a){return t.put(e.url.api()+"item/"+n+"/sold",a)},M=function(n,a){return t.delete(e.url.api()+"item/"+n,a)},P=function(n,a){return t.post(e.url.api()+"item/"+n+"/abuse",a)},O=function(n,a){return t.get(e.url.api()+"item/"+n+"/pushTimes",a)},$=function(n,a){return t.put(e.url.api()+"item/"+n+"/push",a)},x=function(){return t.get(e.url.api()+"tag/predefined")},N=function(n){return t.get(e.url.api()+"jielong/blacklist",{params:n})},R=function(n){return t.get(e.url.api()+"jielong/blacklist/blacklistdetails",{params:n})},F=function(n){return t.get(e.url.api()+"utils/places-overseas",n)},B=function(n){return t.get(e.url.api()+"utils/geoip/isFromChina",n)},W=function(n,a,i){return t.post(e.url.api()+"item/poster/"+n,{url:a,is_showing_all_imgs:i})},z=function(n,a){return t.post(e.url.api()+"item/checkinqr/"+n,{url:a})},V=function(n,a){return t.post(e.url.api()+"item/checkin/"+n,{url:a})},j=function(n,a){return t.put(e.url.api()+"item/"+n+"/seller",{seller_id:a})},H=function(n,a){return t.get(e.url.api()+"item/"+n+"/guessYouLikeByTags",{params:a})},G=function(n){return t.get(e.url.api()+"item/guessYouLike",{params:n})},Y=function(n){return t.get(e.url.api()+"item/history",{params:n})},Q=function(n){return t.post(e.url.api()+"item/clone/"+n)},J=function(n,a){var i=a||{};return i.item_id=n,t.post(e.url.api()+"item/fav",i)},q=function(n,a){var i=a||{};return i.item_id=n,t.delete(e.url.api()+"item/fav",{params:i})},K=function(n){return t.get(e.url.api()+"item/fav",{params:n})},X=function(n){return t.get(e.url.api()+"item/propertytype",{params:n})},Z=function(n){return t.get(e.url.api()+"comment/voucher/"+n)},ee=function(n){return t.get(e.url.api()+"comment/voucher/"+n+"/validate")},te=function(n,a){return t.post(e.url.api()+"comment/voucher/"+n,a)},ne=function(n,a){return t.post(e.url.api()+"comment/voucher/"+n+"/subitems",a)},ae=function(n){return t.get(e.url.api()+"comment/voucher",{params:n})},ie=function(n,a){return t.put(e.url.api()+"jielong/checkin/finish/"+n,a)},oe=function(n){return t.get(e.url.api()+"item/topVisited",{params:n})},re=function(n){return t.get(e.url.api()+"item/getItemsWithSpeicalTags",{params:n})},se=function(n,a){return t.get(e.url.api()+"item/company/getItemsWithCompanyTags/"+n,{params:a})},ce=function(n,a){return t.post(e.url.api()+"/jielong/"+n+"/genReportEmail",a)},ue=function(n,a,i){return t.get(e.url.api()+"comment/item/"+n+"/"+a,{params:i})},le=function(n,a){return t.post(e.url.api()+"item/"+n+"/facebook",{params:a})},pe=function(n,a){return t.post(e.url.api()+"item/"+n+"/wordpress",{params:a})},me=function(e){return e&&e.id?1!==parseInt(e.active)?"DEACTIVATED":!0===e.is_sold?"SOLD":!0===e.is_ended?"ENDED":1==e.is_draft?"DRAFT":!0===e.is_expired?"EXPIRED":!0!==e.is_published?"NOT_STARTED":"ACTIVE":""},de=function(n,a){return t.get(e.url.api()+"item/company/validateItemLimit/"+n,{params:a})},ge=function(n,a){return t.get(e.url.api()+"item/"+n+"/history",{params:a})},fe=function(n,a){return t.post(e.url.api()+"item/"+n+"/history",{params:a})},ve=function(n){return t.post(e.url.api()+"item/"+n+"/genItemQrCode")},ye=function(ye,he){return t=ye,e=he,{getItemsForASeller:n,searchItems:I,searchItemsUnderCommunity:E,searchItemsUnderCompany:A,addCommentToAnItem:u,createItem:r,updateItem:s,createReceipt:c,getCommentsForAnItem:d,getNormalCommentsForAnItem:g,getCommentsForCompany:f,getItemDetails:a,reportItemAbuse:P,getLeftPushTimes:O,pushItem:$,markItemEnd:L,markItemSold:D,markItemDeactivate:M,getPredefinedTags:x,getPlacesOverseas:F,generateItemPoster:W,getIsFromChina:B,guessCurrentUserLike:G,guessUserLikeByTags:H,updateComment:h,getComment:C,setCommentsDeactivate:b,getMyHistory:Y,getFavItems:K,cloneItem:Q,markAsFavourite:J,removeAsFavourite:q,updateSeller:j,getIsInJielong:v,getAllJielong:y,generateCheckinQRCode:z,generateCheckinPoster:V,getPropertyTypes:X,getVoucherDetails:Z,checkinVoucher:te,checkinVoucherWithSubItems:ne,getMyVouchers:ae,terminateJielong:ie,getTopVisitItemsList:oe,addJielongToAnItemWithKids:p,updateJielongToAnItemWithKids:m,getItemStatusName:me,searchItemsUnderCompanyOnlyForProduct:k,searchItemsUnderCompanyOnlyForGroupBuy:w,searchBlackList:N,getItemsWithSpeicalTags:re,getBlackListDetails:R,getItemsWithCompanyTags:se,checkIfComanyUpperTheItemLimit:de,searchItemsUnderCompanyWithOnlinePayment:U,validateVoucherWhenNoUser:ee,genJielongReportEmail:ce,searchItemsUnderCompanyOnlyForConsultation:T,getItemHistories:ge,setItemHistories:fe,updateJielongReportLocationData:ue,pushToFacebook:le,pushToWordpress:pe,getItemQrCodes:ve,getSyncRecords:i,getSyncStatus:o,deleteChannelComment:_,addChannelComment:l,getChannelComments:S}};angular.module("shmApp.services").service("ItemService",["$http","appConf",ye])}(),function(){"use strict";var e,t,n,a,i,o=["simplified-chinese","australia"],r=function(t){return e.use(t),"simplified-chinese"===t?a.changeLocale("zh-cn"):"australia"===t&&a.changeLocale("en"),i.setItem("selected-language",t),n},s=function(){var t={};return t.langKey=i.getItem("selected-language"),t.langKey&&null!==t.langKey&&""!==t.langKey||(t.langKey=e.use()),t.langKey},c=function(){return o},u=function(o,u,l,p){return e=o,t=u,a=l,i=p,n=this,n.switchLanguage=r,n.getLocalLanguageKey=s,n.getSupportedLanguages=c,n};angular.module("shmApp.services").service("LanguageService",["$translate","appConf","amMoment","StorageService",u])}(),function(){"use strict";var e,t,n,a=function(){var e=document.createElement("script");e.src="https://ditu.google.cn/maps/api/js?libraries=places&key="+n.external_keys.google_map+"&callback=initialize",e.async="",e.defer="",document.body.appendChild(e)},i=function(i,o,r){e=i,t=o,n=r;var s=t.defer();return e.initialize=function(){s.resolve()},a(),s.promise};angular.module("shmApp.services").service("loadGoogleMapLib",["$window","$q","appConf",i])}(),function(){"use strict";var e,t,n={},a={width:1200,height:8e3,quality:.8},i=function(e){return n.post(t.url.api()+"asset/wechat",e)},o=function(e,a){return n.put(t.url.api()+"asset/"+e+"/comment",a)},r=function(n){return e.upload({url:t.url.api()+"asset",file:n})},s=function(e){return n.post(t.url.api()+"asset/based64",e)},c=function(t){return e.resize(t,a)},u=function(e){return n.delete(t.url.api()+"asset/"+e)},l=function(a,l,p){return n=a,t=p,e=l,{uploadThoughWechat:i,updateAssetComment:o,uploadAsset:r,imgResize:c,uploadBase64Asset:s,deleteAsset:u}};angular.module("shmApp.services").service("AssetService",["$http","Upload","appConf",l])}(),function(){"use strict";var e,t={},n=function(n){return t.get(e.url.api()+"company/createSetupIntent/"+n)},a=function(n){return t.put(e.url.api()+"company/paymentMethod",n)},i=function(n){return t.get(e.url.api()+"company/package/"+n)},o=function(n){return t.get(e.url.api()+"company/package?companyId="+n)},r=function(n){return t.get(e.url.api()+"company/subscription/"+n)},s=function(n){return t.put(e.url.api()+"company/subscription",n)},c=function(n,a){return t.delete(e.url.api()+"company/subscription/"+n,{params:a})},u=function(n){return t.get(e.url.api()+"company/"+n+"/invoice")},l=function(l,p){return t=l,e=p,{createSetupIntent:n,addPaymentMethod:a,getPackage:i,getAllPackages:o,getSubscription:r,updateSubscription:s,cancelSubscription:c,getAllInvoices:u}};angular.module("shmApp.services").service("SubscriptionService",["$http","appConf",l])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<"},template:"",link:function(n,a,i){n.updateElement=function(t){a.empty();var i={};t.data.pageTitle&&(i.pageTitle=angular.element('<div class="title"></div>'),i.pageTitle.append(t.data.pageTitle),e(i.pageTitle)(n),a.append(i.pageTitle)),t.data.pageSubTitle&&(i.subTitle=angular.element('<div class="subtitle"></div>'),angular.isArray(t.data.pageSubTitle)?angular.forEach(t.data.pageSubTitle,function(e){i.subTitle.append('<div class="subtitle-part">'+e+"</div>")}):i.subTitle.append('<div class="subtitle-part">'+t.data.pageSubTitle+"</div>"),e(i.subTitle)(n),a.append(i.subTitle)),t.data.btn&&(i.btnWrapper=angular.element('<div class="btn-wrapper"></div>'),i.btnWrapper.append('<div class="btn-part">'+t.data.btn+"</div>"),e(i.btnWrapper)(n),a.append(i.btnWrapper))},n.$on("$stateChangeSuccess",function(e,t,a,i,o){n.updateElement(t)}),n.updateElement(t.current)}}};angular.module("shmApp.directives").directive("backendPageTitle",["$compile","$state",e])}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{appUser:"<?"},templateUrl:e.rootDir.views+"backend/bottomMenu.html"}};angular.module("shmApp.directives").directive("bottomMenu",["appConf",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<"},templateUrl:e.rootDir.views+"backend/brandDiv.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("brandDiv",["appConf","$rootScope",e])}(),function(){"use strict";var e=function(){return[{name:"DASHBOARD",icon:"fa fa-dashboard",state:"backend.dashboard"},{sectionName:"COMPONENTS"},{name:"NOTES",icon:"fa fa-file",state:"backend.notes"},{name:"GROUP_BUYS.COMMENTS.TAB",icon:"fa fa-comments",state:"backend.comments"},{name:"MEDIA",icon:"fa fa-photo",state:"backend.media"}]},t=function(){return[{sectionName:"MY_COMPANY"},{name:"COMPANY_INFO",icon:"fa fa-cog",state:"backend.company_info"},{name:"COMPANY_BILL",icon:"fa fa-receipt",state:"backend.billing"},{name:"CHANNEL_INFO",icon:"fa fa-sliders",state:"backend.company_channels"},{name:"STAFF",icon:"fa fa-users",state:"backend.company_staff"}]},n=function(){return[{sectionName:"SUPER_ADMIN"},{name:"COMPANY_CREATE",icon:"fa fa-plus-square",state:"backend.company_create"}]},a=function(a,i,o,r,s){return{restrict:"AE",scope:{appUser:"<?"},templateUrl:a.rootDir.views+"backend/mainMenu.html",link:function(a,c,u){a.navigateTo=function(e){i.go(e),a.openedInWechat=s.openedInWeChat()||s.openInWindowsWechat(),a.openedInWechat&&(o.showMinLeftMenu=!0,r.setItem("showMinLeftMenu",!0))},a.currentStateName=i.current.name,a.$on("$stateChangeSuccess",function(e,t,n,i,o){a.currentStateName=t.name}),a.adminMenuItems=[],(o.appUser.adminOfCompanyIds.indexOf(o.selectedCompany.id)>-1||!0===o.appUser.is_admin)&&(a.adminMenuItems=t()),a.superAdminMenuItems=[],a.appUser.is_admin&&(a.superAdminMenuItems=n()),a.menuItems=e().concat(a.adminMenuItems).concat(a.superAdminMenuItems)}}};angular.module("shmApp.directives").directive("mainMenu",["appConf","$state","$rootScope","StorageService","WeChatService",a])}(),function(){"use strict";var e=function(e,t,n){return{restrict:"AE",scope:{appUser:"<"},templateUrl:e.rootDir.views+"backend/toggleLeftMenuWidthBtn.html",link:function(e,a,i){e.toggleMinLeftMenu=function(){t.showMinLeftMenu=!0!==t.showMinLeftMenu,n.setItem("showMinLeftMenu",t.showMinLeftMenu)},t.showMinLeftMenu=n.getItem("showMinLeftMenu")}}};angular.module("shmApp.directives").directive("toggleLeftMenuWidthBtn",["appConf","$rootScope","StorageService",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{appUser:"<?",isWizard:"<?"},templateUrl:e.rootDir.views+"backend/topMenu.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("topMenu",["appConf","$uibModal","toastr","$translate",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"banner/bannerList.html",link:function(e,n,a){e.getBanners=function(){e.gettingBanners=!0,e.gettingBannersErr=void 0,t.getCompanyBanners(e.company.id).then(function(t){e.banners=t.data},function(t){e.gettingBannersErr=t.data}).finally(function(){e.gettingBanners=void 0})},e.saveCompanyBanners=function(n){if(n){var a={};a.comment=n.asset.comment||"",e.savingBanners=!0,e.savingBannerErr=void 0,t.updateBannerComment(n.asset.id,a).then(function(e){},function(t){e.savingCommentErr=t.data})}t.createCompanyBanner(e.company.id,e.banners).then(function(e){},function(t){e.savingBannerErr=t.data}).finally(function(){
e.savingBanners=void 0})},e.removeBannerFromBanners=function(t){e.banners=_.without(e.banners,t),e.saveCompanyBanners()},e.getBanners(),e.canEdit=!0===e.company.isCompanyAdmin||!0===e.appUser.is_admin}}};angular.module("shmApp.directives").directive("bannerList",["appConf","BannerService",e])}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{appUser:"<",banner:"<",company:"<",editMode:"<?",callBackSave:"&?",callBackDelete:"&?"},templateUrl:e.rootDir.views+"banner/bannerListItem.html",link:function(e,t,n){e.goEditMode=function(){e.editMode=!0},e.cancelEditMode=function(){angular.copy(e.banner,e.tmpBanner),e.editMode=!1},e.saveChange=function(){e.editMode=!1,e.tmpBanner.asset.id===e.banner.asset.id&&e.tmpBanner.link_to===e.banner.link_to&&e.tmpBanner.asset.comment===e.banner.asset.comment||(angular.copy(e.tmpBanner,e.banner),e.callBackSave()(e.banner))},e.deleteBanner=function(){e.callBackDelete(e.banner)},e.editMode=!1,e.canEdit=!0===e.company.isCompanyAdmin||!0===e.appUser.is_admin,e.tmpBanner=angular.copy(e.banner)}}};angular.module("shmApp.directives").directive("bannerListItem",["appConf",e])}(),function(){"use strict";var e=function(e,t,n,a){var i=this;i.appUser=t,i.company=n,i.banners=a,i.newBanner={link_to:"",asset:{}},i.assetArray=[],i.cancel=function(){e.dismiss("cancel")},i.save=function(){if(!i.assetArray[0]||!i.assetArray[0].id)return i.newBannerErr=!0,!1;i.newBanner.asset=i.assetArray[0],i.banners.push(i.newBanner),e.close(i.newBanner)}},t=function(t,n){return{restrict:"A",scope:{appUser:"<",company:"<",banners:"<",succFunc:"&?"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"banner/bannerCreatePanel.html",controller:["$uibModalInstance","appUser","company","banners",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return a.appUser},company:function(){return a.company},banners:function(){return a.banners}}}).result.then(function(e){"function"==typeof a.succFunc&&"function"==typeof a.succFunc()&&a.succFunc()(e)})})}}};angular.module("shmApp.directives").directive("bannerCreatePanel",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n){var a=this;a.appUser=t,a.banner=n,a.cancel=function(){e.dismiss("cancel")},a.delete=function(){e.close()}},t=function(t,n){return{restrict:"A",scope:{appUser:"<",banner:"=",confirmFunc:"&?"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"banner/bannerDeleteConfirmBtn.html",controller:["$uibModalInstance","appUser","banner",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return a.appUser},banner:function(){return a.banner}}}).result.then(function(){"function"==typeof a.confirmFunc&&"function"==typeof a.confirmFunc()&&a.confirmFunc()()})})}}};angular.module("shmApp.directives").directive("bannerDeleteConfirmBtn",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<",fromWizard:"<",hasChannel:"&?"},templateUrl:e.rootDir.views+"channel/channelList.html",link:function(e,n,a){var i={showAll:!0};e.compare=function(e,t){var n=e.name.toUpperCase(),a=t.name.toUpperCase(),i=0;return n>a?i=1:n<a&&(i=-1),i},t.getChannelConfig(e.company.id,i).then(function(t){t&&t.data&&t.data.length>0&&(e.channels=t.data.sort(e.compare),e.fromWizard&&e.hasChannel(),e.wp=e.channels.filter(function(e){return"WordPress"===e.type}))})}}};angular.module("shmApp.directives").directive("channelList",["appConf","CompanyService","$rootScope","toastr","$translate","SubscriptionService",e])}(),function(){"use strict";var e=function(e,t,n,a,i){return{restrict:"AE",scope:{appUser:"<",channel:"<",index:"<",remove:"<"},templateUrl:e.rootDir.views+"channel/channelGridItem.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("channelGridItem",["appConf","CompanyService","$rootScope","toastr","$translate",e])}(),function(){"use strict";var e=function(e,t,n){var a=this;a.deleteChannel=t,a.channel=n,a.cancel=function(){e.dismiss("cancel")},a.delete=function(){e.dismiss("cancel"),t(a.channel)}},t=function(e,t,n,a,i){var o=this;o.channel=t,o.gettingDetails=n,o.saveChannel=a,o.selectCategory=i,o.cancel=function(){e.dismiss("cancel")},o.save=function(e){console.log(e),o.saveChannel(e),o.cancel()}},n=function(n,a,i,o,r,s,c,u,l,p,m){return{restrict:"AE",scope:{appUser:"<",company:"<",channel:"=?",cancelFunc:"&?",itemLoadedFunc:"&?",succFunc:"&?",fromWizard:"&?"},templateUrl:n.rootDir.views+"channel/channelDetailsEditPanel.html",link:function(a,i,o){a.cancel=function(){s.transitionTo("backend.company_channels")},a.selectCategory=function(e){a.channel.credential.categories.includes(e.name)?a.channel.credential.categories.splice(a.channel.credential.categories.indexOf(e.name),1):a.channel.credential.categories.push(e.name)},a.selectPage=function(e){a.channel.credential.selectedPages.includes(e.id)?a.channel.credential.selectedPages.splice(a.channel.credential.selectedPages.indexOf(e.id),1):a.channel.credential.selectedPages.push(e.id)},a.selectLocation=function(e){a.channel.credential.selectedLocations.includes(e.name)?a.channel.credential.selectedLocations.splice(a.channel.credential.selectedLocations.indexOf(e.name),1):a.channel.credential.selectedLocations.push(e.name)},a.setMainChannel=function(){a.channel.isMainChannel=!a.channel.isMainChannel},a.getChannelDetails=function(e){a.channel&&a.channel.id?(a.gettingDetails=!0,a.gettingDetailsErr=void 0,l.getChannelDetails(a.channel.id).then(function(e){a.channel=e.data,a.channel.credential.categories=a.channel.credential.categories?a.channel.credential.categories:[],a.channel.credential.selectedPages=a.channel.credential.selectedPages?a.channel.credential.selectedPages:[],a.channel.credential.locations=a.channel.credential.locations?a.channel.credential.locations:[],a.channel.credential.selectedLocations=a.channel.credential.selectedLocations?a.channel.credential.selectedLocations:[]},function(e){a.gettingDetailsErr=e.data}).finally(function(){a.gettingDetails=void 0,a.channel&&"WordPress"===a.channel.type&&a.channel.credential.categories&&0===a.channel.credential.categories.length&&a.openModal()})):a.channel={company_id:a.company.id}},a.channelTypes=["Showmine","Facebook","Google","LinkedIn","Magento","Twitter","WeChat","WordPress"],a.setType=function(e){a.channel.credential={},a.channel.name=a.channel.type,"WordPress"!==a.channel.type&&a.openModal()},a.deleteChannel=function(e){a.gettingDetails=!0,e.id&&l.deleteChannelConfig(e.id).then(function(e){a.gettingDetails=!1}),s.go("backend.company_channels",{},{reload:!0})},a.removeChannel=function(t){m.open({animation:!0,templateUrl:n.rootDir.views+"deleteBtn.html",controller:["$uibModalInstance","deleteChannel","channel",e],controllerAs:"mdCtrl",resolve:{deleteChannel:function(){return a.deleteChannel},channel:function(){return a.channel}}})},a.saveChannel=function(e){a.gettingDetails=!0,e.id?l.saveChannelConfig(e.id,e).then(function(t){t.data.url&&window.open(t.data.url,"_self"),1==t.data.success&&(a.gettingDetails=!1,e.valid=1,c.success(u.instant("ITEM.UPDATE.SUCCESSFULLY")))},function(e){a.gettingDetails=!1,a.errorMsg=e.data}):l.createChannelConfig(e).then(function(t){t.data.url&&window.open(t.data.url,"_self"),1==t.data.success&&(a.gettingDetails=!1,e.valid=1,c.success(u.instant("ITEM.UPDATE.SUCCESSFULLY")),a.fromWizard?s.go("backend.dashboard",{},{reload:!0}):s.go("backend.channels_details",{id:t.data.channel.id},{}))},function(t){a.gettingDetails=!1,a.errorMsg=t.data,e.valid=0})},a.getChannelDetails(),a.openModal=function(){m.open({animation:!0,templateUrl:n.rootDir.views+"channel/channelEdit.html",controller:["$uibModalInstance","channel","gettingDetails","saveChannel","selectCategory",t],controllerAs:"mdCtrl",resolve:{channel:function(){return a.channel},gettingDetails:function(){return a.gettingDetails},saveChannel:function(){return a.saveChannel},selectCategory:function(){return a.selectCategory}}})}}}};angular.module("shmApp.directives").directive("channelDetailsEditPanel",["appConf","ItemService","UtilsService","$rootScope","$interval","$state","toastr","$translate","CompanyService","WeChatService","$uibModal",n])}(),function(){"use strict";var e=function(e,t,n){return{restrict:"A",scope:{appUser:"<",company:"<"},link:function(e,t,a){t.on("click",function(){n.go("backend.channels_new",{},{reload:!0})})}}};angular.module("shmApp.directives").directive("channelListNewItemBtn",["appConf","$uibModal","$state",e])}(),function(){"use strict";var e=function(e,t,n,a,i){var o=this;o.appUser=t,o.company=n,o.cancel=function(){e.dismiss("cancel")},o.delete=function(){return o.company_name&&""!==o.company_name?o.company_name!==o.company.name?void(o.deletingErr={message:i.instant("COMPANY.DELETE.ERROR.NAME_DIFFERENT")}):(o.deleting=!0,o.deletingErr=void 0,void a.deactivateCompany(o.company.id).then(function(t){e.close(t.data)},function(e){o.deletingErr=e.data}).finally(function(){o.deleting=void 0})):void(o.deletingErr={message:i.instant("COMPANY.DELETE.ERROR.NAME_REQUIRED")})}},t=function(t,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<"},link:function(o,r,s){r.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"company/companyDeleteConfirmPanel.html",controller:["$uibModalInstance","appUser","company","CompanyService","$translate",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return o.appUser},company:function(){return o.company}}}).result.then(function(e){n.setSelectedCompany(e),n.updateCompanyInAllStoredCompanies(e),i.location.reload()})})}}};angular.module("shmApp.directives").directive("companyDeleteBtn",["appConf","UtilsService","$uibModal","$window",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"company/companyEditor.html",link:function(e,t,r){e.enterCompany=function(e){e.currentTarget.blur()},e.saveCompany=function(){var t={};t.company=a.formatCompany(e.appUser,e.company),t.originalCompanyString=JSON.stringify(e.originalCompany),t.companyString=JSON.stringify(t.company),t.companyString!==t.originalCompanyString&&(e.savingCompany=!0,e.savingCompanyErr=void 0,"object"==typeof e.company.config&&(t.company.config=JSON.stringify(t.company.config)),"object"==typeof e.company.admin_config&&(t.company.admin_config=JSON.stringify(t.company.admin_config)),n.updateInfo(e.company.id,t.company).then(function(t){e.company=a.formatCompany(e.appUser,t.data),a.setSelectedCompany(e.company),a.updateCompanyInAllStoredCompanies(e.company),e.originalCompany=angular.copy(e.company),i.success(o.instant("COMPANY.SAVED_SUCCESSFULLY"))},function(t){e.savingCompanyErr=t.data,i.error(o.instant(e.savingCompanyErr.message))}).finally(function(){e.savingCompany=void 0}))},e.companyAuthorInfo=e.company.config&&e.company.config.authorInfo,e.company=a.formatCompany(e.appUser,e.company),e.canAccess=!0===e.company.isCurrentUserAdmin||!0===e.appUser.is_admin,e.originalCompany=angular.copy(e.company)}}};angular.module("shmApp.directives").directive("companyEditor",["appConf","$rootScope","CompanyService","UtilsService","toastr","$translate",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o,r,s){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"company/companyCreate.html",link:function(e,c,u){e.company={},e.company.admin_config={},e.company.media_space_size=1,e.company.admin_config.userLimit=1,e.enterCompany=function(e){e.currentTarget.blur()},e.createCompany=function(){var c={};c.company=e.company,e.company.config&&(e.company.config=JSON.stringify(e.company.config)),e.company.admin_config&&(e.company.admin_config=JSON.stringify(e.company.admin_config)),i.createInfo(c.company).then(function(i){a.getMe().then(function(a){a.data&&a.data.id&&(t.appUser=e.appUser=a.data,o.setSelectedCompany(i.data),n.go("backend.dashboard",{},{reload:!0}))})},function(t){e.savingCompanyErr=t.data,r.error(s.instant(e.savingCompanyErr.message))}).finally(function(){e.savingCompany=void 0})},e.canAccess=!0}}};angular.module("shmApp.directives").directive("companyCreate",["appConf","$rootScope","$state","AuthService","CompanyService","UtilsService","toastr","$translate",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{companyExpiredInfoPanel:"<"},link:function(e,i,o){var r={};e.appUser=t.appUser,e.company=n.formatCompany(e.appUser,e.companyExpiredInfoPanel),!0===e.company.is_expired&&(r.html='<div class="company-expired-info-panel-wrapper"><div class="alert alert-danger company-expired-info-panel"><div class="text-center"><strong translate="COMPANY.EXPIRED.INFO.PANEL.BODY" translate-values="{\'company_name\': company.name, \'expired_at\': (company.admin_config.currentPackageExpireDate | amUtc | amLocal | amDateFormat: \'ll\')}"></strong></div><ask-customer-service-panel></ask-customer-service-panel></div></div>',r.newElement=a(r.html)(e),i.replaceWith(r.newElement))}}};angular.module("shmApp.directives").directive("companyExpiredInfoPanel",["appConf","$rootScope","UtilsService","$compile",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"A",scope:{companyNotHaveThisModuleInfoPanel:"<",moduleName:"@"},link:function(e,i,o){var r={};e.appUser=t.appUser,e.company=n.formatCompany(e.appUser,e.companyNotHaveThisModuleInfoPanel),e.company.modules[e.moduleName.toLowerCase()]&&e.company.modules[e.moduleName.toLowerCase()].create&&!0===e.company.modules[e.moduleName.toLowerCase()].create||(r.html='<div class="company-not-have-this-module-info-panel-wrapper"><div class="alert alert-warning company-not-have-this-module-info-panel"><div class="text-center"><strong translate="COMPANY.NOT_HAVING_THIS_MODULE.INFO.PANEL.BODY" translate-values="{\'company_name\': company.name, \'module_name\': (moduleName.toUpperCase() | translate)}"></strong></div><ask-customer-service-panel ng-if="appUser.is_admin !== true" btn-text="{{\'CUSTOMER_SERVICE.CLICK_HERE_TO_ENABLE_THIS_MODULE\' | translate}}"></ask-customer-service-panel></div></div>',r.newElement=a(r.html)(e),!0===e.appUser.is_admin?i.prepend(r.newElement):i.replaceWith(r.newElement))}}};angular.module("shmApp.directives").directive("companyNotHaveThisModuleInfoPanel",["appConf","$rootScope","UtilsService","$compile",e])}(),function(){"use strict";var e,t=function(t,n,a,i){e=this,e.company=a,e.pickupLocation=n,e.cancel=function(){t.dismiss("cancel")},e.deletePickupLocation=function(){e.deleting=!0,e.deletingErr=void 0,i.deleteCompanyPickupLocation(e.company.id,e.pickupLocation.id).then(function(e){t.close(e.data&&e.data.success&&!0===e.data.success)},function(t){e.deletingErr=t.data}).finally(function(){e.deleting=void 0})}},n=function(e,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<",hideTitle:"<?"},templateUrl:e.rootDir.views+"company/companyPickupLocations.html",link:function(o,r,s){o.getPickupLocations=function(){o.gettingLocations=!0,o.gettingLocationsErr=void 0,n.getCompanyPickupLocations(o.company.id).then(function(e){o.locationList=e.data},function(e){o.gettingLocationsErr=e.data}).finally(function(){o.gettingLocations=void 0})},o.showNewLocationPanel=function(){o.addingNewLocation=!0},o.hideNewLocationPanel=function(){o.addingNewLocation=void 0},o.showEditPanel=function(e){angular.forEach(o.locationList,function(e){e.editing=void 0}),o.locationList&&o.locationList[e]&&(o.locationList[e].editing=!0)},o.hideEditPanel=function(){angular.forEach(o.locationList,function(e){!0===e.editing&&(e.editing=void 0)})},o.confirmDelete=function(n){i.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.rootDir.views+"company/confirmDeletePickupLocation.html",controller:["$uibModalInstance","pickupLocation","company","CompanyService",t],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{pickupLocation:function(){return o.locationList[n]},company:function(){return o.company}}}).result.then(function(e){!0===e&&(o.locationList[n].active=0)})},o.getPickupLocations(),o.company=a.formatCompany(o.appUser,o.company),o.canCreate=!0===o.company.isCompanyAdmin&&!0!==o.company.is_expired||!0===o.appUser.is_admin}}};angular.module("shmApp.directives").directive("companyPickupLocations",["appConf","CompanyService","UtilsService","$uibModal",n])}(),function(){"use strict";var e=function(e,t,n,a,i){var o=this;o.appUser=t,o.company=n,o.company_url=a,o.cancel=function(){e.dismiss("cancel")},o.getQrCodes=function(){o.totalQrCodes=0,o.getting=!0,o.gettingErr=void 0,i.getCompanyQrcodes(o.company.id).then(function(e){o.qrcodes=e.data,angular.forEach(o.qrcodes,function(e,t){e&&null!==e&&""!==e?o.totalQrCodes=1*o.totalQrCodes+1:delete o.qrcodes[t]})},function(e){o.gettingErr=e.data}).finally(function(){o.getting=void 0})},o.getQrCodes()},t=function(t,n){return{restrict:"AE",scope:{appUser:"<",company:"<"},link:function(a,i,o){a.company_url=t.url.reactAddress+"/index?companyId="+a.company.id,i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"company/companyQrCodePanel.html",controller:["$uibModalInstance","appUser","company","company_url","CompanyService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return a.appUser},company:function(){return a.company},company_url:function(){return a.company_url}}})})}}};angular.module("shmApp.directives").directive("companyQrCodePopupBtn",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o){var r=this;r.appUser=t,r.company=n,r.steps={companyInfoUpdated:void 0,companyEnablePaymentMethods:void 0},r.finishedAllSteps=!1,r.cancel=function(){e.dismiss("cancel")},r.close=function(t){e.close(t)},r.checkAllStepsFinished=function(){return angular.forEach(r.steps,function(e,t){console.log(t)}),r},r.updateCompanyInfo=function(){if(!r.company.name||""===r.company.name)return void(r.savingErr={message:i.instant("COMPANY.NAME.IS_REQUIRED"),errors:{name:[i.instant("COMPANY.NAME.IS_REQUIRED")]}});var e={};return e.company=o.formatCompany(r.appUser,r.company),"object"==typeof r.company.config&&(e.company.config=JSON.stringify(e.company.config)),"object"==typeof r.company.admin_config&&(e.company.admin_config=JSON.stringify(e.company.admin_config)),e.company.has_been_setup=!0,r.saving=!0,r.savingErr=void 0,a.updateInfo(e.company.id,e.company).then(function(e){r.company=e.data,r.steps.companyInfoUpdated=!0,r.checkAllStepsFinished(),o.setSelectedCompany(e.data),o.updateCompanyInAllStoredCompanies(e.data),window.location.reload()},function(e){r.savingErr=e.data}).finally(function(){r.saving=void 0}),r}},t=function(t,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<"},link:function(o,r,s){o.appUser&&o.appUser.id&&""!==o.appUser.id&&o.company&&o.company.id&&""!==o.company.id&&!1===o.company.has_been_setup&&(!0===o.company.isCompanyAdmin||!0===o.company.isCurrentUserAdmin)&&a.open({animation:!0,templateUrl:t.rootDir.views+"company/companySetupGuidePanel.html",controller:["$uibModalInstance","appUser","company","CompanyService","$translate","UtilsService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return o.appUser},company:function(){return o.company}}}).result.then(function(e){n.setSelectedCompany(e),n.updateCompanyInAllStoredCompanies(e),i.location.reload()})}}};angular.module("shmApp.directives").directive("companySetupGuidePanel",["appConf","UtilsService","$uibModal","$window",t])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"="},templateUrl:e.rootDir.views+"company/companySuperAdminPanel.html",link:function(e,t,n){e.packageList=[{type:"normal",name:"PACKAGE.SELECTION.NORMAL_PACKAGE"},{type:"recommendation",name:"PACKAGE.SELECTION.RECOMMENDED_PACKAGE"},{type:"professional",name:"PACKAGE.SELECTION.PROFESSIONAL_PACKAGE"},{type:"none",name:"PACKAGE.SELECTION.NONE_PACKAGE"}]}}};angular.module("shmApp.directives").directive("companySuperAdminPanel",["appConf","$translate",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",optionsPosition:"@?"},templateUrl:e.rootDir.views+"company/companySwitch.html",link:function(e,n,r){e.switch=function(e){i.setSelectedCompany(e),a.go("backend.dashboard",{},{reload:!0})},e.getAllCompanies=function(){e.getting=!0,e.gettingErr=void 0,t.getAllCompanies().then(function(t){e.companyOptions=t.data,i.setAllStoredCompanies(e.companyOptions)},function(t){e.gettingErr=t.data}).finally(function(){e.getting=void 0})},e.showCompanyOptions=function(){!0===e.appUser.is_admin&&(e.companyOptions=i.getAllStoredCompanies()),o(function(){var e=document.getElementById("search-bar");e&&e.focus()},300)},e.searchObject={text:""},e.optionsPosition=e.optionsPosition||"bottom",e.companyOptions=e.appUser.userCompany,!0===e.appUser.is_admin&&(e.companyOptions=i.getAllStoredCompanies(),e.companyOptions&&0!==e.companyOptions.length||e.getAllCompanies())}}};angular.module("shmApp.directives").directive("companySwitch",["appConf","CompanyService","$rootScope","$state","UtilsService","$timeout",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"A",scope:{notCompanyAdminPanel:"<",appUser:"<?"},link:function(t,i,o){var r={};t.appUser=t.appUser||e.appUser,t.company=n.formatCompany(t.appUser,t.notCompanyAdminPanel),!0!==t.company.isCurrentUserAdmin&&!0!==e.appUser.is_admin&&(r.html='<div class="not-company-admin-panel-wrapper"><div class="title" translate="ACCESS_DENY"></div><div class="body"><div translate="YOU_ARE_NOT_THE_COMPANY_ADMIN" translate-values="{\'company_name\': company.name}"></div></div></div>',r.newElement=a(r.html)(t),i.replaceWith(r.newElement))}}};angular.module("shmApp.directives").directive("notCompanyAdminPanel",["$rootScope","appConf","UtilsService","$compile",e])}(),function(){"use strict";var e=function(e,t,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"dashboard/dashboard.html",link:function(e,n,o){e.getting=!0,e.gettingNumberOfArticles=!0,e.getMediaSize=function(){i.getPackage(e.company.id).then(function(t){e.company.totalSize=t.data.validate_result.STORAGE_LIMIT.max_num,null==e.company.totalSize?e.spaceActive=!1:e.spaceActive=!0,e.usedSize=t.data.validate_result.STORAGE_LIMIT.real_num},function(e){console.log(e)}).finally(function(){e.getting=!1})},i.getSubscription(e.company.id).then(function(t){t&&t.data&&(e.is_valid=t.data.is_valid)}),t.getNumberOfArticlesUnderCompany(e.company.id).then(function(t){e.numberOfArticles=t.data}).finally(function(){e.gettingNumberOfArticles=!1}),e.navigateToMedia=function(){a.go("backend.media")},e.navigateToArticle=function(){a.go("backend.notes")},e.getMediaSize()}}};angular.module("shmApp.directives").directive("dashboard",["appConf","CompanyService","ItemService","$state","SubscriptionService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"groupBuy/groupBuyList.html",link:function(n,a,i){n.getItems=function(a){var i={page:a||1};i.params={"page-size":n.pageSize,page:i.page,"key-word":n.searchObj.text,community_id:e.community.group_buy.id},i.params=angular.merge({},i.params,n.searchTypes[n.searchObj.selected_type]),n.gettingErr=void 0,n.gettingMoreErr=void 0,i.page>1?n.gettingMore=!0:n.getting=!0,t.searchItemsUnderCompanyOnlyForGroupBuy(n.company.id,i.params).then(function(e){n.itemList&&n.itemList.data&&n.itemList.data.length>0&&i.page>1?(i.previousData=n.itemList.data,n.itemList=e.data,n.itemList.data=i.previousData.concat(e.data.data)):n.itemList=e.data},function(e){i.page>1?n.gettingMoreErr=e.data:n.gettingErr=e.data}).finally(function(){n.getting=void 0,n.gettingMore=void 0})},n.switchType=function(e){n.searchObj.selected_type=e,n.getItems()},n.pageSize=n.pageSize?n.pageSize:12,n.searchTypes={available:{is_draft:0,is_ended:0,is_expired:0,is_published:1,is_sold:0},ended:{is_expired:1,is_draft:0},all:{}},n.searchObj={text:"",selected_type:Object.keys(n.searchTypes)[0]},n.getItems()}}};angular.module("shmApp.directives").directive("groupBuyList",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",item:"<"},templateUrl:e.rootDir.views+"groupBuy/groupBuyListItem.html",link:function(e,t,n){e.item.title=e.item.title.replace(" ","")}}};angular.module("shmApp.directives").directive("groupBuyListItem",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",itemId:"<",company:"<",cancelFunc:"&?"},templateUrl:e.rootDir.views+"groupBuy/groupBuyDetails.html",link:function(e,a,i){e.getGroupBuyItemDetails=function(){e.loadingDetails=!0,e.loadingDetailsErr=void 0,t.getItemDetails(e.itemId).then(function(t){e.itemDetails=t.data,e.itemDetails.date_expiry=moment(moment.utc(e.itemDetails.date_expiry)).local().format("YYYY-MM-DD HH:mm:ss"),n.editingGroupbuy=e.itemDetails},function(t){e.loadingDetailsErr=t.data}).finally(function(){e.loadingDetails=void 0})},e.cancel=function(){!0===e.hasCancelFunc&&e.cancelFunc()()},e.itemSaved=function(e){o.go("backend.group_buys_details",{id:e.id},{reload:!0})},e.startDateBeforeRender=function(e){var t=new Date,n=new Date(t);n.setDate(t.getDate()+1),n.setUTCHours(0,0,0,0),e.filter(function(e){return e.utcDateValue<n.getTime()}).forEach(function(e){e.selectable=!1})},e.deleteBonus=function(t){switch(t){case e.bonusTypeList.participate:e.itemDetails.jielong_success_entities=[];break;case e.bonusTypeList.share:e.itemDetails.wxshare_success_entities=[]}},e.itemId?e.getGroupBuyItemDetails():e.itemDetails={},e.canEdit=!0===e.company.isCompanyAdmin||!0===e.appUser.is_admin,e.hasCancelFunc="function"==typeof e.cancelFunc&&"function"==typeof e.cancelFunc(),e.hasExpireDate=!1,e.bonusTypeList={share:{name:"SHARE"},participate:{name:"PARTICIPATE"}},e.jielongVoucherEntityMap={voucher_group:"App\\Modules\\Platform\\Models\\CompanyVoucherGroup",voucher_campaign:"App\\Modules\\Platform\\Models\\VoucherCampaign"}}}};angular.module("shmApp.directives").directive("groupBuyDetails",["appConf","ItemService","$rootScope","$uibModal","$translate","$state",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){var r=this;r.appUser=t,r.company=n,r.selectedEntities=angular.copy(a),r.bonusType=i,r.cancel=function(){e.dismiss("cancel")},r.add=function(){void 0==r.selectedEntities[0]&&(r.selectedEntities=[]),e.close(r.selectedEntities)},r.getVoucherList=function(e){var t={page:e||1};t.params={"page-size":12,page:t.page,available:1},r.searchObject&&r.searchObject.text&&""!=r.searchObject.text&&(t.params["key-word"]=r.searchObject.text),r._getVoucherList(e,t.params)},r._getVoucherList=function(e,t){var n={page:e};r.gettingErr=void 0,r.gettingMoreErr=void 0,n.page>1?r.gettingMore=!0:r.getting=!0,o.getVoucherGroupsUnderCompany(r.company.id,t).then(function(e){r.itemList&&r.itemList.data&&r.itemList.data.length>0&&n.page>1?(n.previousData=r.itemList.data,r.itemList=e.data,r.itemList.data=n.previousData.concat(e.data.data)):r.itemList=e.data},function(e){n.page>1?r.gettingMoreErr=e.data:r.gettingErr=e.data}).finally(function(){r.getting=void 0,r.gettingMore=void 0})},r.jielongVoucherEntityMap={voucher_group:"App\\Modules\\Platform\\Models\\CompanyVoucherGroup",voucher_campaign:"App\\Modules\\Platform\\Models\\VoucherCampaign"},r.getVoucherList()},t=function(t,n){return{restrict:"AE",scope:{appUser:"<",company:"<",selectedEntities:"=?",bonusType:"=?"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"groupBuy/groupBuyVoucherSelector.html",controller:["$uibModalInstance","appUser","company","selectedEntities","bonusType","CompanyService",e],controllerAs:"mdCtrl",size:"lg",resolve:{appUser:function(){return a.appUser},company:function(){return a.company},selectedEntities:function(){return a.selectedEntities},bonusType:function(){return a.bonusType}}}).result.then(function(e){a.selectedEntities=e})})}}};angular.module("shmApp.directives").directive("groupBuyVoucherSelector",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{appUser:"<",bonusEntities:"=?",bonusType:"<?",company:"<?"},templateUrl:e.rootDir.views+"groupBuy/groupBuyVoucherPreview.html",link:function(e,t,n){e.deleteBonus=function(){e.bonusEntities=[]}}}};angular.module("shmApp.directives").directive("groupBuyVoucherPreview",["appConf",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"event/eventList.html",link:function(n,a,i){n.getItems=function(a){var i={page:a||1};i.params={"page-size":n.pageSize,page:i.page,"key-word":n.searchObj.text,community_id:e.community.group_buy.id},i.params=angular.merge({},i.params,n.searchTypes[n.searchObj.selected_type]),n.gettingErr=void 0,n.gettingMoreErr=void 0,i.page>1?n.gettingMore=!0:n.getting=!0,t.searchItemsUnderCompanyOnlyForGroupBuy(n.company.id,i.params).then(function(e){n.itemList&&n.itemList.data&&n.itemList.data.length>0&&i.page>1?(i.previousData=n.itemList.data,n.itemList=e.data,n.itemList.data=i.previousData.concat(e.data.data)):n.itemList=e.data},function(e){i.page>1?n.gettingMoreErr=e.data:n.gettingErr=e.data}).finally(function(){n.getting=void 0,n.gettingMore=void 0})},n.switchType=function(e){n.searchObj.selected_type=e,n.getItems()},n.pageSize=n.pageSize?n.pageSize:12,n.searchTypes={available:{is_draft:0,is_ended:0,is_expired:0,is_published:1,is_sold:0},ended:{is_expired:1,is_draft:0},all:{}},n.searchObj={text:"",selected_type:Object.keys(n.searchTypes)[0]},n.getItems()}}};angular.module("shmApp.directives").directive("eventList",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",item:"<"},templateUrl:e.rootDir.views+"event/eventListItem.html",link:function(e,t,n){e.item.title=e.item.title.replace(" ","")}}};angular.module("shmApp.directives").directive("eventListItem",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",itemId:"<",company:"<",cancelFunc:"&?"},templateUrl:e.rootDir.views+"event/eventDetails.html",link:function(e,a,i){e.getDetails=function(){e.loadingDetails=!0,e.loadingDetailsErr=void 0,t.getItemDetails(e.itemId).then(function(t){e.itemDetails=t.data,e.itemDetails.date_expiry=moment(moment.utc(e.itemDetails.date_expiry)).local().format("YYYY-MM-DD HH:mm:ss"),n.editingEvent=e.itemDetails},function(t){e.loadingDetailsErr=t.data}).finally(function(){e.loadingDetails=void 0})},e.cancel=function(){console.log(e.itemDetails)},e.itemSaved=function(e){o.go("backend.events_details",{id:e.id},{reload:!0})},e.startDateBeforeRender=function(e){var t=new Date,n=new Date(t);n.setDate(t.getDate()+1),n.setUTCHours(0,0,0,0),e.filter(function(e){return e.utcDateValue<n.getTime()}).forEach(function(e){e.selectable=!1})},e.itemId?e.getDetails():e.itemDetails={},e.canEdit=!0===e.company.isCompanyAdmin||!0===e.appUser.is_admin,e.hasCancelFunc="function"==typeof e.cancelFunc&&"function"==typeof e.cancelFunc(),e.hasExpireDate=!1}}};angular.module("shmApp.directives").directive("eventDetails",["appConf","ItemService","$rootScope","$uibModal","$translate","$state",e])}(),function(){"use strict";var e=function(e,t,n,a){var i=this;i.appUser=t,i.item=n,i.cancel=function(){e.dismiss("cancel")},i.sendEmail=function(){var t={email:i.receiver};a.genJielongReportEmail(i.item.id,t).then(function(t){e.close(t.data)},function(e){i.gettingErr=e.data}).finally(function(){i.getting=void 0})}},t=function(t,n,a,i){return{restrict:"AE",scope:{appUser:"<",item:"=?"},link:function(o,r,s){r.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"event/eventRecordsExporter.html",controller:["$uibModalInstance","appUser","item","ItemService",e],controllerAs:"mdCtrl",size:"lg",resolve:{appUser:function(){return o.appUser},item:function(){return o.item}}}).result.then(function(e){
e.success&&a.success(i.instant("EVENTS.EXPORT.RECORDS.SUCCESS"))})})}}};angular.module("shmApp.directives").directive("eventRecordsExporter",["appConf","$uibModal","toastr","$translate",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"media/mediaList.html",link:function(e){e.gettingMore=void 0,e.getting=void 0,o.getSubscription(e.company.id).then(function(t){t&&t.data&&(e.is_valid=t.data.is_valid)}),o.getPackage(e.company.id).then(function(t){t.data&&t.data.validate_result&&t.data.validate_result.STORAGE_LIMIT&&(e.STORAGE_LIMIT=t.data.validate_result.STORAGE_LIMIT,e.company.totalSize=e.STORAGE_LIMIT.max_num,e.usedSize=e.STORAGE_LIMIT.real_num,0==e.usedSize?(e.spaceUsingRate=0,e.styleOfRate="width:0%"):e.usedSize>=e.company.totalSize?(e.spaceUsingRate=100,e.styleOfRate="width:100%"):(e.spaceUsingRate=(100*e.usedSize/e.company.totalSize).toFixed(2),e.styleOfRate="width:"+e.spaceUsingRate+"%"),0==e.usedSize?e.getting=!1:(e.getting=!0,e.getAssets(1)))}),e.searchAssets=function(t){e.getting=!0,e.gettingMore=!1,e.getAssets(t)},e.deleteFunc=function(t,n){e.assets.data.splice(t,1),i.deleteAsset(n).then(function(t){e.getCompanySizeUsed(e.company.id)})},e.orderBy="updated_at",e.order="desc",e.OrderByUpdatedTimeIcon="fa fa-arrow-down",e.OrderBySizeIcon="fa fa-arrow-down",e.getAssets=function(n,a){a&&"updated_at"==a&&(e.gettingOrderedList=!0,e.orderBy=a,e.order="desc"==e.order?"asc":"desc",e.OrderByUpdatedTimeIcon="fa fa-arrow-down"==e.OrderByUpdatedTimeIcon?"fa fa-arrow-up":"fa fa-arrow-down"),a&&"file_size"==a&&(e.gettingOrderedList=!0,e.orderBy=a,e.order="desc"==e.order?"asc":"desc",e.OrderBySizeIcon="fa fa-arrow-down"==e.OrderBySizeIcon?"fa fa-arrow-up":"fa fa-arrow-down");var i={page:n||1};1==e.gettingMore&&(e.gettingMorePro=!0),i.params={page:n,"page-size":5,keyword:e.searchTitle},t.getCompanyAssets(e.company.id,e.orderBy,e.order,i.params).then(function(t){e.assets&&e.assets.data&&e.assets.data.length>0&&n>1?(i=e.assets.data,e.assets.data=i.concat(t.data.data),e.assets.current_page<e.assets.last_page?e.assets.current_page+=1:e.gettingMore=!1):(e.assets=t.data,e.getting=!1,e.assets.current_page<e.assets.last_page&&(e.gettingMore=!0,e.assets.current_page+=1))}).finally(function(){e.gettingMorePro=void 0,e.gettingOrderedList=!1})}}}};angular.module("shmApp.directives").directive("mediaList",["appConf","CompanyService","$filter","amMoment","AssetService","SubscriptionService",e])}(),function(){"use strict";var e=function(e,t,n,a,i){var o=this;o.items=t.items,o.asset=t,o.cancel=function(){e.dismiss("cancel")},o.yes=function(){e.dismiss("cancel"),i(t.index,t.id)}},t=function(t,n){return{restrict:"AE",scope:{asset:"<",assetsData:"=",deleteFunc:"&"},link:function(a,i,o){a.deleteAsset=function(){console.log("deleting...")},i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"media/itemListOfCertainAsset.html",controller:["$uibModalInstance","asset","assetsData","AssetService","deleteFunc",e],controllerAs:"mdCtrl",resolve:{asset:function(){return a.asset},assetsData:function(){return a.assetsData},deleteFunc:function(){return a.deleteFunc()}}})})}}};angular.module("shmApp.directives").directive("itemListOfCertainAssetBtn",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i){var o=this;o.appUser=t,o.item=n,o.itemType=a,o.cancel=function(){e.dismiss("cancel")},o.delete=function(){o.deleting=!0,o.deletingErr=void 0,i.markItemDeactivate(o.item.id).then(function(t){e.close(t.data)},function(e){o.deletingErr=e.data}).finally(function(){o.deleting=void 0})}},t=function(t,n,a){return{restrict:"A",scope:{appUser:"<",itemDeleteBtn:"=",succFunc:"&?",itemType:"@?"},link:function(i,o,r){o.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"item/confirmDelete.html",controller:["$uibModalInstance","appUser","item","itemType","ItemService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return i.appUser},item:function(){return i.itemDeleteBtn},itemType:function(){return i.itemType}}}).result.then(function(e){i.item=n.formatItem(e),"function"==typeof i.succFunc&&"function"==typeof i.succFunc()&&i.succFunc()(i.item)})})}}};angular.module("shmApp.directives").directive("itemDeleteBtn",["appConf","UtilsService","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i){var o=this;o.appUser=t,o.item=n,o.itemType=a,o.cancel=function(){e.dismiss("cancel")},o.save=function(){o.saving=!0,o.savingErr=void 0,i.markItemEnd(o.item.id).then(function(t){e.close(t.data)},function(e){o.savingErr=e.data}).finally(function(){o.saving=void 0})}},t=function(t,n,a){return{restrict:"A",scope:{appUser:"<",itemEndBtn:"=",succFunc:"&?",itemType:"@?"},link:function(i,o,r){o.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"item/confirmEnd.html",controller:["$uibModalInstance","appUser","item","itemType","ItemService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return i.appUser},item:function(){return i.itemEndBtn},itemType:function(){return i.itemType}}}).result.then(function(e){i.item=n.formatItem(e),"function"==typeof i.succFunc&&"function"==typeof i.succFunc()&&i.succFunc()(i.item)})})}}};angular.module("shmApp.directives").directive("itemEndBtn",["appConf","UtilsService","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n){return{restrict:"AE",scope:{appUser:"<",item:"=",succFunc:"&?",itemType:"@?"},templateUrl:e.rootDir.views+"item/optionBtns.html",link:function(t,n,a){t.item.id&&(t.link=e.url.api()+"/item/redirect?itemId="+t.item.id),t.preview=function(){window.open(t.link,"_self")},t.$watch("item",function(n){t.item=n,t.item.id&&(t.link=e.url.api()+"/item/redirect?itemId="+t.item.id)})}}};angular.module("shmApp.directives").directive("itemOptionBtns",["appConf","UtilsService","$uibModal",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){var r=this;r.appUser=t,r.item=n,r.itemType=a,r.cancel=function(){e.dismiss("cancel")},r.save=function(){r.item.is_draft=!1,r.item.is_sync_to_market=!r.item.is_draft,r.item.date_publish=o.getNowUtcDateTime().format("YYYY-MM-DD HH:m:ss"),"object"==typeof r.item.config&&(r.item.config=JSON.stringify(r.item.config)),r.saving=!0,r.savingErr=void 0,i.updateItem(r.item.id,r.item).then(function(t){e.close(t.data)},function(e){r.savingErr=e.data}).finally(function(){r.saving=void 0})}},t=function(t,n,a){return{restrict:"A",scope:{appUser:"<",itemPublishBtn:"=",succFunc:"&?",itemType:"@?"},link:function(i,o,r){o.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"item/confirmPublish.html",controller:["$uibModalInstance","appUser","item","itemType","ItemService","UtilsService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return i.appUser},item:function(){return i.itemPublishBtn},itemType:function(){return i.itemType}}}).result.then(function(e){i.item=n.formatItem(e),"function"==typeof i.succFunc&&"function"==typeof i.succFunc()&&i.succFunc()(i.item)})})}}};angular.module("shmApp.directives").directive("itemPublishBtn",["appConf","UtilsService","$uibModal",t])}(),function(){"use strict";var e=function(e){return{restrict:"A",scope:{itemQrCodePanel:"<",title:"@?"},template:'<div class="item-qr-codes-wrapper"><loading-bar ng-if="getting === true"></loading-bar><div ng-if="getting !== true" class="text-center"><show-error-from-json error-obj="gettingErr"></show-error-from-json><div translate="ITEM.PREVIEW.QRCODE.BODY" ng-if="!title"></div><h3 ng-if="title" ng-bind-html="title"></h3><div class="item-qrcodes-list qrcode-list text-center row" ng-if="!gettingErr"><div class="qrcode-list-item {{key}} text-center ngClass:{\'col-md-12\': totalQrCodes <= 1, \'col-md-6\': totalQrCodes > 1}" ng-repeat="(key, url) in qrcodes"><img ng-src="{{url}}" class="img-responsive qrcode-img"/></div></div></div></div>',link:function(t,n,a){t.getQrCodes=function(){t.totalQrCodes=0,t.getting=!0,t.gettingErr=void 0,e.getItemQrCodes(t.item.id).then(function(e){t.qrcodes=e.data,angular.forEach(t.qrcodes,function(e,n){e&&null!==e&&""!==e?t.totalQrCodes=1*t.totalQrCodes+1:delete t.qrcodes[n]})},function(e){t.gettingErr=e.data}).finally(function(){t.getting=void 0})},t.item=t.itemQrCodePanel,t.getQrCodes()}}};angular.module("shmApp.directives").directive("itemQrCodePanel",["ItemService",e])}(),function(){"use strict";var e=function(e,t){var n=this;n.item=t,n.cancel=function(){e.dismiss("cancel")}},t=function(t){return{restrict:"A",scope:{itemQrCodePopupBtn:"<"},link:function(n,a){a.on("click",function(){t.open({animation:!0,template:'<div class="item-qrcodes-wrapper"><div class="modal-header"><div class="modal-title" translate="ITEM.PREVIEW.QRCODE.TITLE"></div></div><div class="modal-body"><div item-qr-code-panel="mdCtrl.item"></div></div><div class="modal-footer text-center"><button type="button" class="btn btn-success" translate="OK" ng-click="mdCtrl.cancel()"></button></div></div>',controller:["$uibModalInstance","item",e],controllerAs:"mdCtrl",resolve:{item:function(){return n.itemQrCodePopupBtn}}})})}}};angular.module("shmApp.directives").directive("itemQrCodePopupBtn",["$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o,r,s,c,u,l){var p=this;p.appUser=n,p.item=a,p.channels=i,p.itemType=s,p.company=r,p.preCheckingErr=o,p.item.selectedChannel=[],p.selectedTypes=[],p.channels&&p.channels.length>0&&p.channels.forEach(function(e){p.item.selectedChannel.push(e.id),p.selectedTypes.push(e.type)}),p.cancel=function(){t.dismiss("cancel")},p.close=function(){t.close(p.item)},p.selectChannel=function(e){p.item.selectedChannel.includes(e.id)?(p.item.selectedChannel.splice(p.item.selectedChannel.indexOf(e.id),1),p.selectedTypes.splice(p.selectedTypes.indexOf(e.type),1)):(p.item.selectedChannel.push(e.id),p.selectedTypes.push(e.type))},p.selectAll=function(e){p.item.selectedChannel=[],p.selectedTypes=[],e?(p.item.selectedChannel=[],p.selectedTypes=[]):p.channels.map(function(e){p.item.selectedChannel.push(e.id),p.selectedTypes.push(e.type)})},p.save=function(t){var n={};p.item.is_draft=t||!1,p.item.is_sync_to_market=!p.item.is_draft,p.item.multi_participations=!1,p.item.date_expiry&&null!=p.item.date_expiry?p.item.date_expiry=moment(p.item.date_expiry).format("YYYY-MM-DD HH:mm:ss"):(n.maxUtcDateTime=l.getMaxUtcDateTime(),p.item.date_expiry=n.maxUtcDateTime.format("YYYY-MM-DD HH:mm:ss")),p.item.date_publish=l.getNowUtcDateTime().format("YYYY-MM-DD HH:mm:ss"),p.item.address||(p.item.address=l.getDefaultAddressObj()),p.item.tagNames&&0!=p.item.tagNames.length||(p.item.tagNames=[e.community[c].name]),p.item.id&&""!=p.item.id||(p.item.company_id=p.company.id),"object"==typeof p.item.config&&(p.item.config=JSON.stringify(p.item.config)),n.savingFunc=p.item.id&&""!==p.item.id?u.updateItem(p.item.id,p.item):u.createItem(p.item),p.saving=!0,p.savingErr=void 0,p.savingSuccess=void 0,n.savingFunc.then(function(e){p.item=l.formatItem(e.data),p.savingSuccess=!0},function(e){p.savingErr=e.data}).finally(function(){p.saving=void 0})}},t=function(t,n,a,i,o){return{restrict:"A",scope:{appUser:"<",channels:"<",company:"<",communityType:"@",itemSaveBtn:"=",succFunc:"&?",itemType:"@?",getPreCheckErrFunc:"&?"},link:function(r,s,c){r.$watch("itemSaveBtn",function(e){r.item=e}),r.item=r.itemSaveBtn,s.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"item/confirmSave.html",controller:["appConf","$uibModalInstance","appUser","item","channels","preCheckingErr","company","itemType","communityType","ItemService","UtilsService",e],controllerAs:"mdCtrl",backdrop:"static",keyboard:!1,resolve:{appUser:function(){return r.appUser},item:function(){return r.item},channels:function(){return r.channels},company:function(){return r.company},itemType:function(){return r.itemType},communityType:function(){return r.communityType},preCheckingErr:function(){if("function"==typeof r.getPreCheckErrFunc&&"function"==typeof r.getPreCheckErrFunc())return r.getPreCheckErrFunc()(r.item)}}}).result.then(function(e){r.item.id&&""!==r.item.id?i.success(o.instant("ITEM.UPDATE.SUCCESSFULLY")):i.success(o.instant("ITEM.CREATE.SUCCESSFULLY")),r.item=n.formatItem(e),"function"==typeof r.succFunc&&"function"==typeof r.succFunc()&&r.succFunc()(r.item)})})}}};angular.module("shmApp.directives").directive("itemSaveBtn",["appConf","UtilsService","$uibModal","toastr","$translate",t])}(),function(){"use strict";var e=function(e,t,n,a,i){var o=this;o.appUser=t,o.item=n,o.itemType=a,o.cancel=function(){e.dismiss("cancel")},o.push=function(){o.saving=!0,o.savingErr=void 0,o.savingSuccess=void 0,i.pushToWordpress(o.item.id,o.item).then(function(t){t.data&&1==t.data.success&&(o.savingSuccess=!0,e.close(o.item))},function(e){o.savingErr=e.data,o.saving=void 0}).catch(function(e){o.saving=void 0})}},t=function(t,n,a,i,o){return{restrict:"A",scope:{appUser:"<",itemPushWpBtn:"=",succFunc:"&?",itemType:"@?"},link:function(r,s,c){s.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"item/confirmPushWp.html",controller:["$uibModalInstance","appUser","item","itemType","ItemService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return r.appUser},item:function(){return r.itemPushWpBtn},itemType:function(){return r.itemType}}}).result.then(function(e){i.success(o.instant("ITEM.UPDATE.SUCCESSFULLY")),r.item=n.formatItem(e),r.item=n.formatItem(e),"function"==typeof r.succFunc&&"function"==typeof r.succFunc()&&r.succFunc()(r.item)})})}}};angular.module("shmApp.directives").directive("itemPushWpBtn",["appConf","UtilsService","$uibModal","toastr","$translate",t])}(),function(){"use strict";var e=function(e){return{restrict:"A",scope:{showItemWithStatus:"<"},link:function(t,n,a){t.item=t.showItemWithStatus,n.addClass("item-with-status"),n.addClass("item-with-status-"+e.getItemStatusName(t.item).toLowerCase())}}};angular.module("shmApp.directives").directive("showItemWithStatus",["ItemService",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o,r){var s=this;s.appUser=t,s.item=n,s.itemType=i,s.records=a,s.cancel=function(){e.dismiss("cancel")}},t=function(t,n,a,i,o){return{restrict:"A",scope:{appUser:"<",item:"<",itemPublishBtn:"=",succFunc:"&?",itemType:"@?"},link:function(n,r,s){r.on("click",function(){n.getRecords=function(){a.getSyncRecords(n.item.id).then(function(e){e&&e.data&&e.data.data&&e.data.data.length>0&&(n.records=e.data.data)}).finally(function(){o.open({animation:!0,templateUrl:t.rootDir.views+"item/syncStatus.html",controller:["$uibModalInstance","appUser","item","records","itemType","ItemService","UtilsService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return n.appUser},item:function(){return n.item},records:function(){return n.records},itemType:function(){return n.itemType}}}).result.then(function(e){n.item=i.formatItem(e),"function"==typeof n.succFunc&&"function"==typeof n.succFunc()&&n.succFunc()(n.item)},function(e){console.log(e)})})},n.item.id&&""!==n.item.id&&n.getRecords()})}}};angular.module("shmApp.directives").directive("syncStatusBtn",["appConf","$interval","ItemService","UtilsService","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i){return{restrict:"AE",scope:{appUser:"<?"},templateUrl:e.rootDir.views+"language/languageSwitch.html",link:function(e,n,o){e.toggleDisplayOptions=function(){e.displayOptions=!0!==e.displayOptions},e.hideOptions=function(){e.displayOptions=!1},e.switch=function(t){i.switchLanguage(t),e.selectedLanguage=t,e.hideOptions()},e.selectedLanguage=t.use(),e.languages=i.getSupportedLanguages(),a.search().lang&&""!==a.search().lang?e.switch(a.search().lang):""!==i.getLocalLanguageKey()&&e.switch(i.getLocalLanguageKey())}}};angular.module("shmApp.directives").directive("languageSwitch",["appConf","$translate","amMoment","$location","LanguageService",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o,r,s){return{restrict:"AE",scope:{appUser:"<?"},templateUrl:e.rootDir.views+"login/loginPanel.html",link:function(c,u,l){if(c.rootScope=t,r.params.companyId&&""!==r.params.companyId.trim()&&localStorage.setItem("add_to_company_id",r.params.companyId),r.params.oauth_verifier){c.gettingCurrentUser=!0;var p={oauth_verifier:r.params.oauth_verifier,oauth_token:r.params.oauth_token};o.getAccessToken(p).then(function(e){r.go("backend.company_channels",{reload:!0})})}if(r.params.code&&r.params.state){c.gettingCurrentUser=!0;var p={code:r.params.code,state:r.params.state};o.getAccessToken(p).then(function(e){e.data&&e.data.channelId?r.go("backend.channels_details",{id:e.data.channelId},{reload:!0}):r.go("backend.company_channels",{reload:!0})})}c.getCurrentUser=function(){c.gettingCurrentUser=!0,c.gettingCurrentUserErr=void 0,n.getMe().then(function(n){if(n.data&&n.data.id){t.appUser=c.appUser=n.data;var s=a.getSelectedCompany();s&&s.id||(s=!t.appUser.last_visit_company||angular.equals(t.appUser.last_visit_company,{})?t.appUser.userCompany[0]:t.appUser.last_visit_company),a.setSelectedCompany(s),(localStorage.getItem("add_to_company_id")||r.params.companyId)&&o.addNewCompanyAdmin(localStorage.getItem("add_to_company_id")||r.params.companyId,{is_admin:1}).then(function(e){var n=localStorage.getItem("add_to_company_id")||r.params.companyId;localStorage.removeItem("add_to_company_id"),t.appUser.userCompany.length>0&&(s=t.appUser.userCompany.find(function(e){return e.id==n}),a.setSelectedCompany(s))})}else if(c.openedInWechat=i.openedInWeChat()||i.openInWindowsWechat(),c.openedInWechat){var u=e.url.webAddress,l=e.url.webAddress+"/a/tk",p={};i.wechatLogin(u,l,p).then(function(e){e.data&&e.data.auth_url&&window.open(e.data.auth_url,"_self")}).catch(function(e){console.error(e)})}},function(e){c.gettingCurrentUserErr=void 0}).finally(function(){c.gettingCurrentUser=!1,r.go("backend.dashboard",{reload:!1})})},c.appUser={},c.user={},c.gettingCurrentUser||c.getCurrentUser(),c.normalLogin=!0,c.resetPassword=!1,c.sendLogin=!1,c.switchLogin=function(){c.normalLogin=!c.normalLogin,c.resetPassword=!1},c.switchResetPassword=function(){c.user={},c.resetPassword=!c.resetPassword},c.login=function(){c.sendLogin=!0,n.normalLogin(c.user).then(function(e){e.data&&e.data.token&&(s.setToken(e.data.token),c.loginErr=void 0,r.go("login",{},{reload:!0}))},function(e){e.data&&e.data.message&&(c.loginErr=e.data.message)}).finally(function(){c.sendLogin=!1})},c.sendResetEmail=function(){c.sendEmail=!0,n.sendResetEmail(c.user).then(function(e){e.data&&e.data.success&&(c.resetErr=void 0,c.resetDone=!0)},function(e){e.data&&e.data.message&&(c.resetErr=e.data.message)}).finally(function(){c.sendEmail=!1})}}}};angular.module("shmApp.directives").directive("loginPanel",["appConf","$rootScope","AuthService","UtilsService","WeChatService","CompanyService","$state","$auth",e])}(),function(){"use strict";var e=function(e,t,n,a,i){return{restrict:"AE",scope:{},templateUrl:e.rootDir.views+"login/weChatLoginQrPanel.html",link:function(e,o,r){e.navToDashboard=function(){t.go("backend.dashboard",{},{reload:!0})},e.loginWithToken=function(t){e.loggedIn=void 0,e.loggingIn=!0,e.loggingInErr=void 0,n.loginWithTempCode(t).then(function(t){t.data&&t.data.return_code&&(i.cancel(e.loginStatusChecker),a.setToken(t.data.return_code),e.loggedIn=!0,e.navToDashboard())},function(t){e.loggingInErr=t.data}).finally(function(){e.loggingIn=void 0})},e.getLoginStatus=function(){e.gotLoginStatus=void 0,e.gettingLoginStatus=!0,e.gettingLoginStatusErr=void 0,n.checkLoginStatus(e.loginObj.subscribeLoginLogId).then(function(t){t.data&&t.data.log&&t.data.log.tmp_token&&""!==t.data.log.tmp_token&&(i.cancel(e.loginStatusChecker),e.gotLoginStatus=!0,e.loginWithToken(t.data.log.tmp_token))},function(t){e.gettingLoginStatusErr=t.data}).finally(function(){e.gettingLoginStatus=void 0})},e.startGetLoginStatus=function(){e.loginStatusCheckerTimes=0,e.loginStatusChecker=i(function(){e.getLoginStatus(),e.loginStatusCheckerTimes+=1,e.loginStatusCheckerTimes>e.loginStatusCheckerMaxTimes&&i.cancel(e.loginStatusChecker)},e.loginStatusCheckerInterval)},e.$on("$destroy",function(){i.cancel(e.loginStatusChecker)}),e.getQrCodeUrl=function(){return e.loadingWechatLoginUrl=!0,e.loadingWechatLoginUrlErr=void 0,n.generateLoginQrCode().then(function(t){e.loginObj=t.data,e.startGetLoginStatus()},function(t){e.loadingWechatLoginUrlErr=t.data}).finally(function(){e.loadingWechatLoginUrl=!1}),e},e.getQrCodeUrl(),e.loginStatusCheckerTimes=0,e.loginStatusCheckerMaxTimes=5e3,e.loginStatusCheckerInterval=1e3}}};angular.module("shmApp.directives").directive("weChatLoginQrPanel",["appConf","$state","AuthService","$auth","$interval",e])}(),function(){"use strict";var e,t,n,a=function(a,i,o){return e=a,t=i,n=o,{restrict:"AE",scope:{},template:"<loading-bar></loading-bar>",link:function(a){e.setToken(t.params.token),t.params.origurl?n.location.href=decodeURIComponent(t.params.origurl):t.params.itemId?t.go("backend.notes_details",{id:t.params.itemId},{reload:!0}):t.go("backend.dashboard",{},{reload:!0})}}};angular.module("shmApp.directives").directive("loginFromToken",["$auth","$state","$window",a])}(),function(){"use strict";var e,t,n,a=function(a,i,o,r,s){return e=a,t=i,n=o,{restrict:"AE",scope:{},templateUrl:r.rootDir.views+"login/resetPassword.html",link:function(n){n.goToLogin=function(){t.go("login")},n.resetPassword=function(){if(n.invalidLink=!1,n.confirmErr=!1,n.newPassword!==n.confirmPassword)n.confirmErr=!0;else if(n.newPassword){e.setToken(t.params.token);var a={password:n.newPassword};s.resetPassword(a).then(function(e){n.success=!0},function(e){n.invalidLink=!0}).finally(function(){e.setToken(""),e.logout()})}}}}};angular.module("shmApp.directives").directive("resetPassword",["$auth","$state","$window","appConf","AuthService",a])}(),function(){"use strict";var e=function(e,t,n,a,i,o,r,s,c,u,l,p){return{restrict:"AE",scope:{appUser:"<",company:"<",fromWizard:"<",item:"=?",cancelFunc:"&?",itemLoadedFunc:"&?",succFunc:"&?"},templateUrl:e.rootDir.views+"note/noteDetailsEditPanel.html",link:function(i,l,m){i.detailsChanged=!1,window.addEventListener("beforeunload",function(e){!0===i.detailsChanged&&(e.returnValue="You have unfinished changes!")}),i.$on("$stateChangeStart",function(e,t,n){console.log("inside $stateChangeStart"),!0!==i.detailsChanged||"backend.notes_details"===t.name||confirm("You might have unsaved changes. Are you sure you want to leave?")||e.preventDefault()}),i.autoGrow=function(e){console.log(e),e.style.height="5px",e.style.height=e.scrollHeight+"px"},i.validateInputForTextarea=function(e){if(13==e.keyCode){var t=e.target.value,n=t.replace(/\r?\n/gi,"");i.item.title=n}},i.onBlurHanlderForSelect2=function(e){e.searchInput.on("blur",function(){if(-1===e.items.indexOf(e.selected)){var t=e.items[e.activeIndex];e.select(t)}})},i.preCheckingErr=p,i.cancel=function(){_$uibModalInstance.dismiss("cancel")},i.close=function(){_$uibModalInstance.close(i.item)},i.save=function(a){var c={};i.item.is_draft=a||!1,i.item.is_sync_to_market=!i.item.is_draft,i.item.multi_participations=!1,i.item.date_expiry&&null!=i.item.date_expiry?i.item.date_expiry=moment(i.item.date_expiry).format("YYYY-MM-DD HH:mm:ss"):(c.maxUtcDateTime=n.getMaxUtcDateTime(),i.item.date_expiry=c.maxUtcDateTime.format("YYYY-MM-DD HH:mm:ss")),i.item.date_publish=n.getNowUtcDateTime().format("YYYY-MM-DD HH:mm:ss"),i.item.address||(i.item.address=n.getDefaultAddressObj()),i.item.tagNames&&0!=i.item.tagNames.length||(i.item.tagNames=[e.community.note.name]),i.item.id&&""!=i.item.id||(i.item.company_id=i.company.id),"object"==typeof i.item.config&&(i.item.config=JSON.stringify(i.item.config)),c.savingFunc=i.item.id&&""!==i.item.id?t.updateItem(i.item.id,i.item):t.createItem(i.item),c.isNew=!(i.item.id&&""!==i.item.id),i.saving=!0,i.savingErr=void 0,i.savingSuccess=void 0,c.savingFunc.then(function(e){i.item=n.formatItem(e.data),i.savingSuccess=!0,s.success(r.instant("ITEM.UPDATE.SUCCESSFULLY")),c.isNew&&window.localStorage.removeItem("new"),i.clearTmp(),o.go("backend.notes_details",{id:e.data.id},{reload:!0})},function(e){i.gettingDetailsErr=e.data}).finally(function(){i.saving=void 0})},i.getCompanyTags=function(){i.gettingTags=!0,i.gettingDetailsErr=void 0,c.getCompanyTags(i.company.id).then(function(e){i.companyTags=e.data&&e.data.length>0?_.pluck(e.data,"name"):[]},function(e){i.gettingTagsErr=e.data}).finally(function(){i.gettingTags=void 0})},i.showWpBtn=!1,i.getItemDetails=function(e){u.openInIphone()?u.loadWeChatJsConf(n.getCurrentUrl()):u.loadWeChatJsConf(n.getCurrentUrlFromPageState(o)),i.gettingDetails=!0,i.gettingDetailsErr=void 0,t.getItemDetails(i.item.id).then(function(t){i.item=n.formatItem(t.data),i.item.customiseExcerpt=1===i.item.customiseExcerpt,i.item.customiseExcerpt||i.setDefaultExcerpt(),i.item.selectedChannel=[],i.item.id&&i.item.config&&!i.item.config.wpId&&i.company.admin_config.wpLoginName&&i.company.admin_config.wpPassword&&i.company.admin_config.wpUrl&&(i.showWpBtn=!0),"function"==typeof e&&e(i.item)},function(e){i.gettingDetailsErr=e.data}).finally(function(){i.gettingDetails=void 0,i.item&&i.item.id&&i.getItemHistories()})},i.setDefaultExcerpt=function(){var e=document.createElement("DIV");e.innerHTML=i.item.description;var t=e.textContent.split(" ",i.company.setting&&i.company.setting.excerpt_limit||10);i.item.excerpt=t.join(" ")+" ..."},i.itemToLocalStorage=function(e){var t=i.item;t.description=e;window.localStorage.getItem("tmpItemJson");t&&window.localStorage.setItem(t.id||"new",JSON.stringify(t)),i.isEditMode=!1,i.isEditingDesc=!1,i.detailsChanged=!0},i.cancel=function(){!0===i.hasCancelFunc&&i.cancelFunc()()},i.getWhetherToShowCompanyContactInfo=function(){return a.selectedCompany.config&&a.selectedCompany.config.defaultContact&&""!==a.selectedCompany.config.defaultContact},i.itemSaved=function(e){c.getCompanyDetails(i.company.id).then(function(e){i.company=n.formatCompany(i.appUser,e.data),n.setSelectedCompany(i.company),n.updateCompanyInAllStoredCompanies(i.company),i.clearTmp()},function(e){i.savingCompanyErr=e.data}).finally(function(){i.savingCompany=void 0,o.go("backend.notes_details",{id:e.id},{reload:!0})})},i.preSaveCheck=function(e){if(!e.title||""===e.title)return n.getErrorMsgObj(r.instant("NOTE.TITLE.IS_REQUIRED"))},i.getAuthorLinkInfo=function(e){if(i.authorLinkList=[],i.company.config&&i.company.config.authorInfo&&i.company.config.authorInfo.length>0){for(var t=0;t<i.company.config.authorInfo.length;t++)i.authorLinkList.push(i.company.config.authorInfo[t].authorLink);var n=new Set(i.authorLinkList),a=Array.from(n),o=a.slice(0,19);return e&&-1===o.indexOf(e)&&o.unshift(e),o}if("/b/notes/new"==window.location.pathname){var r=[];return i.company.website&&r.push(i.company.website),e&&-1===r.indexOf(e)&&r.unshift(e),r}var r=[];return e&&-1===r.indexOf(e)&&r.unshift(e),r},i.getAuthorInfo=function(e){if(i.authorList=[],i.company.config&&i.company.config.authorInfo&&i.company.config.authorInfo.length>0){for(var t=0;t<i.company.config.authorInfo.length;t++)i.authorList.push(i.company.config.authorInfo[t].author);var n=new Set(i.authorList),a=Array.from(n),o=a.slice(0,19);return e&&-1===o.indexOf(e)&&o.unshift(e),o}if("/b/notes/new"==window.location.pathname){var o=[];return o.push(i.company.name),e&&-1===o.indexOf(e)&&o.unshift(e),o}var o=[];return e&&-1===o.indexOf(e)&&o.unshift(e),o},i.setAuthorLink=function(e){if(i.item.config.ifSaveAuthorInfo=!1,i.company.config.authorInfo){for(var t=i.company.config.authorInfo,n=[],a=0,o=t.length;a<o;a++)t[a].author==e&&n.push(t[a].authorLink);i.item.config.authorLinks=n[n.length-1]}else i.item.config.authorLinks=""},i.getRecords=function(){t.getSyncRecords(i.item.id).then(function(e){e&&e.data&&e.data.data&&e.data.data.length>0&&(i.records=e.data.data)})},i.selectChannel=function(e){i.item.selectedChannel.includes(e)?i.item.selectedChannel.splice(i.item.selectedChannel.indexOf(e),1):i.item.selectedChannel.push(e)},i.setIfSaveAuthorInfo=function(){i.item.config.ifSaveAuthorInfo=!1},i.htmlToPlaintext=function(e){return e?String(e).replace(/<[^>]+>/gm,""):""},i.openedInWechat=u.openedInWeChat()||u.openInWindowsWechat(),i.originalCompany=angular.copy(i.company),i.isEditMode=!1,i.isEditingDesc=!1,i.company&&i.company.id&&i.getCompanyTags(),i.hasCancelFunc="function"==typeof i.cancelFunc&&"function"==typeof i.cancelFunc(),i.item=i.item||{images:[],config:{ifShowCompanyContact:i.getWhetherToShowCompanyContactInfo()}},i.canEdit=!0===i.company.isCompanyAdmin&&!0!==i.company.is_expired||!0===i.appUser.is_admin,i.item.id&&""!==i.item.id?i.getItemDetails(function(e){i.canEdit=0!==parseInt(i.item.active)&&!0===i.canEdit,i.canPushToWP=!(!i.item||!i.item.id),"function"==typeof i.itemLoadedFunc&&"function"==typeof i.itemLoadedFunc()&&i.itemLoadedFunc()(e),window.localStorage.getItem(i.item.id)&&window.localStorage.getItem(i.item.id)!==JSON.stringify(i.item)&&(i.tmpItemJson=window.localStorage.getItem(i.item.id))}):window.localStorage.getItem("new")&&window.localStorage.getItem("new")!==JSON.stringify(i.item)&&(i.tmpItemJson=window.localStorage.getItem("new"));var d={showAll:!1,itemId:i.item.id};c.getChannelConfig(i.company.id,d).then(function(e){e&&e.data&&e.data.length>0&&(i.channels=e.data,i.mainChannelOptions=[{name:r.instant("DEFAULT.MAIN.CHANNEL"),id:null}].concat(i.channels))}),i.restoreTmp=function(){i.item=JSON.parse(i.tmpItemJson),i.restored=!0,i.isEditMode=!1,s.info(r.instant("ITEM.RESTORE.LOCALSTORAGE"))},i.restoreHistory=function(e){i.item=JSON.parse(e.content),"string"==typeof i.item.config&&(i.item.config=JSON.parse(i.item.config)),s.info(r.instant("ITEM.RESTORE.HISTORY"))},i.clearTmp=function(){i.tmpItemJson=void 0,window.localStorage.removeItem(i.item.id||"new")},i.setItemHistories=function(){t.setItemHistories(i.item.id,i.item).then(function(e){s.info(r.instant("ITEM.BACKUP"))})},i.getItemHistories=function(){t.getItemHistories(i.item.id).then(function(e){i.itemHistories=e.data})},i.setHistoriesInterval=setInterval(function(){i.item&&i.item.id&&i.setItemHistories().then(function(e){i.getItemHistories()})},3e5),i.$on("$destroy",function(){window.clearInterval(i.setHistoriesInterval)}),i.scrollToCharts=function(){document.getElementById("recent-visit").scrollIntoView()}}}};angular.module("shmApp.directives").directive("noteDetailsEditPanel",["appConf","ItemService","UtilsService","$rootScope","$interval","$state","$translate","toastr","CompanyService","WeChatService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<",fromWizard:"<",hasArticle:"&?"},templateUrl:e.rootDir.views+"note/noteList.html",link:function(n,a,i){n.switchType=function(e){n.searchObj.selected_type=e,n.getItems()},n.getItems=function(a){var i={page:a||1};i.params={"page-size":n.pageSize,page:i.page,"key-word":n.searchObj.text,community_id:e.community.note.id},i.params=angular.merge({},i.params,n.searchTypes[n.searchObj.selected_type]),n.gettingErr=void 0,n.gettingMoreErr=void 0,i.page>1?n.gettingMore=!0:n.getting=!0,t.searchItemsUnderCompany(n.company.id,i.params).then(function(e){n.itemList&&n.itemList.data&&n.itemList.data.length>0&&i.page>1?(i.previousData=n.itemList.data,n.itemList=e.data,n.itemList.data=i.previousData.concat(e.data.data)):n.itemList=e.data},function(e){i.page>1?n.gettingMoreErr=e.data:n.gettingErr=e.data}).finally(function(){n.getting=void 0,n.gettingMore=void 0,n.itemList&&n.itemList.data&&n.itemList.data.length>0&&n.fromWizard&&n.hasArticle()})},n.pageSize=n.pageSize?n.pageSize:12,n.searchTypes={published:{is_published:1,is_draft:0,is_ended:0},draft:{is_published:0,is_draft:1},ended:{is_published:0,is_ended:1},all:{}},n.searchObj={text:"",selected_type:Object.keys(n.searchTypes)[0]},n.getItems()}}};angular.module("shmApp.directives").directive("noteList",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<",item:"<"},templateUrl:e.rootDir.views+"note/noteGridItem.html",link:function(e,n,a){t.getSyncStatus(e.item.id,e.company.id).then(function(t){t&&t.data&&(e.records=t.data)})}}}
;angular.module("shmApp.directives").directive("noteGridItem",["appConf","ItemService",e])}(),function(){"use strict";var e,t,n,a=function(a,i,o){return e=a,t=i,n=o,{scope:{htmlContent:"=ngModel",callback:"&",firstText:"<?",isEditMode:"="},template:'<mei-pian-style-editor init-data="meiPianArray" change-callback="change" id="mei"></mei-pian-style-editor>',link:function(e,t,n){e.change=function(t){e.mapArrayToHtml(t),e.meiPianArray=t},e.refreshContent=function(t){var n=angular.element(t),a=n.find("div.row");e.meiPianArray=[],angular.forEach(a,function(t){var n=angular.element(t),a={};if(n.find("div[meipian-style-para]").html()&&(a.text=n.find("div[meipian-style-para]").html(),a.onlyText=!0),n.find("img[meipian-style-img]").attr("src")&&(a.img=n.find("img[meipian-style-img]").attr("src")),n.find("source[meipian-style-video]").length>0){a.videoArray=[];var i={};n.find("video[meipian-style-video-control]").length>0&&(i.posterUrl=n.find("video[meipian-style-video-control]")[0].poster),i.url=n.find("source[meipian-style-video]")[0].src,a.videoArray.push(i)}_.isEmpty(a)&&(a.text=n.unwrap().html()),e.meiPianArray.push(a)}),0===e.meiPianArray.length&&e.meiPianArray.push({text:t})},e.mapArrayToHtml=function(t){var n=angular.element("<div meipian-style></div>");angular.forEach(t,function(e){var t=angular.element('<div class="row"></div>');if(e.imgArray&&e.imgArray.length>0&&e.imgArray[0]&&e.imgArray[0].url){var a=angular.element('<img width="100%" meipian-style-img src="'+e.imgArray[0].url+'"/>');t.append(a)}else if(e.img){var a=angular.element('<img width="100%" meipian-style-img src="'+e.img+'"/>');t.append(a)}if(e.videoArray&&e.videoArray.length>0&&e.videoArray[0]&&(e.videoArray[0].video_thumbnail_asset&&e.videoArray[0].video_thumbnail_asset.id||e.videoArray[0].posterUrl&&e.videoArray[0].url))e.videoArray[0].video_thumbnail_asset&&e.videoArray[0].video_thumbnail_asset.id?(i=angular.element('<video meipian-style-video-control poster="'+e.videoArray[0].video_thumbnail_asset.url+'" playsinline width="100%" height="240" controls><source meipian-style-video src="'+e.videoArray[0].url+'" type="video/mp4"></video>'),t.append(i)):e.videoArray[0].posterUrl&&e.videoArray[0].url&&(i=angular.element('<video meipian-style-video-control poster="'+e.videoArray[0].posterUrl+'" playsinline width="100%" height="240" controls><source meipian-style-video src="'+e.videoArray[0].url+'" type="video/mp4"></video>'),t.append(i));else if(e.video){var i={};i=angular.element('<video meipian-style-video-control playsinline width="100%" height="240" controls><source meipian-style-video src="'+e.video+'" type="video/mp4"></video>'),t.append(i)}if(e.text){var o=angular.element("<div meipian-style-para>"+e.text+"</div>");t.append(o)}n.append(t)}),e.callback()(n[0].outerHTML)},e.refreshContent(e.htmlContent),e.$watch("isEditMode",function(e,t,n){n.refreshContent(n.htmlContent)})}}};angular.module("shmApp.directives").directive("itemDescEditor",["appConf","$interval","$sce",a])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{scope:{htmlContent:"=ngModel",callback:"&ngChange",isEditMode:"="},template:'<div class="desc-previewer"><div class="preview-content" ng-bind-html="trustContent"></div><div class="edit-icon" ng-click="isEditMode = true"><i class="fa fa-pencil"></i>{{ "EDIT" | translate }}</div></div>',link:function(e,n,a){e.$watch("htmlContent",function(n){e.trustContent=t.trustAsHtml(n)})}}};angular.module("shmApp.directives").directive("itemDescEditorPreviewer",["appConf","$sce",n])}(),function(){"use strict";var e,t=function(t,n){return e=n,{scope:{data:"<initData",change:"&changeCallback"},templateUrl:t.rootDir.views+"note/meiPianStyleEditor.html",link:function(t,n,a){t.updateDataCallback=function(e,n){var a=t.data;a[e].text=n,t.change()(a),t.data=a},t.addNewOnlyText=function(e){var n=t.data;n.splice(e+1,0,{text:"",onlyText:"true"}),t.change()(n),t.data=n},t.addVideo=function(e,n){var a=t.data;a.splice(n+1,0,{videoArray:[e]}),t.change()(a),t.data=a},t.addEachImg=function(e,n,a){var i=t.data,o=n+a;i.splice(o+1,0,{singleImg:"",imgArray:[e]}),t.change()(i),t.data=i},t.remove=function(e){var n=t.data;n.splice(e,1),t.change()(n),t.data=n},t.moveUp=function(e){if(e>0){var n=t.data,a=angular.copy(n[e]),i=angular.copy(n[e-1]);t.data[e]=i,t.data[e-1]=a,t.change()(n),t.data=n}},t.moveDown=function(e){if(e<t.data.length-1){var n=t.data,a=angular.copy(n[e]),i=angular.copy(n[e+1]);t.data[e]=i,t.data[e+1]=a,t.change()(n),t.data=n}},t.sortableOptions={handle:".myHandle",stop:function(e,n){t.data=angular.copy(t.data)}},t.openInIphone=e.openInIphone()}}};angular.module("shmApp.directives").directive("meiPianStyleEditor",["appConf","WeChatService",t])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{errorObj:"<"},templateUrl:t.rootDir.views+"note/alterMediaSizeExceed.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("alterMediaSizeExceed",["appConf",t])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"product/productList.html",link:function(n,a,i){n.getItems=function(a){var i={page:a||1};i.params={"page-size":n.pageSize,page:i.page,"key-word":n.searchObj.text,community_id:e.community.note.id},i.params=angular.merge({},i.params,n.searchTypes[n.searchObj.selected_type]),n.gettingErr=void 0,n.gettingMoreErr=void 0,i.page>1?n.gettingMore=!0:n.getting=!0,t.searchItemsUnderCompanyOnlyForProduct(n.company.id,i.params).then(function(e){n.itemList&&n.itemList.data&&n.itemList.data.length>0&&i.page>1?(i.previousData=n.itemList.data,n.itemList=e.data,n.itemList.data=i.previousData.concat(e.data.data)):n.itemList=e.data},function(e){i.page>1?n.gettingMoreErr=e.data:n.gettingErr=e.data}).finally(function(){n.getting=void 0,n.gettingMore=void 0})},n.switchType=function(e){n.searchObj.selected_type=e,n.getItems()},n.pageSize=n.pageSize?n.pageSize:12,n.searchTypes={selling:{is_draft:0,is_expired:0,is_sold:0},sold:{is_sold:1},expired:{is_expired:1,is_sold:0,is_draft:0},draft:{is_draft:1},all:{}},n.searchObj={text:"",selected_type:Object.keys(n.searchTypes)[0]},n.getItems()}}};angular.module("shmApp.directives").directive("productList",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",item:"<"},templateUrl:e.rootDir.views+"product/productGridItem.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("productGridItem",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",company:"<",item:"=?",cancelFunc:"&?",itemLoadedFunc:"&?",succFunc:"&?"},templateUrl:e.rootDir.views+"product/productDetails.html",link:function(e,a,r){e.getItemDetails=function(a){e.gettingDetails=!0,e.gettingDetailsErr=void 0,t.getItemDetails(e.item.id).then(function(t){e.item=n.formatItem(t.data),"function"==typeof a&&a(e.item)},function(t){e.gettingDetailsErr=t.data}).finally(function(){e.gettingDetails=void 0})},e.cancel=function(){!0===e.hasCancelFunc&&e.cancelFunc()()},e.itemSaved=function(e){i.go("backend.product_details",{id:e.id},{reload:!0})},e.preSaveCheck=function(e){return e.title&&""!==e.title?e.price&&""!==e.price?void 0:n.getErrorMsgObj(o.instant("PRODUCT.PRICE.IS_REQUIRED")):n.getErrorMsgObj(o.instant("PRODUCT.TITLE.IS_REQUIRED"))},e.hasCancelFunc="function"==typeof e.cancelFunc&&"function"==typeof e.cancelFunc(),e.item=e.item||{images:[],config:{}},e.isSameCompany=!1,e.canEdit=!0===e.company.isCompanyAdmin||!0===e.appUser.is_admin,e.item.id&&""!==e.item.id&&e.getItemDetails(function(t){e.canEdit=0!==parseInt(e.item.active)&&!0===e.canEdit,"function"==typeof e.itemLoadedFunc&&"function"==typeof e.itemLoadedFunc()&&e.itemLoadedFunc()(t)})}}};angular.module("shmApp.directives").directive("productDetails",["appConf","ItemService","UtilsService","$rootScope","$state","$translate",e])}(),function(){"use strict";var e=function(e,t,n){return{restrict:"AE",scope:{appUser:"<",item:"=",company:"<",formObj:"="},templateUrl:e.rootDir.views+"product/jielongDetailList.html",link:function(e,a,i){e.addMoreProduct=function(){var t={images:[]};e.item.children.push(t)},e.delete=function(t){e.item.children.splice(t,1)},e.getItemPropertiesTypes=function(){t.getPropertyTypes().then(function(t){e.propertyTypes=t.data},function(t){e.errLoadingPropertyTypes=t.data})},e.getCompanyLocations=function(){n.getCompanyPickupLocations(e.company.id).then(function(t){e.locations=t.data,e.ifSelectLocations=!1})},e.selectAllLocations=function(t,n){e.item.children[t].locations=n?e.locations:[]},e.item.id||(e.item.children=[{images:[]}]),e.canEdit=!0===e.company.isCompanyAdmin||!0===e.appUser.is_admin,e.getItemPropertiesTypes(),e.getCompanyLocations()}}};angular.module("shmApp.directives").directive("jielongDetailList",["appConf","ItemService","CompanyService",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<?",succFunc:"&?"},templateUrl:e.rootDir.views+"signUp/signUpPanel.html",link:function(e,r,s){e.loginWithToken=function(t){e.loggingIn=!0,e.loggingInErr=void 0,a.loginWithTempCode(t).then(function(t){t.data&&t.data.return_code&&(n.cancel(e.applicationChecker),i.setToken(t.data.return_code),o.go("backend.dashboard",{},{reload:!0}))},function(t){e.loggingInErr=t.data}).finally(function(){e.loggingIn=void 0})},e.getApplicationStatus=function(){e.gettingApplicationStatus=!0,e.gettingApplicationStatusErr=void 0,t.checkApplicationStatus(e.application.applicationId).then(function(t){t.data&&t.data.shortToken&&""!==t.data.shortToken&&(n.cancel(e.applicationChecker),e.loginWithToken(t.data.shortToken))},function(t){e.gettingApplicationStatusErr=t.data}).finally(function(){e.gettingApplicationStatus=void 0})},e.startGetApplicationStatus=function(){e.applicationCheckerTimes=0,e.applicationChecker=n(function(){e.getApplicationStatus(),e.applicationCheckerTimes+=1,e.applicationCheckerTimes>e.applicationCheckerMaxTimes&&n.cancel(e.applicationChecker)},1e3)},e.preApplyCheck=function(){var n={};n.params=e.newCompany,e.preChecking=!0,e.preCheckingErr=void 0,e.confirmErr=!1,e.newCompany.password!==e.newCompany.confirm?(e.confirmErr=!0,e.preChecking=void 0):t.applyCompany(n.params).then(function(t){e.applying=!0,e.application=t.data},function(t){e.preCheckingErr=t.data,console.log(e.preCheckingErr)}).finally(function(){e.preChecking=void 0})},e.cancelPreApplyCheck=function(){e.applying=void 0},e.createACompany=function(){e.submitting=!0,e.submittingErr=void 0,t.applyCompany(e.newCompany).then(function(t){"function"==typeof e.succFunc&&"function"==typeof e.succFunc()&&e.succFunc()(t.data)},function(t){e.submittingErr=t.data}).finally(function(){e.submitting=void 0})},e.goToLogin=function(){o.go("login")},e.newCompany={},e.applicationCheckerTimes=0,e.applicationCheckerMaxTimes=5e3}}};angular.module("shmApp.directives").directive("signUpPanel",["appConf","CompanyService","$interval","AuthService","$auth","$state",e])}(),function(){"use strict";var e=function(e,t,n,a){var i=this;i.deleteComment=t,i.cancel=function(){e.dismiss("cancel")},i.delete=function(){e.dismiss("cancel"),t(n,a)}},t=function(t,n,a){return{restrict:"AE",scope:{appUser:"<",item:"<"},templateUrl:t.rootDir.views+"comment/itemCommentList.html",link:function(i,o,r){i.hide=function(e){document.getElementById(e).style.display="none"},i.append=function(e){if(e.parent_id){i.itemCommentsList.data.find(function(t){return t.id==e.root_id}).replys.unshift(e)}else i.itemCommentsList.data.unshift(e)},i.removeComment=function(e,a){var o=a||e,r=document.getElementById("comment-box-"+o.id);if(r.style.opacity=.2,o.channel){var s={commentId:o.id};n.deleteChannelComment(o.channel.id,s).then(function(e){},function(e){i.fetchingCommentsError=e.data}).finally(function(t){r.style.opacity=1;var n=i.itemCommentsList.data.findIndex(function(t){return t.id==e.id});if(a){var o=i.itemCommentsList.data[n].replys.findIndex(function(e){return e.id==a.id});i.itemCommentsList.data[n].replys.splice(o,1)}else i.itemCommentsList.data.splice(n,1)})}else{var s={item_url:t.url.api()+"/item/redirect?itemId="+o.item_id};n.setCommentsDeactivate(o.id,s).then(function(e){},function(e){i.gettingItemCommentsErr=e.data}).finally(function(t){r.style.opacity=1;var n=i.itemCommentsList.data.findIndex(function(t){return t.id==e.id});if(a){var o=i.itemCommentsList.data[n].replys.findIndex(function(e){return e.id==a.id});i.itemCommentsList.data[n].replys.splice(o,1)}else i.itemCommentsList.data.splice(n,1)})}},i.deleteComment=function(n,o){a.open({animation:!0,templateUrl:t.rootDir.views+"deleteBtn.html",controller:["$uibModalInstance","deleteComment","comment","reply",e],controllerAs:"mdCtrl",resolve:{deleteComment:function(){return i.removeComment},comment:function(){return n},reply:function(){return o}}})},i.getCommentsForAnItem=function(e){var t={};t.pageNo=e||1,i.gettingItemCommentsErr=void 0,i.gettingMoreItemCommentsErr=void 0,1===t.pageNo?i.gettingItemComments=!0:i.gettingMoreItemComments=!0,n.getNormalCommentsForAnItem(i.item.id).then(function(e){1!==t.pageNo&&(t.previousData=i.itemCommentsList.data),i.itemCommentsList=e.data,1!==t.pageNo&&(i.itemCommentsList.data=t.previousData.concat(i.itemCommentsList.data))},function(e){1===t.pageNo?i.gettingItemCommentsErr=e.data:i.gettingMoreItemCommentsErr=e.data}).finally(function(){i.gettingItemComments=!1,i.gettingMoreItemComments=!1})},i.renderContent=function(e){return e.replace("row","")},i.getCommentsForAnItem()}}};angular.module("shmApp.directives").directive("itemCommentList",["appConf","ItemService","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a){var i=this;i.deleteComment=t,i.cancel=function(){e.dismiss("cancel")},i.delete=function(){e.dismiss("cancel"),t(n,a)}},t=function(t,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:t.rootDir.views+"comment/companyCommentList.html",link:function(o,r,s){o.hide=function(e){document.getElementById(e).style.display="none"},o.append=function(e){if(e.parent_id){o.itemCommentsList.data.find(function(t){return t.id==e.root_id}).replys.unshift(e)}else o.itemCommentsList.data.unshift(e)},o.naviToItem=function(e){n.go("backend.notes_details",{id:e.id},{})},o.deleteComment=function(n,a){i.open({animation:!0,templateUrl:t.rootDir.views+"deleteBtn.html",controller:["$uibModalInstance","deleteComment","comment","reply",e],controllerAs:"mdCtrl",resolve:{deleteComment:function(){return o.removeComment},comment:function(){return n},reply:function(){return a}}})},o.removeComment=function(e,n){var i=n||e,r=document.getElementById("comment-box-"+i.id);if(r.style.opacity=.2,i.channel){var s={commentId:i.id};a.deleteChannelComment(i.channel.id,s).then(function(e){},function(e){o.fetchingCommentsError=e.data}).finally(function(t){r.style.opacity=1;var a=o.itemCommentsList.data.findIndex(function(t){return t.id==e.id});if(n){var i=o.itemCommentsList.data[a].replys.findIndex(function(e){return e.id==n.id});o.itemCommentsList.data[a].replys.splice(i,1)}else o.itemCommentsList.data.splice(a,1)})}else{var s={item_url:t.url.api()+"/item/redirect?itemId="+i.item_id};a.setCommentsDeactivate(i.id,s).then(function(e){},function(e){o.gettingItemCommentsErr=e.data}).finally(function(t){r.style.opacity=1;var a=o.itemCommentsList.data.findIndex(function(t){return t.id==e.id});if(n){var i=o.itemCommentsList.data[a].replys.findIndex(function(e){return e.id==n.id});o.itemCommentsList.data[a].replys.splice(i,1)}else o.itemCommentsList.data.splice(a,1)})}},o.getCommentsForCompany=function(e){var t={};t.pageNo=e||1,o.gettingItemCommentsErr=void 0,o.gettingMoreItemCommentsErr=void 0,1===t.pageNo?o.gettingItemComments=!0:o.gettingMoreItemComments=!0,a.getCommentsForCompany(o.company.id).then(function(e){1!==t.pageNo&&(t.previousData=o.itemCommentsList.data),o.itemCommentsList=e.data,1!==t.pageNo&&(o.itemCommentsList.data=t.previousData.concat(o.itemCommentsList.data))},function(e){1===t.pageNo?o.gettingItemCommentsErr=e.data:o.gettingMoreItemCommentsErr=e.data}).finally(function(){o.gettingItemComments=!1,o.gettingMoreItemComments=!1})},o.renderContent=function(e){return e.replace("row","")},o.getCommentsForCompany()}}};angular.module("shmApp.directives").directive("companyCommentList",["appConf","$state","ItemService","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o){var r=this;r.appUser=t,r.comment=n,r.cancel=function(){e.dismiss("cancel")},r.ok=function(){e.dismiss("cancel"),i()(r.newComment)},r.addComment=function(){if(n.channel){var e={reply_to_comment_id:n.id,content:r.message,itemId:r.comment.item_id};r.sending=!0,o.addChannelComment(n.channel.id,e).then(function(e){r.newComment=e.data,r.savingSuccess=!0},function(e){r.savingSuccess=!1,r.error=e.data}).finally(function(){r.sending=!1})}else{var e={comments:r.message,item_url:a.url.api()+"/item/redirect?itemId="+r.comment.item_id,reply_to_comment_id:r.comment.id,is_private:!1};r.sending=!0,o.addCommentToAnItem(r.comment.item_id,e).then(function(e){r.newComment=e.data,r.savingSuccess=!0},function(e){r.savingSuccess=!1,r.error=e.data}).finally(function(){r.sending=!1})}}},t=function(t,n,a){return{restrict:"A",scope:{appUser:"<",comment:"=",succFunc:"&?"},link:function(n,i,o){i.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"comment/replyBtn.html",controller:["$uibModalInstance","appUser","comment","appConf","succFunc","ItemService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return n.appUser},comment:function(){return n.comment},appConf:function(){return t},succFunc:function(){return n.succFunc}}})})}}};angular.module("shmApp.directives").directive("replyBtn",["appConf","UtilsService","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"staff/staffList.html",link:function(e,i,o){e.searchObject={text:""},e.getItems=function(a){var i={page:a||1};i.params={"page-size":e.pageSize,page:i.page},e.gettingErr=void 0,e.gettingMoreErr=void 0,i.page>1?e.gettingMore=!0:e.getting=!0,t.getUserList(e.company.id,i.params).then(function(t){e.itemList&&e.itemList.data&&e.itemList.data.length>0&&i.page>1?(i.previousData=e.itemList.data,e.itemList.data=t.data.list,e.itemList.data=i.previousData.concat(e.itemList.data)):e.itemList={data:t.data.list,total:t.data.list.length},n.displayCounts=e.itemList.total},function(t){i.page>1?e.gettingMoreErr=t.data:e.gettingErr=t.data}).finally(function(){e.getting=void 0,e.gettingMore=void 0})},e.company=a.formatCompany(e.appUser,e.company),!0!==e.company.isCurrentUserAdmin&&!0!==e.appUser.is_admin||e.getItems()}}};angular.module("shmApp.directives").directive("staffList",["appConf","CompanyService","$rootScope","UtilsService",e])}(),function(){"use strict";var e,t=function(t,n,a,i){e=this,e.staff=n,e.company=a,e.cancel=function(){t.dismiss("cancel")},e.removeUserFromCompany=function(){e.removingUserFromCompany=!0,e.removingUserFromCompanyErr=void 0,i.deleteCompanyUser(e.company.id,e.staff.user.id).then(function(e){t.close(e.data&&e.data.success&&!0===e.data.success)},function(t){e.removingUserFromCompanyErr=t.data}).finally(function(){e.removingUserFromCompany=void 0})}},n=function(e,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",company:"<",staff:"="},templateUrl:e.rootDir.views+"staff/staffListItem.html",link:function(r,s,c){r.changeRole=function(e){!0===r.canChange&&(r.savingStaff=!0,r.savingStaffErr=void 0,n.updateCompanyUser(r.company.id,r.staff.user.id,{is_admin:e}).then(function(t){!0===t.data.success&&(r.staff.role_id=e)},function(e){alert(e.data),r.savingStaffErr=e.data}).finally(function(){r.savingStaff=void 0}))},r.removePending=function(){!0===r.canChange&&!0===r.staff.pending&&(r.savingStaff=!0,r.savingStaffErr=void 0,n.approveCompanyStaff(r.company.id,{user_id:r.staff.user.id}).then(function(e){e.data.id&&e.data.id===r.staff.id&&(r.staff.pending=!1)},function(e){alert(e.data),r.savingStaffErr=e.data}).finally(function(){r.savingStaff=void 0}))},r.confirmRemoveUserFromCompany=function(){a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.rootDir.views+"staff/confirmRemoveUserFromCompany.html",controller:["$uibModalInstance","staff","company","CompanyService",t],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{staff:function(){return r.staff},company:function(){return r.company}}}).result.then(function(e){!0===e&&(r.staff.active=0)})},r.company=i.formatCompany(o.appUser,r.company),r.canChange=(!0===r.company.isCompanyAdmin||!0===o.appUser.is_admin)&&o.appUser.id!==r.staff.user.id}}};angular.module("shmApp.directives").directive("staffListItem",["appConf","CompanyService","$uibModal","UtilsService","$rootScope",n])}(),function(){"use strict";var e,t=function(t,n,a,i,o,r,s,c){e=this,e.staff=i,e.company=o,e.genQRCode=function(){e.generatingImg=!0,e.generatingImgErr=void 0;var a={};a.url=t.url.webAddress+n.href("addUserToCompany",{companyId:e.company.id},{absolute:!1}),r.genAddUserQRCode(e.company.id,a).then(function(t){e.qrCodeUrl=t.data.url},function(t){e.generatingImgErr=t.data,console.log(t)}).finally(function(){e.generatingImg=!1})},e.getStaffList=function(){r.getUserList(e.company.id).then(function(t){e.staffList=t.data},function(t){e.gettingErr=t.data}).finally(function(){e.getting=void 0})},e.cancel=function(){a.dismiss("cancel")},e.getStaffList(),e.company=c.formatCompany(s.appUser,e.company),e.canAdd=!0===e.company.isCompanyAdmin||!0===s.appUser.is_admin,!0===e.canAdd&&e.genQRCode()},n=function(e,n){return{restrict:"A",scope:{appUser:"<",company:"<"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.rootDir.views+"staff/staffDetailsEdit.html",controller:["appConf","$state","$uibModalInstance","staff","company","CompanyService","$rootScope","UtilsService",t],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{staff:function(){return a.staff},company:function(){return a.company}}})})}}};angular.module("shmApp.directives").directive("staffListNewItemBtn",["appConf","$uibModal",n])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<",pageSize:"<?"},templateUrl:e.rootDir.views+"notification/notificationList.html",link:function(e,n,a){e.pageSize=e.pageSize?e.pageSize:3,e.getNotifications=function(n){var a={page:n||1};a.page>1?e.gettingMore=!0:e.getting=!0,e.gettingErr=void 0,e.gettingMoreErr=void 0,t.getCompanyComments(e.company.id,{"page-size":e.pageSize,page:a.page}).then(function(t){e.itemList&&e.itemList.data&&a.page>1?(a.previousData=e.itemList.data,e.itemList=t.data,e.itemList.data=a.previousData.concat(e.itemList.data)):e.itemList=t.data},function(t){a.page>1?e.gettingMoreErr=t.data:e.gettingErr=t.data}).finally(function(){e.getting=void 0,e.gettingMore=void 0})},e.addedNewNotification=function(t){e.itemList.data.unshift(t),e.itemList.total=1*e.itemList.total+1},e.getNotifications()}}};angular.module("shmApp.directives").directive("notificationList",["appConf","CompanyService",e])}(),function(){"use strict";var e=function(e,t){this.loginObj=t},t=function(t,n,a,i,o,r,s,c,u){return{restrict:"AE",scope:{appUser:"<?"},templateUrl:t.rootDir.views+"user/socialAccountMerger.html",link:function(t,n,a){t.findUser=function(e){t.loginObj=void 0,t.appUser.id===e?t.notFound=!0:o.getUser(e).then(function(e){e.data&&e.data.id?t.foundAccount=e.data:t.notFound=!0}),u.dismissAll()},t.getLoginStatus=function(){t.gotLoginStatus=void 0,t.gettingLoginStatus=!0,t.gettingLoginStatusErr=void 0,t.token=s.getToken(),o.checkLoginStatus(t.loginObj.subscribeLoginLogId).then(function(e){e.data&&e.data.log&&e.data.log.user_id&&""!==e.data.log.user_id&&(r.cancel(t.loginStatusChecker),t.gotLoginStatus=!0,t.findUser(e.data.log.user_id))},function(e){t.gettingLoginStatusErr=e.data}).finally(function(){t.gettingLoginStatus=void 0})},t.startGetLoginStatus=function(){t.loginStatusCheckerTimes=0,t.loginStatusChecker=r(function(){t.getLoginStatus(),t.loginStatusCheckerTimes+=1,t.loginStatusCheckerTimes>t.loginStatusCheckerMaxTimes&&r.cancel(t.loginStatusChecker)},t.loginStatusCheckerInterval)},t.showQrCode=function(){return t.loadingWechatLoginUrl=!0,t.loadingWechatLoginUrlErr=void 0,o.generateLoginQrCode().then(function(e){t.loginObj=e.data,t.startGetLoginStatus()},function(e){t.loadingWechatLoginUrlErr=e.data}).finally(function(){t.loadingWechatLoginUrl=!1,c.open({animation:!0,template:' <div class="text-center"><img id="qrcode" ng-show="mdCtrl.loginObj.qrcode" ng-src="{{mdCtrl.loginObj.qrcode}}" class="image"/></div>',controller:["$uibModalInstance","loginObj",e],controllerAs:"mdCtrl",resolve:{loginObj:function(){return t.loginObj}}})}),t},t.clearFoundAccount=function(){t.foundAccount=void 0},t.loginStatusCheckerTimes=0,t.loginStatusCheckerMaxTimes=1e3,t.loginStatusCheckerInterval=1e3}}};angular.module("shmApp.directives").directive("socialAccountMerger",["appConf","toastr","$translate","$state","AuthService","$interval","$auth","$uibModal","$uibModalStack",t])}(),function(){"use strict";var e=function(e,t,n){return{restrict:"AE",scope:{account:"=ngModel",clear:"&?"},templateUrl:e.rootDir.views+"user/accountCard.html",link:function(e,t,n){e.merge=function(){e.merged=!0}}}};angular.module("shmApp.directives").directive("accountCard",["appConf","toastr","$translate",e])}(),function(){"use strict";var e=function(e,t,n){return{restrict:"AE",scope:{},templateUrl:e.rootDir.views+"user/validateEmail.html",link:function(e,a,i){e.loading=!0,e.success=!1,e.failure=!1,e.goToLogin=function(){t.go("login")},e.confirmEmail=function(){var a={token:t.params.token,newEmail:t.params.email};console.log(a),n.confirmEmail(a).then(function(t){t.data&&t.data.success?e.success=!0:e.failure=!0}).finally(function(){e.loading=!1})},t.params.token&&t.params.email&&e.confirmEmail()}}};angular.module("shmApp.directives").directive("validateEmail",["appConf","$state","AuthService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",item:"<",selectMode:"<?",selectedItem:"=?"},templateUrl:e.rootDir.views+"voucher/voucherGridItem.html",link:function(e,t,n){e.changeList=function(){e.selectedItem&&e.selectedItem.entity_id===e.item.id?e.selectedItem=void 0:e.selectedItem={entity_name:"App\\Modules\\Platform\\Models\\CompanyVoucherGroup",entity_id:e.item.id,entity:e.item}},e.maxOwnerShowing=4}}};angular.module("shmApp.directives").directive("voucherGridItem",["appConf","ItemService",e])}(),function(){"use strict";var e={available:1,expired:2,deleted:3,all:void 0},t=function(t,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:t.rootDir.views+"voucher/voucherList.html",link:function(t,o,r){t.pageSize=t.pageSize?t.pageSize:12,t.searchTypes=e,t.type=e.available,t.searchObject={text:""},t._getItems=function(e,i){var o={page:e};n.displayCounts="",t.gettingErr=void 0,t.gettingMoreErr=void 0,o.page>1?t.gettingMore=!0:t.getting=!0,a.getVoucherGroupsUnderCompany(t.company.id,i).then(function(e){t.itemList&&t.itemList.data&&t.itemList.data.length>0&&o.page>1?(o.previousData=t.itemList.data,t.itemList=e.data,t.itemList.data=o.previousData.concat(e.data.data)):t.itemList=e.data,n.displayCounts=e.data.to?e.data.to+"/"+e.data.total:""},function(e){o.page>1?t.gettingMoreErr=e.data:t.gettingErr=e.data}).finally(function(){t.getting=void 0,t.gettingMore=void 0})},t.switchType=function(e){t.type=e,t.getItems()},t.navigateTo=function(e){i.go(e)},t.getItems=function(n){var a={page:n||1};switch(a.params={"page-size":t.pageSize,page:a.page},t.searchObject&&t.searchObject.text&&""!=t.searchObject.text&&(a.params["key-word"]=t.searchObject.text),t.type){case e.available:a.params.available=1;break;case e.expired:a.params.unavailable=1;break;case e.deleted:a.params.deleted=1}t._getItems(n,a.params)},t.getItems()}}};angular.module("shmApp.directives").directive("voucherList",["appConf","$rootScope","CompanyService","$state",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",company:"<",voucherId:"<?",cancelFunc:"&?"},templateUrl:e.rootDir.views+"voucher/voucherDetails.html",link:function(e,r,s){e.getVoucherGroup=function(n){e.gettingVoucher=!0,t.getVoucherGroupById(e.voucherId).then(function(t){e.voucherGroup=t.data,e.voucherGroup.end_date=moment(moment.utc(e.voucherGroup.end_date)).local().format("YYYY-MM-DD HH:mm"),a.editingVoucher=e.voucherGroup,"function"==typeof n&&n(e.voucherGroup)},function(t){e.gettingVoucherError=t.data}).finally(function(){e.gettingVoucher=!1})},e.startDateBeforeRender=function(e){var t=new Date,n=new Date(t);n.setDate(t.getDate()+1),n.setUTCHours(0,0,0,0),e.filter(function(e){return e.utcDateValue<n.getTime()}).forEach(function(e){e.selectable=!1})},e.cancel=function(){!0===e.hasCancelFunc&&e.cancelFunc()()},e.voucherSaved=function(e){o.go("backend.vouchers_details",{voucherGroupId:e.id},{reload:!0})},e.formatVoucher=function(t){return t.reedm_desc&&""!==t.reedm_desc||(t.reedm_desc=e.company.config&&e.company.config.defaultRedeemDesc?e.company.config.defaultRedeemDesc:""),t},e.getPreSaveCheckErr=function(){e.savingError={};var t={validObj:[]};if(e.voucherGroup.title&&""!==e.voucherGroup.title||(e.savingError.title=n.instant("VOUCHER.ERROR.TITLE.REQUIRED"),t.validObj.push(e.savingError.title)),e.voucherGroup.quantity&&""!==e.voucherGroup.quantity||(e.savingError.quantity=n.instant("VOUCHER.ERROR.QUANTITY.REQUIRED"),t.validObj.push(e.savingError.quantity)),e.voucherGroup.end_date&&""!==e.voucherGroup.end_date||(e.savingError.end_date=n.instant("VOUCHER.ERROR.EXPIRE_DATE.REQUIRED"),t.validObj.push(e.savingError.end_date)),e.voucherGroup.reedm_desc&&""!==e.voucherGroup.reedm_desc||(e.savingError.reedm_desc=n.instant("VOUCHER.ERROR.REDEEM.REQUIRED"),t.validObj.push(e.savingError.reedm_desc)),t.validObj.length>0)return i.getErrorMsgObj("",{"":t.validObj})},e.hasCancelFunc="function"==typeof e.cancelFunc&&"function"==typeof e.cancelFunc(),e.company=i.formatCompany(e.appUser,e.company),e.voucherId?e.getVoucherGroup(function(t){e.canEdit=!0===e.company.isCompanyAdmin&&""!==t.id||!0===e.appUser.is_admin,e.voucherGroup=e.formatVoucher(t)}):(e.canEdit=!0===e.company.isCompanyAdmin&&!0!==e.company.is_expired||!0===e.appUser.is_admin,e.voucherGroup=e.formatVoucher({company_id:e.company.id}),e.gettingVoucher=!1)}}};angular.module("shmApp.directives").directive("voucherDetails",["appConf","CompanyService","$translate","$rootScope","UtilsService","$state",e])}(),function(){"use strict";var e=function(e,t,n,a){var i=this;i.appUser=t,i.voucher=n,i.cancel=function(){e.dismiss("cancel")},i.getQrCodes=function(){i.totalQrCodes=0,i.getting=!0,i.gettingErr=void 0,a.genVoucherQrCode(i.voucher.id).then(function(e){i.qrcodes=e.data,angular.forEach(i.qrcodes,function(e,t){e&&null!==e&&""!==e?i.totalQrCodes=1*i.totalQrCodes+1:delete i.qrcodes[t]})},function(e){i.gettingErr=e.data}).finally(function(){i.getting=void 0})},i.getQrCodes()},t=function(t,n){return{restrict:"AE",scope:{appUser:"<",voucher:"<"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"voucher/voucherQrCodePanel.html",controller:["$uibModalInstance","appUser","voucher","CompanyService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return a.appUser},voucher:function(){return a.voucher}}})})}}};angular.module("shmApp.directives").directive("voucherGroupQrCodePopupBtn",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o){var r=this;r.appUser=t,r.company=n,r.voucher=a,r.preCheckingErr=i,r.cancel=function(){e.dismiss("cancel")},r.save=function(){var t={};t.voucherData=angular.copy(r.voucher),t.voucherData.end_date=moment(moment(r.voucher.end_date)).utc().format("YYYY-MM-DD HH:mm:ss"),t.voucherData.voucher_img=t.voucherData.images[0]?t.voucherData.images[0]:"",
t.savingFunc=r.voucher.id&&""!==r.voucher.id?o.updateCompanyVoucherGroup(r.voucher.id,t.voucherData):o.createCompanyVoucherGroup(t.voucherData),r.saving=!0,r.savingErr=void 0,t.savingFunc.then(function(t){r.voucher=t.data,e.close(r.voucher)},function(e){r.savingErr=e.data}).finally(function(){r.saving=void 0})}},t=function(t,n,a,i){return{restrict:"A",scope:{appUser:"<",company:"<",voucherSaveBtn:"=",succFunc:"&?",getPreCheckErrFunc:"&?"},link:function(o,r,s){r.on("click",function(){o.voucher=o.voucherSaveBtn,n.open({animation:!0,templateUrl:t.rootDir.views+"voucher/confirmSave.html",controller:["$uibModalInstance","appUser","company","voucher","preCheckingErr","CompanyService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return o.appUser},company:function(){return o.company},voucher:function(){return o.voucher},preCheckingErr:function(){if("function"==typeof o.getPreCheckErrFunc&&"function"==typeof o.getPreCheckErrFunc())return o.getPreCheckErrFunc()(o.voucher)}}}).result.then(function(e){o.voucher.id&&""!==o.voucher.id?a.success(i.instant("ITEM.UPDATE.SUCCESSFULLY")):a.success(i.instant("ITEM.CREATE.SUCCESSFULLY")),"function"==typeof o.succFunc&&"function"==typeof o.succFunc()&&o.succFunc()(e)})})}}};angular.module("shmApp.directives").directive("voucherSaveBtn",["appConf","$uibModal","toastr","$translate",t])}(),function(){"use strict";var e,t=function(t,n,a){e=this,e.customerServiceQrcodes=[n.rootDir.images+"kefu_new_1.png",n.rootDir.images+"kefu_new_4.png"],e.cancel=function(){t.close("cancel")},e.send=function(){var t={email:e.email,phone:e.phone,company:e.company,message:e.message};e.sending=!0,a.sendRequest(t).then(function(t){e.savingSuccess=!0},function(t){e.savingSuccess=!1,e.error=t.data}).finally(function(){e.sending=!1})}},n=function(e,n,a,i,o){return{restrict:"AE",scope:{title:"@?",btnText:"@?"},template:'<div class="ask-customer-service-panel-wrapper text-center"><div class="panel-title" ng-if="title != \'\'">{{title}}</div><div class="panel-body"><button type="button" class="btn btn-info" ng-click="showContacts()" title="{{\'CUSTOMER_SERVICE.CLICK_HERE_TO_SHOW_CONTACTS\' | translate}}"><i class="fa fa-link"></i> <span>{{btnText}}</span></button></div></div>',link:function(e,o,r){e.showContacts=function(){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:i.rootDir.views+"contactUs.html",controller:["$uibModalInstance","appConf","CompanyService",t],controllerAs:"mdCtrl",size:void 0,appendTo:void 0})},e.btnText=e.btnText||a.instant("CLICK_HERE_TO_SHOW_CUSTOMER_CONTACTS")}}};angular.module("shmApp.directives").directive("askCustomerServicePanel",["$rootScope","$uibModal","$translate","appConf","CompanyService",n])}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{},template:'<div class="count-to">{{displayingNumber}}</div>',link:function(t,n,a){t.update=function(){t.displayingNumber>=t.maxNumber?e.cancel(t.updater):t.displayingNumber=1*t.displayingNumber+1},t.displayingNumber=0,t.maxNumber=a.countTo,t.updater=e(t.update,Math.floor(900/t.maxNumber))}}};angular.module("shmApp.directives").directive("countTo",["$interval",e])}(),function(){"use strict";var e=function(){return{restrict:"AE",require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(e,t,n,a){a.$validators.compareTo=function(t){return t===e.otherModelValue},e.$watch("otherModelValue",function(){a.$validate()})}}};angular.module("shmApp.directives").directive("compareTo",[e])}(),function(){"use strict";var e=function(e,t){return{restrict:"A",scope:{addressObj:"="},link:function(n,a,i){n.addressObj&&(n.addressGoogleObject=t.buildGooglePlacesResult(n.addressObj),a.val(n.addressGoogleObject.formatted_address)),e.then(function(){var e={};e.searchBox=new google.maps.places.SearchBox(a[0]),e.searchBox.addListener("places_changed",function(){e.places=e.searchBox.getPlaces(),n.addressObj=t.mapGoogleMapToAddressObj(e.places[0])})},function(){})}}};angular.module("shmApp.directives").directive("googlePlacesAutoComplete",["loadGoogleMapLib","UtilsService",e])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{},template:'<div class="text-center"><div class="fa fa-spinner fa-spin fa-3x"></div></div>'}};angular.module("shmApp.directives").directive("loadingBar",e)}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{},template:'<div class="opened-in-wechat-wrapper text-center" ng-if="openedInWechat === true"><div class="icon"><i class="fa fa-warning"></i></div><div translate="OPENED_IN_WECHAT_PLEASE_OPEN_IN_BROWSER"></div><div>{{url}}</div></div>',link:function(n,a,i){n.openedInWechat=t.openedInWeChat()||t.openInWindowsWechat(),e.openedInWechat=n.openedInWechat,n.url=window.location.href}}};angular.module("shmApp.directives").directive("openedInWeChatChecker",["$rootScope","WeChatService",e])}(),function(){"use strict";var e=function(e){return{restrict:"A",scope:{scrollingElementId:"@?"},template:"",link:function(t,n,a){t.offsetTop=angular.element(n).prop("offsetTop"),t.topClass=a.setClassWhenAtTop,t.listeningElement=t.scrollingElementId?angular.element("#"+t.scrollingElementId):angular.element(e),t.listeningElement.on("scroll",function(a){e.pageYOffset>=t.offsetTop&&!navigator.userAgent.includes("Mobile")&&!navigator.userAgent.includes("mobile")?n.addClass(t.topClass):(n.removeClass(t.topClass),n.css({width:"auto"}))})}}};angular.module("shmApp.directives").directive("setClassWhenAtTop",["$window",e])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{errorObj:"<",msgOnly:"<?",hideCloseBtn:"<?"},templateUrl:t.rootDir.views+"showErrorFromJson.html",link:function(e,t,n){e.clearMsg=function(){e.errorObj=void 0}}}};angular.module("shmApp.directives").directive("showErrorFromJson",["appConf",t])}(),function(){"use strict";var e={width:1200,height:8e3,quality:.8},t=function(t,n,a,i,o){t.editor.addButton("imagelink",{icon:"image",tooltip:n.instant("INSERT_IMAGE"),onclick:function(){var n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept","image/*"),n.setAttribute("multiple","true"),n.onchange=function(){var n=this.files;o(function(){angular.forEach(n,function(n){t.editor.setProgressState(!0),a.resize(n,e).then(function(e){i.uploadAsset(e).then(function(e){t.editor.insertContent('<div class="row"><img src="'+e.data.url+'" style="width: 100%;"/></div>'),t.editor.setProgressState(!1)})})})},100)},n.click()}}),t.editor.addButton("videolink",{icon:"media",tooltip:n.instant("INSERT_VIDEO"),onclick:function(){var n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept","video/*"),n.setAttribute("multiple","true"),n.onchange=function(){var n=this.files;o(function(){angular.forEach(n,function(n){t.editor.setProgressState(!0),a.resize(n,e).then(function(e){i.uploadAsset(e).then(function(e){t.editor.getContent();t.editor.insertContent('<video meipian-style-video-control poster="'+e.data.video_thumbnail_asset.url+'" playsinline width="100%" height="240" controls><source meipian-style-video src="'+e.data.url+'" type="video/mp4"></video>'),t.editor.setProgressState(!1)})})})},100)},n.click()}})},n=function(n,a,i,o,r){return{restrict:"E",scope:{text:"=ngModel",height:"@?",companyId:"<",canEdit:"<",callback:"&"},templateUrl:n.rootDir.views+"textEditor.html",link:function(n,s,c){n.placeholder=a.instant("EDITOR.PLACEHOLDER");var u='<p class="placeholderText non-border">'+n.placeholder+"</p>";tinymce.PluginManager.add("fullscreen",function(e){e.addCommand("mceFullscreen",function(){$(e.getBody()).hasClass("tw-fullscreen-inline")?$(e.getBody()).removeClass("tw-fullscreen-inline"):$(e.getBody()).addClass("tw-fullscreen-inline"),e.focus()}),e.addButton("fullscreen",{icon:"fullscreen",cmd:"mceFullscreen",title:"Fullscreen"}),e.addMenuItem("fullscreen",{icon:"fullscreen",cmd:"mceFullscreen",text:" Fullscreen"})}),n.tinymceOptions={menubar:!1,plugins:"textcolor colorpicker lists fullscreen image paste link",toolbar:["undo redo | styleselect | bold italic underline | alignleft aligncenter alignright | bullist numlist | forecolor backcolor | image videolink | link | fullscreen"],preview_styles:"font-size color background-color",formats:{removeformat:[{selector:"pre",remove:"all"}]},images_upload_handler:function(t,n,a){i.resize(t.blob(),e).then(function(e){o.uploadAsset(e).then(function(e){console.log(e.data.url),n(e.data.url)},function(e){a("Sorry, upload image failed.")})},function(e){a("Sorry, resize image failed.")})},image_class_list:[{title:"Responsive",value:"img-responsive"}],image_dimensions:!1,oninit:"setPlainText",object_resizing:!1,branding:!1,height:n.height||"100vh",inline:!(n.height>0),setup:function(e){n.editor=e,t(n,a,i,o,r),e.on("change undo redo",function(e){n.callback&&e&&e.level&&e.level.content&&("function"==typeof n.callback&&"function"==typeof n.callback()?n.callback()(e.level.content):n.text=e.level.content)}),e.on("init",function(){""==e.getContent()&&e.setContent(u)}),e.on("focus",function(){e.getContent()==u&&e.setContent("")}),e.on("blur",function(){""==e.getContent()&&e.setContent(u)})}}}}};angular.module("shmApp.directives").directive("textEditor",["appConf","$translate","Upload","AssetService","$timeout",n])}(),function(){"use strict";var e,t,n=function(e,n,a){e.localData=e.initData,e.localData&&""!==e.localData.trim()||(e.isEditingDesc=!0),t.openInDesktop()||t.openInWindowsWechat()?e.tinymceOptions={plugins:["link","fullscreen","textcolor","paste"],menubar:!1,convert_urls:0,toolbar:"undo redo | sizeselect | bold italic | removeformat | fontselect |  fontsizeselect | forecolor backcolor | alignleft aligncenter alignright | link | fullscreen",theme:"modern",branding:!1,content_style:'body.mce-content-body p {font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; line-height: 1.5em; } body.mce-content-body img{width:100%}',setup:function(t){t.on("change undo redo",function(t){t&&t.level&&t.level.content&&e.change()(e.index,t.level.content)})}}:e.tinymceOptions={toolbar:"fullscreen link bold italic styleselect removeformat forecolor",statusbar:!1,menubar:!1,branding:!1,plugins:["link","fullscreen","textcolor","paste"],convert_urls:0,theme:"modern",content_style:'body.mce-content-body p {font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; line-height: 1.5em; } body.mce-content-body img{width:100%}',setup:function(t){t.on("change undo redo",function(t){t&&t.level&&t.level.content&&e.change()(e.index,t.level.content)})}}},a=function(a,i){return e=a,t=i,{restrict:"AE",templateUrl:a.rootDir.views+"textareaEditor.html",scope:{initData:"<",index:"<",change:"&changeCallback"},link:n}};angular.module("shmApp.directives").directive("textareaEditor",["appConf","WeChatService",a])}(),function(){"use strict";var e,t,n,a,i,o,r,s,c,u,l={width:1200,height:8e3,quality:.8},p=function(p,m,d,g,f,v,y,h,C,b){return e=p,t=m,n=d,a=g,i=f,o=v,r=y,s=h,c=C,u=b,{restrict:"AE",scope:{chosenUploadFiles:"=ngModel",isHideVideo:"=?",maxImgQuantity:"=?",isHideImg:"=?",eachCallback:"&?",videoCallback:"&?",index:"<?"},templateUrl:p.rootDir.views+"note/uploadImgForEditor.html",link:function(e,o,c){var p=0;e.validateExistVideo=function(t){var n={};n.foundVideoIndex=_.findIndex(t,function(e){if(e.mime_type)return!0===e.mime_type.toLowerCase().startsWith("video")}),e.isContainVideo=n.foundVideoIndex>=0},e.uploadedFiles={},e.openInWechat=a.openedInWeChat(),e.openInWindowsWechat=a.openInWindowsWechat(),e.wechatJsLoading=!0,e.uploadingImg=!1,e.isUploadingVideo=!1,e.isContainVideo=!1,e.isShowVideo=!0!==e.isHideVideo,e.isShowImg=!0!==e.isHideImg,e.overMaxImgs=!1,e.checkMaxImgs=function(t){void 0===e.chosenUploadFiles?e.chosenUploadFiles=[]:e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&(e.overMaxImgs=!0)},e.$watch("chosenUploadFiles",function(t){e.validateExistVideo(t),e.checkMaxImgs(t)}),a.runWhenWXReady(function(){e.wechatJsLoading=!1,e.uploadingImg=!1,e.isUploadingVideo=!1}),e.upload=function(a,o){if(e.uploadingMediaErr=void 0,a){var r=0,c=[],p=[];angular.forEach(a,function(a){var i={};if(!0===o?e.isUploadingVideo=!0:e.uploadingImg=!0,a.size/1e6>100)return void(e.uploadingMediaErr={message:s.instant("ITEM.PAGE.CREATE.VIDEO.OVER_SIZE",{size:"100MB"}),errors:{}});i.key=n.createHash(a.name+(new Date).toUTCString()),e.uploadedFiles[i.key]={file:a,uploadingProgress:0,uploading:!0},c.push(t.resize(a,l))}),u.all(c).then(function(t){angular.forEach(t,function(e){p.push(i.uploadAsset(e))}),u.all(p).then(function(t){e.uploadingImg=!1,e.isUploadingVideo=!1,angular.forEach(t,function(t){var n=t.data;e.eachCallback&&"function"==typeof e.eachCallback&&e.eachCallback()(n,e.index,r),r++,e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&(e.overMaxImgs=!0),e.validateExistVideo(e.chosenUploadFiles),e.videoCallback&&"function"==typeof e.videoCallback&&e.videoCallback()(n,e.index)})})})}},e.syncUpload=function(t,n){var a=t.shift();wx.uploadImage({localId:a,isShowProgressTips:1,success:function(n){var a=n.serverId;e.uploadingMeida=!0,e.uploadingMediaErr=void 0,i.uploadThoughWechat({mediaId:a}).then(function(t){var n=t.data;e.eachCallback&&"function"==typeof e.eachCallback&&e.eachCallback()(n,e.index,p),p++,e.videoCallback&&"function"==typeof e.videoCallback&&e.videoCallback()(n,e.index),e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&(e.overMaxImgs=!0)},function(t){e.uploadingMediaErr=t.data}).finally(function(){e.uploadingMeida=!1}),t.length>0&&r(function(){e.syncUpload(t,!1)},1e3)}})},e.wxChooseImg=function(){a.runWhenWXReady(function(){e.maxImgQuantity?wx.chooseImage({count:e.maxImgQuantity<9?e.maxImgQuantity:9,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){e.localIds=t.localIds,e.syncUpload(e.localIds,!0)}}):wx.chooseImage({count:9,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){e.localIds=t.localIds,e.syncUpload(e.localIds,!0)}})})}}}};angular.module("shmApp.directives").directive("uploadImgForEditor",["appConf","Upload","md5","WeChatService","AssetService","$http","$timeout","$translate","ItemService","$q",p])}(),function(){"use strict";var e=function(e,t,n,a,i){return{restrict:"AE",scope:{maxNoOfImages:"@?",assets:"=",postSuccFunc:"&?",emptyAfterSucc:"<?",btnText:"@?",ngDisabled:"<?",companyId:"<"},templateUrl:e.rootDir.views+"uploadImg.html",link:function(e,t,a){e.signAssetsBack=function(){!0===e.srcIsArray?e.assets=angular.copy(e.aCopyOfAssets):!0===angular.isArray(e.aCopyOfAssets)&&e.aCopyOfAssets.length>0?e.assets=e.aCopyOfAssets[0]:e.assets={}},e.deleteAsset=function(t){var n={};angular.forEach(e.aCopyOfAssets,function(e,a){e.id===t.id&&(n.index=a)}),n.index>-1&&e.aCopyOfAssets.splice(n.index,1),e.signAssetsBack()},e.upload=function(t){t=t.slice(0,e.maxNoOfImages>=e.aCopyOfAssets.length?e.maxNoOfImages-e.aCopyOfAssets.length:0);var a=t.length;angular.forEach(t,function(t,i){var o={};if(o.arrayIndex=e.aCopyOfAssets.length,e.aCopyOfAssets.push({preProcessing:{uploading:!0,uploadingErr:void 0,originalFile:t}}),t.size/1e6>20)return void(e.aCopyOfAssets[o.arrayIndex].uploadingImgErr={message:$translate.instant("ITEM.PAGE.CREATE.VIDEO.OVER_SIZE",{size:"20MB"}),errors:{}});n.imgResize(t).then(function(t){n.uploadAsset(t,e.companyId).then(function(t){e.aCopyOfAssets[o.arrayIndex]=t.data,1*i+1===a&&(e.signAssetsBack(),"function"==typeof e.postSuccFunc&&"function"==typeof e.postSuccFunc()&&e.postSuccFunc()(e.aCopyOfAssets),!0===e.emptyAfterSucc&&(e.assets=void 0,e.init()))},function(t){e.init()}).finally(function(){})})})},e.init=function(){void 0!==e.assets&&""!==e.assets||(e.maxNoOfImages,e.assets=[]),e.srcIsArray=!1,e.aCopyOfAssets=angular.copy(e.assets),e.aCopyOfAssets&&(e.srcIsArray=angular.isArray(e.aCopyOfAssets),!0!==e.srcIsArray&&(e.aCopyOfAssets=[e.aCopyOfAssets])),!1===e.srcIsArray&&(e.maxNoOfImages=1)},e.maxNoOfImages=e.maxNoOfImages||1,e.maxFileSize="20MB",e.btnText=e.btnText||i.instant("UPLOAD_IMAGE.BTN.TITLE"),e.accumulationSize=0,e.init()}}};angular.module("shmApp.directives").directive("uploadImg",["appConf","Upload","AssetService","UtilsService","$translate",e])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{data:"=ngModel",tags:"<"},template:'<div><tags-input ng-model="data" placeholder="{{\'COMPANY_TAGS.PLACEHOLDER\' | translate}}" allow-leftover-text="true" use-strings="true" add-on-space="true" min-length="1" class="tags-input">\n    <auto-complete source="tags"\n                   min-length="0"\n                   load-on-focus="true"\n                   load-on-empty="true"\n                   max-results-to-show="500"></auto-complete>\n</tags-input></div>'}};angular.module("shmApp.directives").directive("tagInput",[e])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{data:"=ngModel",title:"<",inputId:"<"},template:'<div class="numInput"><div class="input-group pull-right"><div class="input-group-btn"><button type="button" class="btn btn-default btn-sm"ng-if="data >= 1" ng-click="minus()"><i class="fa fa-minus"></i></button></div><input class="form-control" name="{{title}}" min="0" ng-model="data" type="number" save="" oninput="validity.valid ? this.save = value : value = this.save;" placeholder="{{ \'SUPER_ADMIN.ITEM_ADD_JIELONG_MODAL.RESERVE.NO.LIMIT\' | translate }}"/><div class="input-group-btn"><button type="button" class="btn btn-success btn-sm"ng-click="add()"><i class = "fa fa-plus"></i></button></div></div></div>',link:function(e,t,n){e.minus=function(){e.data=e.data-1==0?"":e.data-1},e.add=function(){e.data=e.data?e.data+1:1}}}};angular.module("shmApp.directives").directive("inputNumber",e)}(),function(){"use strict";var e=function(e){return{restric:"A",link:function(t,n){t.initialHeight=t.initialHeight||n[0].style.height;var a=function(){n[0].style.height=t.initialHeight,n[0].style.height=n[0].scrollHeight+"px"};n.on("input change",a),e(a,0)}}};angular.module("shmApp.directives").directive("elastic",["$timeout",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{appUser:"<",company:"<",resetWizard:"<"},templateUrl:e.rootDir.views+"wizard/wizardPanel.html",link:function(e,i,o){e.step=1,e.resetWizard?e.step=1:(e.company.has_been_setup&&(e.step=2),e.company.has_set_channel&&(e.step=3),e.company.has_set_article&&(e.step=4)),t.getNumberOfArticlesUnderCompany(e.company.id).then(function(t){e.number_of_article=t.data}).finally(function(){e.number_of_article=0}),e.goToStep=function(t){t<=e.step&&(e.step=t)},e.goToSite=function(i){e.company.has_done_wizard=!0,e.company.has_set_channel=!0,e.company.has_set_article=!0,e.company=n.formatCompany(e.appUser,e.company),"object"==typeof e.company.config&&(e.company.config=JSON.stringify(e.company.config)),"object"==typeof e.company.admin_config&&(e.company.admin_config=JSON.stringify(e.company.admin_config)),t.updateInfo(e.company.id,e.company).then(function(t){switch(e.company=t.data,n.setSelectedCompany(e.company),n.updateCompanyInAllStoredCompanies(e.company),i){case"NOTES":a.go("backend.notes",{},{reload:!1});break;case"CHANNEL_INFO":a.go("backend.company_channels",{},{reload:!1});break;case"COMPANY_INFO":a.go("backend.company_info",{},{reload:!1});break;case"STAFF":a.go("backend.company_staff",{},{reload:!1});break;default:a.go("backend.dashboard",{},{reload:!1})}},function(t){e.savingErr=t.data}).finally(function(){e.saving=void 0})}}}};angular.module("shmApp.directives").directive("wizardPanel",["appConf","CompanyService","UtilsService","$state",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{appUser:"<",company:"<",step:"=ngModel"},templateUrl:e.rootDir.views+"wizard/wizardCompanyInfo.html",link:function(e,a,i){e.updateCompanyInfo=function(){e.saving=!0,e.company.has_been_setup=!0,e.company=n.formatCompany(e.appUser,e.company),"object"==typeof e.company.config&&(e.company.config=JSON.stringify(e.company.config)),"object"==typeof e.company.admin_config&&(e.company.admin_config=JSON.stringify(e.company.admin_config)),t.updateInfo(e.company.id,e.company).then(function(t){e.company=t.data,n.setSelectedCompany(t.data),n.updateCompanyInAllStoredCompanies(t.data),e.step++,e.company.wizard_channel&&e.step++},function(t){e.savingErr=t.data}).finally(function(){e.saving=void 0})}}}};angular.module("shmApp.directives").directive("wizardCompanyInfo",["appConf","CompanyService","UtilsService","$state",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{appUser:"<",company:"<",step:"=ngModel"},templateUrl:e.rootDir.views+"wizard/wizardChannel.html",link:function(e,a,i){e.goBack=function(){e.step--},e.hasChannel=!1,e.setHasChannel=function(){e.hasChannel=!0},e.goNext=function(){e.saving=!0,e.company.has_set_channel=!0,e.company=n.formatCompany(e.appUser,e.company),"object"==typeof e.company.config&&(e.company.config=JSON.stringify(e.company.config)),"object"==typeof e.company.admin_config&&(e.company.admin_config=JSON.stringify(e.company.admin_config)),t.updateInfo(e.company.id,e.company).then(function(t){e.company=t.data,n.setSelectedCompany(e.company),n.updateCompanyInAllStoredCompanies(e.company),e.step++},function(t){e.savingErr=t.data}).finally(function(){e.saving=void 0})}}}};angular.module("shmApp.directives").directive("wizardChannel",["appConf","CompanyService","UtilsService","$state",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{appUser:"<",company:"<",fromWizard:"<",step:"=ngModel"},templateUrl:e.rootDir.views+"wizard/wizardArticle.html",link:function(e,a,i){e.showEditor=!1,e.goBack=function(){e.step--},e.hasArticle=!1,e.setHasArticle=function(){e.hasArticle=!0},e.goNext=function(){e.saving=!0,e.company.has_set_article=!0,e.company=n.formatCompany(e.appUser,e.company),"object"==typeof e.company.config&&(e.company.config=JSON.stringify(e.company.config)),"object"==typeof e.company.admin_config&&(e.company.admin_config=JSON.stringify(e.company.admin_config)),t.updateInfo(e.company.id,e.company).then(function(t){e.company=t.data,n.setSelectedCompany(e.company),n.updateCompanyInAllStoredCompanies(e.company),e.step++},function(t){e.savingErr=t.data}).finally(function(){e.saving=void 0})}}}};angular.module("shmApp.directives").directive("wizardArticle",["appConf","CompanyService","UtilsService","$state",e])}(),function(){"use strict";var e=function(e,t,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<",item:"<"},templateUrl:e.rootDir.views+"recentVisit/RecentVisit.html",link:function(e,n,o){e.recentDays=10,e.dayList=[{name:"1 "+a.instant("DAY"),value:1},{name:"5 "+a.instant("DAYS"),value:5},{name:"10 "+a.instant("DAYS"),value:10},{name:"1 "+a.instant("MONTH"),value:30},{name:"1 "+a.instant("YEAR"),value:365}],e.getUniqueFrom=function(e,t,n){return n.indexOf(e)===t},e.selectDay=function(){e.getItemsVisitHistory()},e.getItemsVisitHistory=function(){e.gettingVisitData=!0;var n={recentDays:e.recentDays,item_id:e.item&&e.item.id};t.getItemsVisitHistory(e.company.id,n).then(function(t){t.data&&(e.visitDatas=t)}).finally(function(t){e.gettingVisitData=!1,e.getChannelPortion(),e.getVisitTrend(),e.getSharerPortion()})},e.getChannelPortion=function(){var t=[];e.visitDatas.data.channelPortion=e.visitDatas.data.channelPortion.filter(function(e){return e.from}),e.visitDatas.data.channelPortion.map(function(e){t.push({values:[e.total],text:a.instant(e.from.toUpperCase())})});var n={type:"pie",gui:{contextMenu:{visible:!1}},title:{text:a.instant("CHANNEL.PIE.TITLE")},legend:{layout:"5x2",x:"10%",y:"8%"},plotarea:{"margin-bottom":"15%","margin-top":"30%"},plot:{borderColor:"#2B313B",borderWidth:2,valueBox:{text:"%v (%npv%)",placement:"out",fontFamily:"Open Sans"},tooltip:{text:"%t : %v",placement:"node:top",padding:"10%","border-radius":"5px"},animation:{effect:2,method:5,speed:500,sequence:1,delay:300}},series:t};zingchart.render({id:"channel-portion",data:n})},e.getSharerPortion=function(){var t=[];e.visitDatas.data.sharerPortion=e.visitDatas.data.sharerPortion.filter(function(e){return null!==e.sharer}),e.visitDatas.data.sharerPortion.map(function(e){t.push({values:[e.total],text:e.sharer.nick_name})});var n={type:"ring",title:{text:a.instant("SHARER.PIE.TITLE")},gui:{contextMenu:{visible:!1}},legend:{layout:"5x2",x:"10%",y:"8%"},plotarea:{"margin-bottom":"15%","margin-top":"30%"},plot:{borderColor:"#2B313B",borderWidth:2,valueBox:{text:"%v (%npv%)",placement:"out",fontFamily:"Open Sans"},tooltip:{text:"%t : %v",placement:"node:top",padding:"10%","border-radius":"5px"},animation:{effect:2,method:5,speed:500,sequence:1,delay:300}},series:t};zingchart.render({id:"sharer-portion",data:n})},e.getVisitTrend=function(){e.visitDatas.data.visitTrend=e.visitDatas.data.visitTrend.filter(function(e){return e.from});var t=e.groupBy(e.visitDatas.data.visitTrend.filter(function(e){return e.from}),"from"),n=Object.keys(t);t=Object.values(t);var i=[];t.map(function(e,t){var o={values:[],text:a.instant(n[t].toUpperCase())};e.map(function(e){o.values.push([new Date(e.date).getTime(),e.total])}),i.push(o)});var o=new Date,r=o.setDate(o.getDate()-e.recentDays),s={type:"line",title:{text:a.instant("VISIT.TREND.TITLE")},gui:{contextMenu:{visible:!1}},legend:{layout:"5x2",x:"10%",y:"8%"},plotarea:{"margin-bottom":"15%","margin-top":"30%"},"scale-x":{"min-value":r,shadow:0,step:172800,transform:{type:"date",all:"%d %M",guide:{visible:!1},item:{visible:!1}},label:{visible:!1},"minor-ticks":0},plot:{borderColor:"#2B313B",borderWidth:2,valueBox:{placement:"out",fontFamily:"Open Sans"},tooltip:{text:"%t : %v",placement:"node:top",padding:"10%","border-radius":"5px"},animation:{effect:2,method:5,speed:500,sequence:1,delay:300}},series:i};zingchart.render({id:"visit-trend",data:s})},e.groupBy=function(e,t){return e.reduce(function(e,n){return(e[n[t]]=e[n[t]]||[]).push(n),e},{})},e.getItemsVisitHistory(),e.uniqueFrom=function(e){var t=e.split(",").filter(function(e,t,n){return n.indexOf(e)===t}),n=[];return t.map(function(e){n.push(a.instant(e.toUpperCase()))}),n.join(", ")},e.navigateToArticle=function(e){i.go("backend.notes_details",{id:e.id},{})}}}};angular.module("shmApp.directives").directive("recentVisit",["appConf","CompanyService","$rootScope","$translate","$state",e])}(),function(){"use strict";var e=function(e,t,n,a){var i=this;i.plan=t,i.ok=function(){i.sending=!0,a(i.reason),e.close("cancel"),n.go("backend.billing",{},{reload:!0})}},t=function(t,n,a,i){return{restrict:"AE",scope:{company:"<"},templateUrl:t.rootDir.views+"subscription/Subscription.html",link:function(o,r,s){o.isChangePlan=!1,o.currentPlan=null,o.loadingCurrentPlan=!1,o.loadingInvoices=!1,o.changePlan=function(){o.isChangePlan=!0},o.hideInvoices=function(){o.isChangePlan=!0},o.getDate=function(e){return new Date(1e3*e).toLocaleDateString("en-AU")},o.getLimit=function(e){var t=e.limit;return"STORAGE_LIMIT"===e.name&&(t=-1===t?"UNLIMITED":t/Math.pow(1024,3)+"G"),-1===t&&(t="UNLIMITED"),t},o.sortPlan=function(e){return e?e.sort(function(e,t){return e.name<t.name?1:e.name>t.name?-1:0}):e},o.openPDF=function(e){window.open(e)},o.getAllInvoices=function(){o.loadingInvoices=!0,n.getAllInvoices(o.company.id).then(function(e){e&&e.data&&(o.allInvoices=e.data)}).finally(function(){o.loadingInvoices=!1})},o.unsubscribe=function(e){var t={reason:e};n.cancelSubscription(o.company.id,t)},o.unsubscribeModal=function(){a.open({animation:!0,templateUrl:t.rootDir.views+"subscription/Unsubscribe.html",controller:["$uibModalInstance","plan","state","unsubscription",e],controllerAs:"mdCtrl",resolve:{plan:function(){return o.currentPlan},state:function(){return i},unsubscription:function(){return o.unsubscribe}}})},o.getPackage=function(){o.loadingCurrentPlan=!0,n.getPackage(o.company.id).then(function(e){e&&e.data&&(o.currentPlan=e.data)}).finally(function(){o.loadingCurrentPlan=!1})},o.getSubscription=function(){n.getSubscription(o.company.id).then(function(e){e&&e.data&&(o.is_valid=e.data.is_valid)})},o.getSubscription(),o.getPackage(),o.getAllInvoices()}}};angular.module("shmApp.directives").directive("subscription",["appConf","SubscriptionService","$uibModal","$state",t])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{company:"<",appUser:"<"},templateUrl:e.rootDir.views+"subscription/SubscriptionPanel.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("subscriptionPanel",["appConf","SubscriptionService","$uibModal","$state",e])}(),function(){"use strict";var e=function(e,t,n){var a=this;a.plan=t,a.getLimit=function(e){return-1===e&&(e="UNLIMITED"),e},a.ok=function(){e.close("cancel"),n.go("backend.billing",{},{reload:!0})}},t=function(t,n,a,i){return{restrict:"AE",scope:{company:"<",plan:"<",currentPlan:"<",resetFunc:"&?"},templateUrl:t.rootDir.views+"subscription/StripePayment.html",link:function(o,r,s){o.stripe=window.Stripe(t.stripe_key),o.elements=o.stripe.elements(),o.cardElement=o.elements.create("card"),o.cardElement.mount("#card-element"),document.getElementById("payment-form").addEventListener("submit",function(e){e.preventDefault(),o.subscribing=!0,o.createSetupIntent()}),o.createPaymentMethod=function(){o.stripe.createPaymentMethod({type:"card",card:o.cardElement}).then(function(e){console.log(e),o.paymentMethod=e.paymentMethod,o.handleCardSetup()})},o.handleCardSetup=function(){o.stripe.handleCardSetup(o.client_secret,o.cardElement,{payment_method_data:{billing_details:{name:"test name"}}}).then(function(e){console.log(e),e.error?document.getElementById("card-errors").textContent=e.error.message:o.addPaymentMethod()})},o.createSetupIntent=function(){n.createSetupIntent(o.company.id).then(function(e){o.client_secret=e.data.client_secret,o.createPaymentMethod()})},o.addPaymentMethod=function(){var e={};e.companyId=o.company.id,e.paymentMethodId=o.paymentMethod.id,n.addPaymentMethod(e).then(function(e){console.log(e),o.updateSubscription()})},o.getLimit=function(e){var t=e.limit;return"STORAGE_LIMIT"===e.name&&(t=-1===t?"UNLIMITED":t/Math.pow(1024,3)+"G"),-1===t&&(t="UNLIMITED"),t},o.updateSubscription=function(){o.subscribing=!0;var e={};e.companyId=o.company.id,e.packageId=o.plan.id,n.updateSubscription(e).then(function(e){o.subscribeSucc()}).finally(function(){o.subscribing=!1})},o.retrieveSetupIntent=function(){o.stripe.retrieveSetupIntent(o.client_secret).then(function(e){console.log(e),o.stripe.createPaymentMethod({type:"card",card:o.cardElement,billing_details:{name:"Jenny Rosen"}}).then(function(e){o.paymentMethod=e.paymentMethod,o.addPaymentMethod()},function(e){console.log(e)})})},o.reset=function(){o.planId=null,o.resetFunc()()},o.getSubscription=function(){n.getSubscription(o.company.id).then(function(e){e&&e.data&&(o.is_valid=e.data.is_valid)})},o.sortPlan=function(e){return e?e.sort(function(e,t){return e.name<t.name?1:e.name>t.name?-1:0}):e},o.getSubscription(),o.subscribeSucc=function(){a.open({animation:!0,templateUrl:t.rootDir.views+"subscription/SubscribeSucc.html",controller:["$uibModalInstance","plan","state",e],controllerAs:"mdCtrl",resolve:{plan:function(){return o.plan},state:function(){return i}}})}}}};angular.module("shmApp.directives").directive("stripePayment",["appConf","SubscriptionService","$uibModal","$state",t])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{company:"<",currentPlan:"<",hideInvoices:"&?"},templateUrl:e.rootDir.views+"subscription/PlanSelect.html",link:function(e,n,a){e.selectedPlan=null,e.showStripe=!1,e.plans=[{id:1,price:30,name:"Trial",description:"Channel: 5, Item: 5, Article: 10"},{id:2,price:40,name:"Plan A -",description:"Channel: 15, Item: 15, Article: 50"},{id:3,price:50,name:"Plan A",description:"Channel: 25, Item: 25, Article: 100"},{id:4,price:60,name:"Plan A +",description:"Channel: Unlimited, Item: Unlimited, Article: Unlimited"}],e.getAllPackages=function(){t.getAllPackages(e.company.id).then(function(t){e.plans=t.data.sort(function(e,t){return e.order-t.order})})},e.selectPlan=function(t){e.selectedPlan=t,
e.hideInvoices&&e.hideInvoices()},e.getLimit=function(e){var t=e.limit;return"STORAGE_LIMIT"===e.name&&(t=-1===t?"UNLIMITED":t/Math.pow(1024,3)+"G"),-1===t&&(t="UNLIMITED"),t},e.subscribe=function(){e.showStripe=!0},e.resetPlan=function(){e.selectedPlan=null,e.showStripe=!1},e.sortPlan=function(e){return e?e.sort(function(e,t){return e.name<t.name?1:e.name>t.name?-1:0}):e},e.getAllPackages()}}};angular.module("shmApp.directives").directive("planSelect",["appConf","SubscriptionService",e])}(),function(){"use strict";var e=function(e){return function(t){var n={};return n.parts=e("number")(t).split(","),1===n.parts.length?t:2===n.parts.length?(t/1e3).toFixed(1)+"K":3===n.parts.length?(t/1e6).toFixed(1)+"M":void 0}};angular.module("shmApp.filters").filter("shortNumber",["$filter",e])}(),function(){"use strict";var e=function(e){return function(t){return e.trustAsHtml(t)}};angular.module("shmApp.filters").filter("trustAsHtml",["$sce",e])}(),function(){"use strict";var e=function(){return function(e,t){if(e<=0)return"0 GB";if(isNaN(parseFloat(e))||!isFinite(e))return"-";void 0===t&&(t=2);var n=["bytes","kB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(a))).toFixed(t)+" "+n[a]}};angular.module("shmApp.filters").filter("BytesToGBFilter",e)}(),function(){"use strict";var e=function(){return function(e,t){var n=[];if(angular.isArray(e)){var a=Object.keys(t);e.forEach(function(e){for(var i=!1,o=0;o<a.length;o++){var r=a[o],s=t[r].toLowerCase();if(-1!==e[r].toString().toLowerCase().indexOf(s)){i=!0;break}}i&&n.push(e)})}else n=e;return n}};angular.module("shmApp.filters").filter("propsFilter",e)}();